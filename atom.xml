<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Shunyang Li</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://shunyangli.github.io/"/>
  <updated>2022-07-20T10:17:01.904Z</updated>
  <id>https://shunyangli.github.io/</id>
  
  <author>
    <name>Shunyang Li</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Flask API</title>
    <link href="https://shunyangli.github.io/post/30e4/"/>
    <id>https://shunyangli.github.io/post/30e4/</id>
    <published>2022-07-20T10:08:04.000Z</published>
    <updated>2022-07-20T10:17:01.904Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Flask-API"><a href="#Flask-API" class="headerlink" title="Flask API"></a>Flask API</h1><p>给大家分享一下<code>flask api</code> 和 <a href="https://flask-restful.readthedocs.io/en/latest/" target="_blank" rel="noopener">Flask-RESTful API </a> 的两种不同用法。。首先API只会返回json的类型，不会返回HTML。API一般适用于前后端分离的情况。Flask API的实现方式有两种。第一种就是不用<code>flask_restplus</code>。第二种是用<code>flask_restplus</code>。首先给大家说一下不用<code>flask_restplus</code>怎么写。</p><h2 id="不使用-flask-restplus"><a href="#不使用-flask-restplus" class="headerlink" title="不使用 flask_restplus"></a>不使用 flask_restplus</h2><p>在不适用<code>flask_restplus</code>的情况下我们可以直接使用route的形式来写API。只是把<code>return render_template</code>改成了<code>return jsonify</code> 来返回一个json类型的数据。可以根据不同的request的方式(GET, POST, DELETE)可以处理不同的事情，比如DELETE可以用来删除数据， POST可以添加数据，GET可以获取数据。具体实现方法如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SECRET_KEY 可以设置为任意的string</span></span><br><span class="line">app.config[<span class="string">"SECRET_KEY"</span>] = <span class="string">"WHATEVER"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/index', methods=["POST","GET","DELETE"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        username = request.args.get(<span class="string">"username"</span>)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">"GET"</span>: username&#125;)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        username = request.args.get(<span class="string">"username"</span>)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">"POST"</span>: username&#125;)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"DELETE"</span>:</span><br><span class="line">        username = request.args.get(<span class="string">"username"</span>)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">"DELETE"</span>: username&#125;)</span><br><span class="line"></span><br><span class="line">app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>GET 请求测试如下：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "http://127.0.0.1:5000/index?username=admin" -H "accept: application/json"</span><br></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"GET"</span>: <span class="string">"admin"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>POST 请求测试如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST "http://127.0.0.1:5000/index?username=admin" -H "accept: application/json"</span><br></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"POST"</span>: <span class="string">"admin"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DELETE 请求测试如下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X DELETE "http://127.0.0.1:5000/index?username=admin" -H "accept: application/json"</span><br></pre></td></tr></table></figure><p>结果如下：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"DELETE"</span>: <span class="string">"admin"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="使用flask-restplus"><a href="#使用flask-restplus" class="headerlink" title="使用flask_restplus"></a>使用flask_restplus</h2><p>Flask-RESTful 提供了 reqparse 一种类似 argparse 参数解析机制以简化参数处理。所以处理请求数据的时候和Flask不太一样。<code>parser = reqparse.RequestParser():</code> reqparse使用RequestParser() 可以从 flask.Request.values，以及 flask.Request.json 解析值。这里创建了一个解析对象parser。<code>parser.add_argument(&#39;task&#39;)：</code>向parser对象中添加你要关注的命令行参数和选项，每一个add_argument方法对应一个你要关注的参数或选项。<code>parser.parse_args()：</code>调用parse_args()方法进行解析，解析成功之后即可使用。<code>POST, GET, DELETE</code>获取参数的方式一样。在定义API的时候可以是用<code>@api.param</code>添加参数，在web端测试的时候比较方便。<code>@app.doc(description=&#39;xx&#39;)</code>添加对这个API的描述。<code>@app.response(200,&#39;success&#39;)</code>定义路由code的信息，普遍是用的是200，404，400，403等等。</p><p>我发现最近flask的版本稳定性很差，尤其是<code>werkzeug</code>和flask之间的版本冲突，大家最好用虚拟机进行测试实验比较好。。。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify, make_response, request</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Api, reqparse, abort, Resource</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = <span class="string">'WHATEVER'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/login')</span></span><br><span class="line"><span class="meta">@api.param('username')</span></span><br><span class="line"><span class="meta">@api.doc(description="This is test")</span></span><br><span class="line"><span class="meta">@api.response(200, 'Success')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span><span class="params">(Resource)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">()</span>:</span></span><br><span class="line">        parser = reqparse.RequestParser()</span><br><span class="line">        parser.add_argument(<span class="string">'username'</span>, type=str)</span><br><span class="line">        args = parser.parse_args()</span><br><span class="line">        username = args.get(<span class="string">"username"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 如果结果正确可以直接make_response</span></span><br><span class="line">        <span class="comment"># 如果不正确可以用abort</span></span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">"admin"</span>:</span><br><span class="line">            <span class="keyword">return</span> make_response(jsonify(&#123;<span class="string">"POST"</span>: username&#125;),<span class="number">200</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            abort(<span class="number">400</span>, <span class="string">"username not currect"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">()</span>:</span></span><br><span class="line">        parser = reqparse.RequestParser()</span><br><span class="line">        parser.add_argument(<span class="string">'username'</span>, type=str)</span><br><span class="line">        args = parser.parse_args()</span><br><span class="line">        username = args.get(<span class="string">"username"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">"admin"</span>:</span><br><span class="line">            <span class="keyword">return</span> make_response(jsonify(&#123;<span class="string">"GET"</span>: username&#125;),<span class="number">200</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            abort(<span class="number">400</span>, <span class="string">"username not currect"</span>)</span><br><span class="line"></span><br><span class="line">app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>GET 请求测试：</p><p>API的请求方法和flask不太一样，需要 <code>-d 加上参数</code>， POST请求也是一样</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "http://127.0.0.1:5000/login" -H "accept: application/json" -d "username=admin"</span><br></pre></td></tr></table></figure><p>请求结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"GET"</span>: <span class="string">"admin"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>POST 请求测试：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST "http://127.0.0.1:5000/login" -H "accept: application/json" -d "username=admin"</span><br></pre></td></tr></table></figure><p>请求结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"POST"</span>: <span class="string">"admin"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>给大家看一下<code>abort</code>的显示结果：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"username not currect"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>或者大家可以直接打开<code>http://127.0.0.1:5000</code>可以显示界面来测试。 如下图所示： </p><p><img src="/post/30e4/s.png" alt></p><h1 id="前端请求API"><a href="#前端请求API" class="headerlink" title="前端请求API"></a>前端请求API</h1><p>昨天写的太晚就先睡了，今天给补上怎么用<code>AJAX</code>也就是前端来请求API数据的。大家可以自行了解一下<code>AJAX</code>的function什么的，demo用的是<code>JQuery</code>中的<code>AJAX</code>。因为牵涉到了跨域请求，所以后端也稍微有一点改变。需要用到<code>flask_cors</code>来解决这个问题。只需要在上面的Python代码加两行代码就OK了。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_cors <span class="keyword">import</span> CORS</span><br><span class="line">...... <span class="comment"># 这些是初始化app部分</span></span><br><span class="line">CORS(app)</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>如果不加<code>CROS(app)</code>的话会在浏览器的调试<code>Console</code>出现以下报错：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access to XMLHttpRequest at <span class="string">'http://127.0.0.1:5000/login?username=admi'</span> <span class="keyword">from</span> origin <span class="string">'null'</span> has been blocked by CORS policy: No <span class="string">'Access-Control-Allow-Origin'</span> header is present on the requested resource.</span><br></pre></td></tr></table></figure><p>前端代码具体实现如下：</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">    $.ajax (&#123;</span></span><br><span class="line"><span class="javascript">        url: <span class="string">'http://127.0.0.1:5000/login'</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line"><span class="javascript">            username: <span class="string">"admin"</span></span></span><br><span class="line">        &#125;, </span><br><span class="line"><span class="javascript">        error: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// data 包含了整个的错误信息</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// data.status 指的是返回的错误代码，比如400</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// data.responseJSON.message 指返回的错误信息， username not currect</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"ERROR: "</span>, data)</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(data)</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        type: <span class="string">"GET"</span></span></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="拓展"><a href="#拓展" class="headerlink" title="拓展"></a>拓展</h1><p>当我们有多个<code>api</code>功能需要实现，比如登录，注册等等。为了更好的区分每个功能之间的url，我们可以使用<code>api.namespace()</code>对不同功能创建不同的变量。比如我们需要实现注册，登录（验证模块）时我们可以使用<code>auth = api.namespace(&#39;auth&#39;, description=&quot;Authentication Services&quot;)</code>。同时为了能更加方便的在api提供的接口里面进行测试，我们可以对每个method进行声明<code>response</code>，<code>param</code> 或者<code>doc</code>等等。比如：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify, make_response, request</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Api, reqparse, abort, Resource</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = <span class="string">'WHATEVER'</span></span><br><span class="line"></span><br><span class="line">auth = api.namespace(<span class="string">'auth'</span>, description=<span class="string">"Authentication Services"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@auth.route("/login", strict_slashes=False)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span><span class="params">(Resource)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @auth.response(200, 'Success')</span></span><br><span class="line"><span class="meta">    @auth.response(400, 'Missing args')</span></span><br><span class="line"><span class="meta">    @auth.response(403, 'Not register')</span></span><br><span class="line"><span class="meta">    @auth.param('password', 'Password')</span></span><br><span class="line"><span class="meta">    @auth.param('username', 'Username')</span></span><br><span class="line"><span class="meta">    @auth.doc(description="Please enter username and password. "</span></span><br><span class="line">                          <span class="string">"If the username and password correct, a token will be returned"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        username = get_request_args(<span class="string">"username"</span>, str)</span><br><span class="line">        password = get_request_args(<span class="string">"password"</span>, str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> make_response(jsonify(username=username,password=password), <span class="number">200</span>)</span><br><span class="line">  </span><br><span class="line">app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>为了方便使用，我创造了一个公开的轻量级<a href="https://github.com/ShunyangLi/API-Template" target="_blank" rel="noopener">API模板</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Flask-API&quot;&gt;&lt;a href=&quot;#Flask-API&quot; class=&quot;headerlink&quot; title=&quot;Flask API&quot;&gt;&lt;/a&gt;Flask API&lt;/h1&gt;&lt;p&gt;给大家分享一下&lt;code&gt;flask api&lt;/code&gt; 和 &lt;a href=&quot;h
      
    
    </summary>
    
    
      <category term="Backend" scheme="https://shunyangli.github.io/categories/Backend/"/>
    
      <category term="API" scheme="https://shunyangli.github.io/categories/Backend/API/"/>
    
    
      <category term="Flask" scheme="https://shunyangli.github.io/tags/Flask/"/>
    
      <category term="API" scheme="https://shunyangli.github.io/tags/API/"/>
    
  </entry>
  
  <entry>
    <title>Sliding Window</title>
    <link href="https://shunyangli.github.io/post/6284/"/>
    <id>https://shunyangli.github.io/post/6284/</id>
    <published>2022-07-07T10:35:03.000Z</published>
    <updated>2022-07-07T11:03:09.491Z</updated>
    
    <content type="html"><![CDATA[<p>滑动窗口的核心在于hua（<del>划水的hua</del>）。滑动窗口有点类似动态规划，在一些区间内找到最优解，而且也有一点双指针的思想。滑动窗口可以用以解决数组/字符串的子元素问题，它可以将嵌套的循环问题，转换为单循环问题，降低时间复杂度。可以把比较常见的暴力解法$O(n^2)$降到$O(n)$。其实如果提升算法效率就大概率会牺牲空间，提升空间大概率牺牲时间。大部分情况两者不能兼得。leetcode有很多关于滑动窗口比较有趣的问题。</p><h2 id="76-Minimum-Window-Substring"><a href="#76-Minimum-Window-Substring" class="headerlink" title="76. Minimum Window Substring"></a>76. Minimum Window Substring</h2><p>Given two strings s and t of lengths m and n respectively, return the minimum window substring of s such that every character in t (including duplicates) is included in the window. If there is no such substring, return the empty string “”.</p><p>The testcases will be generated such that the answer is unique.</p><p>A substring is a contiguous sequence of characters within the string.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: s = &quot;ADOBECODEBANC&quot;, t = &quot;ABC&quot;</span><br><span class="line">Output: &quot;BANC&quot;</span><br><span class="line">Explanation: The minimum window substring &quot;BANC&quot; includes &apos;A&apos;, &apos;B&apos;, and &apos;C&apos; from string t.</span><br></pre></td></tr></table></figure><p>大致意思就是找到一个包含<code>t</code>的最小的子序列。这个问题可以使用最简单的暴力解法，双重循环就能解决，但是时间复杂度太高，这时候我们就可以通过滑动窗口来解决。滑动窗口一半是有左右两个指针来进行控制窗口的大小。右侧指针负责扩大窗口，左侧指针负责缩小窗口。右侧指针负责寻找到包含<code>t</code>的子序列，左侧指针负责对该子序列不断进行缩小直到找到最小包含<code>t</code>的子序列。</p><p><img src="/post/6284/1.png" alt></p><p>核心可以分成三部，如图所示。在第一步立马，<code>R</code>（右侧指针）先找到了满足需求的子序列，这时候<code>L</code>（左侧指针）开始减小窗口以便找到最小的子序列，当<code>L</code>指向<code>D</code>的时候该子序列不满足要求，然后<code>R</code>开始继续向右边移动来找到满足条件的子序列。当<code>R</code>指向<code>A</code>的时候，该子序列满足要求，然后<code>L</code>向右移动来缩小窗口大小。然后重复该步骤，直到找到最小的子序列。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minWindow</span><span class="params">(self, s: str, t: str)</span> -&gt; str:</span></span><br><span class="line">        <span class="keyword">if</span> len(s) &lt; len(t):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line"></span><br><span class="line">        target = &#123;&#125;</span><br><span class="line">        windows = &#123;&#125;</span><br><span class="line">        end = len(s)</span><br><span class="line">        start = <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        tValid = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> val <span class="keyword">in</span> t:</span><br><span class="line">            target[val] = target.get(val, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> right &lt; len(s):</span><br><span class="line">            c = s[right]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> target:</span><br><span class="line">                right += <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            windows[c] = windows.get(c, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> windows[c] == target[c]:</span><br><span class="line">                tValid += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># then left start to move</span></span><br><span class="line">            <span class="keyword">while</span> tValid == len(target):</span><br><span class="line">                lc = s[left]</span><br><span class="line">                <span class="keyword">if</span> lc <span class="keyword">not</span> <span class="keyword">in</span> target:</span><br><span class="line">                    left += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># remove the element from the window</span></span><br><span class="line">                windows[lc] -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> windows[lc] &lt; target[lc]:</span><br><span class="line">                    tValid -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> right - left &lt; end:</span><br><span class="line">                        end = right - left + <span class="number">1</span></span><br><span class="line">                        start = left</span><br><span class="line">                left += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            right += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> start == <span class="number">-1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">        <span class="keyword">return</span> s[start:start + end]</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;滑动窗口的核心在于hua（&lt;del&gt;划水的hua&lt;/del&gt;）。滑动窗口有点类似动态规划，在一些区间内找到最优解，而且也有一点双指针的思想。滑动窗口可以用以解决数组/字符串的子元素问题，它可以将嵌套的循环问题，转换为单循环问题，降低时间复杂度。可以把比较常见的暴力解法$O(
      
    
    </summary>
    
    
      <category term="leetcode" scheme="https://shunyangli.github.io/categories/leetcode/"/>
    
    
      <category term="leetcode" scheme="https://shunyangli.github.io/tags/leetcode/"/>
    
      <category term="algorithm" scheme="https://shunyangli.github.io/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>COMP9311 Extension</title>
    <link href="https://shunyangli.github.io/post/5fc4/"/>
    <id>https://shunyangli.github.io/post/5fc4/</id>
    <published>2022-06-17T23:52:21.000Z</published>
    <updated>2022-06-19T05:56:24.154Z</updated>
    
    <content type="html"><![CDATA[<h1 id="COMP9311-extension"><a href="#COMP9311-extension" class="headerlink" title="COMP9311 extension"></a>COMP9311 extension</h1><p>This is an extension knowledge about COMP9311</p><h2 id="Auto-deploy-PostgreSQL"><a href="#Auto-deploy-PostgreSQL" class="headerlink" title="Auto deploy PostgreSQL"></a>Auto deploy PostgreSQL</h2><p>You can find the shell script <a href="deploy.sh">here</a>. You can execute the following command in <code>grieg</code> server to deploy the SQL server.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod +x deploy.sh</span><br><span class="line"></span><br><span class="line">./deploy.sh</span><br></pre></td></tr></table></figure><p>The code in <code>deploy.sh</code> is:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">user=$(whoami)</span><br><span class="line"></span><br><span class="line">priv srvr</span><br><span class="line"></span><br><span class="line">~cs9311/bin/pginit</span><br><span class="line"></span><br><span class="line">echo "if [ \`hostname\` = \"grieg\" ]</span><br><span class="line">then</span><br><span class="line">    source /srvr/$user/env</span><br><span class="line">fi</span><br><span class="line">" &gt;&gt; ~/.bash_profile</span><br></pre></td></tr></table></figure><h2 id="Backgroud-information"><a href="#Backgroud-information" class="headerlink" title="Backgroud information"></a>Backgroud information</h2><ul><li><code>grieg</code> means a server named grieg</li></ul><h2 id="Login-CSE-GRIEG"><a href="#Login-CSE-GRIEG" class="headerlink" title="Login CSE/GRIEG"></a>Login CSE/GRIEG</h2><p>You can log in to <code>cse</code> server by using the following command:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh ZID@cse.unsw.edu.au</span><br></pre></td></tr></table></figure><p>PS: Please replace <code>ZID</code> with your zid, and the password is same as your zid passowrd (typing the password in terminal is <strong>unvisitable</strong>).</p><p>After log in to the <code>cse</code> server, then you can log in to <code>grieg</code> server by using the following command:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh grieg</span><br></pre></td></tr></table></figure><p>Also, you can log in to <code>grieg</code> directly by using the following command:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh ZID@grieg.cse.unsw.edu.au</span><br></pre></td></tr></table></figure><p>PS: Please replace <code>ZID</code> with your zid, and the password is same as your zid passowrd (typing the password in terminal is <strong>unvisitable</strong>).</p><h2 id="Log-in-to-cse-server-without-password"><a href="#Log-in-to-cse-server-without-password" class="headerlink" title="Log in to cse server without password"></a>Log in to <code>cse</code> server without password</h2><p>You can log in to <code>cse</code> server without password by uploading <code>ssh-key</code> into the server. If you did not have a <code>ssh-key</code>, you can generate a <code>ssh-key</code> by using the following command (please execute these commands in personal computer) :</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p>Then you can use <code>ssh-copy-id</code> to copy your key to server:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id ZID@cse.unsw.edu.au</span><br></pre></td></tr></table></figure><p>PS: Please replace <code>ZID</code> with your zid.</p><p>You can find more details <a href="https://www.ssh.com/ssh/copy-id" target="_blank" rel="noopener">here</a></p><h2 id="bash-profile-settings"><a href="#bash-profile-settings" class="headerlink" title=".bash_profile settings"></a>.bash_profile settings</h2><p>When you logging in to <code>cse</code> server, you may can not find these files (.bash_profile, .bashrc or .profile). You can use <code>touch</code> command to create a empty file in home directory.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~  // switch the directory into home directory</span><br><span class="line">touch .bash_profile</span><br></pre></td></tr></table></figure><p>Then you can find the <code>.bash_profile</code> file by using:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -al</span><br></pre></td></tr></table></figure><p>Then you can add the following config code into <code>.bash_profile</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if [ `hostname` = "grieg" ]</span><br><span class="line">then</span><br><span class="line">    source /srvr/ZID/env</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>PS: Please replace <code>ZID</code> with your zid.</p><h2 id="Terminal-display"><a href="#Terminal-display" class="headerlink" title="Terminal display"></a>Terminal display</h2><p>Several students asked how to modify the Linux terminal display. After logging in to <code>grieg</code> server, on the left hand side it looks like:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grieg %</span><br></pre></td></tr></table></figure><p>It only shows the hostname which is very inconvenient when we want to know which folder we are in. The following commands can help you to solve the issue:</p><ol><li>Log in to <code>grieg</code> server</li><li>Add this line <code>export PS1=&quot;\u@\h \w $ &quot;</code> into the <code>.bash_profile</code> file</li><li>Execute <code>source ~/.bash_profile</code></li></ol><p>Then the terminal display should like:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZID@grieg ~ $</span><br></pre></td></tr></table></figure><p>Where <code>~</code> means home directory.</p><p>You can find more details <a href="https://www.thegeekstuff.com/2008/09/bash-shell-ps1-10-examples-to-make-your-linux-prompt-like-angelina-jolie/" target="_blank" rel="noopener">here</a></p><h2 id="Upload-files-to-cse-server"><a href="#Upload-files-to-cse-server" class="headerlink" title="Upload files to cse server"></a>Upload files to <code>cse</code> server</h2><p>Use <code>scp</code> (srcure copy) command can upload files/directory from local (Linux or Mac system) to remote <code>cse</code> server:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp [source file] [username]@[destination server]:/path/</span><br></pre></td></tr></table></figure><p>For example:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp schema.sql ZID@cse.unsw.edu.au:~</span><br></pre></td></tr></table></figure><p>Which means upload the <code>schema.sql</code> file into your <code>cse</code> server home directory.</p><p>If you want to upload a directory you can use:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r [source directory] [username]@[destination server]:/path/</span><br></pre></td></tr></table></figure><p>If you are using windows system, you can have a look <code>winscp</code>. And UNSW gives a <a href="https://taggi.cse.unsw.edu.au/FAQ/Accessing_Your_Files/" target="_blank" rel="noopener">guideline</a> about that</p><h2 id="SSH-config"><a href="#SSH-config" class="headerlink" title="SSH config"></a>SSH config</h2><p>After finished configuration of <em>log in without password. (section 1.3)</em>. You can config the ssh config file like:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host cse</span><br><span class="line">    HostName cse.unsw.edu.au</span><br><span class="line">    Port 22</span><br><span class="line">    User ZID</span><br></pre></td></tr></table></figure><p>Where <code>ZID</code> is your zid. Now, you can use <code>ssh cse</code> instead of <code>ssh zid@cse.unsw.edu.au</code>.</p><h1 id="Lab-02"><a href="#Lab-02" class="headerlink" title="Lab 02"></a>Lab 02</h1><p>The lab 02 slides is available <a href="https://docs.google.com/presentation/d/1nRCQGahTeVD0qvVuNeTMYEBgLvrqs-rvqKCjTJjMUOc/edit?usp=sharing" target="_blank" rel="noopener">here</a>, if you have any issues, please email me.</p><iframe src="lab02.pdf" style="width: 100%;height: 500px" title="COMP9311 Lab02"></iframe><h1 id="Lab03"><a href="#Lab03" class="headerlink" title="Lab03"></a>Lab03</h1><h2 id="Step-up"><a href="#Step-up" class="headerlink" title="Step up"></a>Step up</h2><ol><li><p>Download the <a href="https://www.cse.unsw.edu.au/~cs9311/21T1/lab/04/weblog.zip" target="_blank" rel="noopener">weblog.zip</a> by using <code>wget</code> command in the terminal: <code>wget https://www.cse.unsw.edu.au/~cs9311/21T1/lab/04/weblog.zip</code></p></li><li><p>Unzip the weblog.zip files: <code>unzip weblog.zip</code></p></li><li><p>Create a database for this lab: <code>createdb weblog</code></p></li><li><p>Load SQL file</p><ol><li><p>switch to the weblog directory: <code>cd weblog</code></p></li><li><p>load schema: <code>psql weblog -f schema.sql</code></p></li><li><p>load data sql file:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">psql weblog -f Hosts.sql</span><br><span class="line">psql weblog -f Sessions.sql</span><br><span class="line">psql weblog -f Accesses.sql</span><br></pre></td></tr></table></figure></li></ol></li></ol><p>Regex online test <a href="https://regexr.com" target="_blank" rel="noopener">regex</a></p><h1 id="K-Core-decomposition"><a href="#K-Core-decomposition" class="headerlink" title="K-Core decomposition"></a>K-Core decomposition</h1><p>Given a graph G, the k-core of G can be computed by recursively deleting every node and its adjacent edges if its degree is less than <code>k</code>.<br>The python code of k-core as shown in the following part.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">edges = &#123;</span><br><span class="line">    <span class="string">'a'</span>: [<span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>],</span><br><span class="line">    <span class="string">'b'</span>: [<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>],</span><br><span class="line">    <span class="string">'c'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'d'</span>],</span><br><span class="line">    <span class="string">'d'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_k_core</span><span class="params">(k, edges)</span>:</span></span><br><span class="line">    deleted_nodes = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> edges:</span><br><span class="line">            <span class="keyword">if</span> len(edges[node]) &lt; k:</span><br><span class="line">                deleted_nodes.append(node)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> len(deleted_nodes) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> deleted_nodes:</span><br><span class="line">            <span class="keyword">if</span> u <span class="keyword">not</span> <span class="keyword">in</span> edges:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> v <span class="keyword">in</span> edges[u]:</span><br><span class="line">                edges[v].remove(u)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">del</span> edges[u]</span><br><span class="line">        deleted_nodes.clear()</span><br><span class="line">    </span><br><span class="line">    print(<span class="string">", "</span>.join(edges.keys()))</span><br><span class="line">    <span class="keyword">for</span> u <span class="keyword">in</span> edges:</span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> edges[u]:</span><br><span class="line">            print(<span class="string">"&#123;&#125;, &#123;&#125;"</span>.format(u,v))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    compute_k_core(<span class="number">2</span>, edges=copy.deepcopy(edges))</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;COMP9311-extension&quot;&gt;&lt;a href=&quot;#COMP9311-extension&quot; class=&quot;headerlink&quot; title=&quot;COMP9311 extension&quot;&gt;&lt;/a&gt;COMP9311 extension&lt;/h1&gt;&lt;p&gt;This i
      
    
    </summary>
    
    
      <category term="COMP" scheme="https://shunyangli.github.io/categories/COMP/"/>
    
    
      <category term="COMP" scheme="https://shunyangli.github.io/tags/COMP/"/>
    
  </entry>
  
  <entry>
    <title>Entropy</title>
    <link href="https://shunyangli.github.io/post/663/"/>
    <id>https://shunyangli.github.io/post/663/</id>
    <published>2022-06-14T06:15:20.000Z</published>
    <updated>2022-06-14T06:41:24.988Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Entropy"><a href="#Entropy" class="headerlink" title="Entropy"></a>Entropy</h1><p>Entropy can be used as a measure of uncertainty in information theory.</p><p>Entropy <code>H(Y)</code> of a random <code>Y</code> with <code>n</code> different possible values:<br>$$<br>H(Y) =-\sum^{n}_{i=1}P(y_i)log_2P(y_i)<br>$$</p><p>Where $P(y_i)$ is the probaility that random variable <code>Y</code> equals $y_i$ (One of <code>n</code> different possible values of <code>Y</code>).</p><p><code>n</code> represents the number of types of outcomes, for example, if the outcome is 1, 2, 3 then n is 3. $P(y_i)$represents the probability of different outcomes, for example, if 1, 2, 3 then the probability of 1 is $1/3$.</p><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><table><thead><tr><th align="center">$X_1$</th><th align="center">$X_2$</th><th align="center">Y</th></tr></thead><tbody><tr><td align="center">T</td><td align="center">F</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">F</td><td align="center">F</td><td align="center">F</td></tr><tr><td align="center">F</td><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">F</td><td align="center">F</td></tr></tbody></table><p>Y has two values: T and F. In the equation <code>n</code> = 2. Therefore, we can get:</p><p>$$<br>H(Y) =-\sum^{n}_{i=1}P(y_i)log_2P(y_i)<br>$$</p><p>$$<br>H(Y) =-\frac{3}{5}log_2\frac{3}{5}-\frac{2}{5}log_2\frac{2}{5} \approx0.292<br>$$</p><h2 id="Conditional-entropy"><a href="#Conditional-entropy" class="headerlink" title="Conditional entropy"></a>Conditional entropy</h2><p>Conditional entropy $H(Y|X=x_j)$ of <code>Y</code> given $X=x_i$.</p><p>$$<br>H(Y|X=x_j)=-\sum^{n}_{i=1}P(y_i|X=x_j)log_2P(y_i|X=x_j)<br>$$</p><p>After split we can get:</p><p>$$<br>H(Y|X)=\sum^{k}_{j=1}P(x_j)H(Y|X=x_j)<br>$$</p><h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h3><table><thead><tr><th align="center">$X_1$</th><th align="center">$X_2$</th><th align="center">Y</th></tr></thead><tbody><tr><td align="center">T</td><td align="center">F</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">F</td><td align="center">F</td><td align="center">F</td></tr><tr><td align="center">F</td><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">F</td><td align="center">F</td></tr></tbody></table><p>Suppose we split the data based on the value of $X_1$. $X_1$ has two possible values: T and F. We can compute the conditional entropy for $X_1=T$ and $X_1=F$.</p><blockquote><p>Compute $X_1=T$</p></blockquote><table><thead><tr><th align="center">$X_1$</th><th align="center">Y</th></tr></thead><tbody><tr><td align="center"><em>T</em></td><td align="center"><em>T</em></td></tr><tr><td align="center"><em>T</em></td><td align="center"><em>T</em></td></tr><tr><td align="center"><em>T</em></td><td align="center"><em>F</em></td></tr><tr><td align="center">F</td><td align="center">T</td></tr><tr><td align="center">F</td><td align="center">F</td></tr></tbody></table><p>After splitting, when $X_1=T$, Y has two values. Therefore, $P(Y=T|X_1=T) = 2/3$ and $P(Y=F|X_1=T) = 2/3$.</p><p>We can jave the following entropy when $X_1=T$:</p><p>$$<br>H(Y|X_1=T)=-\sum^{n}_{i=1}P(y_i|X_1=T)log_2P(y_i|X_1=T)<br>$$</p><p>$$<br>H(Y|X_1=T)= -\frac{2}{3}log_2(\frac{2}{3})-\frac{1}{3}log_2(\frac{1}{3}) \approx 0.28<br>$$</p><blockquote><p>Compute $X_1=F$</p></blockquote><table><thead><tr><th align="center">$X_1$</th><th align="center">Y</th></tr></thead><tbody><tr><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">F</td></tr><tr><td align="center"><em>F</em></td><td align="center"><em>T</em></td></tr><tr><td align="center"><em>F</em></td><td align="center"><em>F</em></td></tr></tbody></table><p>After splitting, when $X_1=F$, Y has two values. Therefore, $P(Y=T|X_1=F) = 1/2$ and $P(Y=F|X_1=T) = 1/2$.</p><p>We can jave the following entropy when $X_1=F$:</p><p>$$<br>H(Y|X_1=T)=-\sum^{n}_{i=1}P(y_i|X_1=F)log_2P(y_i|X_1=F)<br>$$</p><p>$$<br>H(Y|X_1=T)=-\frac{1}{2}log_2(\frac{1}{2})-\frac{1}{2}log_2(\frac{1}{2}) \approx 0.3<br>$$</p><h3 id="Entropy-after-split"><a href="#Entropy-after-split" class="headerlink" title="Entropy after split"></a>Entropy after split</h3><table><thead><tr><th align="center">$X_1$</th><th align="center">Y</th></tr></thead><tbody><tr><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">F</td></tr><tr><td align="center">F</td><td align="center">T</td></tr><tr><td align="center">F</td><td align="center">F</td></tr></tbody></table><p>We get $P(X_1=T)=3/5$ and $P(X_1=F)=2/5$. We have the following overall conditional entropy:</p><p>$$<br>H(Y|X_1)=\frac{3}{5}<em>0.28+\frac{2}{5}</em>0.3=0.288<br>$$</p><h2 id="Information-Gain"><a href="#Information-Gain" class="headerlink" title="Information Gain"></a>Information Gain</h2><p>Information Gain $I(X,Y)$ is defined as the expected reduction in entropy of target varible Y after split over variable X.</p><p>$$<br>I(X,Y)=H(Y)-H(Y|X)<br>$$</p><p>In the previous example, we can get the infromation gain is:</p><p>$$<br>I(X_1,Y)=H(Y)-H(Y|X_1)=0.292-0.288\approx0.004<br>$$</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Entropy&quot;&gt;&lt;a href=&quot;#Entropy&quot; class=&quot;headerlink&quot; title=&quot;Entropy&quot;&gt;&lt;/a&gt;Entropy&lt;/h1&gt;&lt;p&gt;Entropy can be used as a measure of uncertainty in
      
    
    </summary>
    
    
      <category term="COMP" scheme="https://shunyangli.github.io/categories/COMP/"/>
    
    
      <category term="COMP" scheme="https://shunyangli.github.io/tags/COMP/"/>
    
  </entry>
  
  <entry>
    <title>Upload Large File</title>
    <link href="https://shunyangli.github.io/post/4707/"/>
    <id>https://shunyangli.github.io/post/4707/</id>
    <published>2022-04-30T14:30:48.000Z</published>
    <updated>2022-06-14T06:41:24.988Z</updated>
    
    <content type="html"><![CDATA[<p>python实现大文件切片上传。有段时间没学习一下新东西了，最近偶尔在学习一下并行和分布式的东西。大文件上传的方式有点并行处理的那味道。所以就抽时间写了一点python实现大文件上传，代码写的比较简陋，大家感兴趣的可以自己实现一个。大部分上传文件其实是在前端实现的，但是原理都差不多，知道懂原理实现就很简单。</p><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>文件上传这个需求在哪都有，网盘，上传各种文件等等。在文件比较大的时候有一些比较容易遇到的问题：</p><ol><li>超时。因为前端或者后端代理都有限制最长请求时间，一旦超时文件就没办法长上传成功。</li><li>大小限制。一般后端对上传文件大小会有一定限制。</li></ol><p>当然我们可以通过调整最大请求时间和大小限制来解决这个问题，但是会对服务器造成负载。上传失败重来这玩意有点头大。</p><h2 id="文件切片"><a href="#文件切片" class="headerlink" title="文件切片"></a>文件切片</h2><p>我们可以通过把文件切分成若干个小文件，并且把这些小文件并行的上传到后台，这样的话会节省大量的时间。当上传完成之后，后台会对这些若干个小文件进行合并。这个有点类似分布式（HDFS）的储存方法。</p><p>我们可以把文件读取成bytes格式，然后对这些bytes进行切片：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">split</span><span class="params">(filename)</span>:</span></span><br><span class="line">    CHUNSIZE = <span class="number">1024</span> * <span class="number">1024</span></span><br><span class="line">    file_size = os.stat(filename).st_size</span><br><span class="line">    f = open(filename, <span class="string">'rb'</span>)</span><br><span class="line">    data = f.read()</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"file size: "</span>, file_size)</span><br><span class="line"></span><br><span class="line">    cursor = <span class="number">0</span></span><br><span class="line">    chunk_list = []</span><br><span class="line">    <span class="keyword">while</span> cursor &lt;= file_size:</span><br><span class="line">        chunk_list.append(data[cursor:cursor + CHUNSIZE]) </span><br><span class="line">        cursor = cursor + CHUNSIZE</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"chunk number: "</span>, len(chunk_list))</span><br></pre></td></tr></table></figure><p>我们可以根据网络状态，文件大小等因素来决定<code>CHUNSIZE</code>的大小。为了方便实现，我这里直接固定了切片的大小。在上传到后台的时候我们需要考虑切片文件的顺序，不然可能会导致文件发生错误，当然这个是后台需要实现的功能，可以稍后讨论。为了让资源得到充分利用我们可以使用多线程进行上传，如果是前端可以采用异步的方式。在这里我用的是<code>Thread</code>的方式实现多线程上传。</p><h2 id="文件合并"><a href="#文件合并" class="headerlink" title="文件合并"></a>文件合并</h2><p>文件合并常见的方式有：</p><ol><li>上传完所有的小文件之后发送一个请求来合并文件，请求的时候可以传递合并之后文件的名字。</li><li>后台记录切片的<code>index</code>，当达到末尾的时候自动合并。</li></ol><p>在这里我实现的是第一种方法（因为懒/(ㄒoㄒ)/~~）。</p><p>先简单介绍一个文件合并的原理，先把所有切分的文件根据bytes的格式读取，然后把这些读取的bytes按照顺序写入到新的文件中：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f = open(<span class="string">'./xx.tar.bz2'</span>, <span class="string">'ab'</span>)</span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> chunk_list:</span><br><span class="line">    f.write(chunk)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><p>当把所有的文件都写入到文件之后就成功把这个文件合并了。注意：<code>ab</code>表示appending bytes。</p><h2 id="文件秒传"><a href="#文件秒传" class="headerlink" title="文件秒传"></a>文件秒传</h2><p>文件秒传是指如果后台已经有一个一样的文件，那么就没必要再次上传，直接返回上传成功即可。这个功能还是比较使用的，比如某盘的资源共享等等。</p><p>妙传的关键在于文件的唯一标识。我们可以根据文件的二进制编码进行计算hash值，用来当作文件的唯一标识。通常使用的算法是<code>md5</code>。对于<code>md5</code>算法，我们也有两种不同的方式去计算文件的hahs值。第一种是直接计算。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">f = open(filename, <span class="string">'rb'</span>).read()</span><br><span class="line">md5 = hashlib.md5(f)</span><br><span class="line">hash = md5.hexdigest()</span><br><span class="line">print(hash)</span><br></pre></td></tr></table></figure><p>第二种根据每行数据进行update hash值：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">md5 = hashlib.md5()</span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> lines:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        md5.update(line)</span><br><span class="line">hash = md5.hexdigest()</span><br><span class="line">print(hash)</span><br></pre></td></tr></table></figure><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>总体代码实现如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Upload</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, filename, url, CHUNSIZE=<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">30</span>)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.filename = filename</span><br><span class="line">        self.url = url</span><br><span class="line">        self.md5 = <span class="string">""</span></span><br><span class="line">        self.chunk_list = []</span><br><span class="line">        self.CHUNSIZE = CHUNSIZE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">md5_small</span><span class="params">(self)</span>:</span></span><br><span class="line">        f = open(self.filename, <span class="string">'rb'</span>).read()</span><br><span class="line">        md5 = hashlib.md5(f)</span><br><span class="line">        self.md5 = md5.hexdigest()</span><br><span class="line">        print(md5.hexdigest())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">md5_large</span><span class="params">(self)</span>:</span></span><br><span class="line">        md5 = hashlib.md5()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> open(self.filename, <span class="string">'rb'</span>) <span class="keyword">as</span> lines:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">                md5.update(line)</span><br><span class="line">        </span><br><span class="line">        self.md5 = md5.hexdigest()</span><br><span class="line">        print(md5.hexdigest())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">split</span><span class="params">(self)</span>:</span></span><br><span class="line">        file_size = os.stat(self.filename).st_size</span><br><span class="line">        f = open(self.filename, <span class="string">'rb'</span>)</span><br><span class="line">        data = f.read()</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"file size: "</span>, file_size)</span><br><span class="line"></span><br><span class="line">        cursor = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> cursor &lt;= file_size:</span><br><span class="line">            self.chunk_list.append(data[cursor:cursor + self.CHUNSIZE]) </span><br><span class="line">            cursor = cursor + self.CHUNSIZE</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"chunk number: "</span>, len(self.chunk_list))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">async_upload</span><span class="params">(self, chunks, offset, filename=<span class="string">"upt"</span>)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> index, chunk <span class="keyword">in</span> enumerate(chunks):</span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">'index'</span>: index + offset,</span><br><span class="line">                <span class="string">'chunk'</span>: chunk.decode(<span class="string">'latin-1'</span>),</span><br><span class="line">                <span class="string">'filename'</span>: filename</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            response = requests.get(</span><br><span class="line">                url=<span class="string">'&#123;&#125;/upload'</span>.format(self.url),</span><br><span class="line">                data=json.dumps(data),</span><br><span class="line">                headers = &#123;</span><br><span class="line">                    <span class="string">'Accept'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">                    <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            print(response)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        merge is not belong to this part</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"path"</span>: <span class="string">"upt"</span>,</span><br><span class="line">            <span class="string">"filename"</span>: <span class="string">"xx.tar.bz2"</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.get(</span><br><span class="line">            url=<span class="string">'&#123;&#125;/merge'</span>.format(self.url),</span><br><span class="line">            data=json.dumps(data),</span><br><span class="line">            headers = &#123;</span><br><span class="line">                <span class="string">'Accept'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">                <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        print(response)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">(self)</span>:</span></span><br><span class="line">        TREADNUM = <span class="number">3</span></span><br><span class="line">        CHUNKSIZE = len(self.chunk_list)</span><br><span class="line">        PERSIZE = int(CHUNKSIZE / TREADNUM)</span><br><span class="line">        threads = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, CHUNKSIZE, PERSIZE):</span><br><span class="line">            t = Thread(target=self.async_upload, args=[self.chunk_list[i : i + PERSIZE], i])</span><br><span class="line">            t.start()</span><br><span class="line">            threads.append(t)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">                <span class="keyword">if</span> t.is_alive():</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        print(<span class="string">"Finish"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    upload = Upload(<span class="string">'comp-books-master.zip'</span>, <span class="string">'http://127.0.0.1:5000'</span>)</span><br><span class="line">    upload.split()</span><br><span class="line">    upload.upload()</span><br><span class="line">    <span class="comment"># upload.merge()</span></span><br></pre></td></tr></table></figure><p>后台模拟代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">CURR = os.getcwd()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/upload', methods=["POST","GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    data = request.get_json()</span><br><span class="line">    index = data[<span class="string">'index'</span>]</span><br><span class="line">    chunk = data[<span class="string">'chunk'</span>]</span><br><span class="line">    filename = data[<span class="string">'filename'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(os.path.join(CURR, filename)):</span><br><span class="line">        os.mkdir(os.path.join(CURR, filename))</span><br><span class="line">    </span><br><span class="line">    f = open(os.path.join(CURR, filename, str(index)), <span class="string">'ab'</span>)</span><br><span class="line">    f.write(chunk.encode(<span class="string">'latin-1'</span>))</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"SUCCESS"</span>, <span class="number">200</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/merge', methods=["POST","GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">meger</span><span class="params">()</span>:</span></span><br><span class="line">    data = request.get_json()</span><br><span class="line">    mp = data[<span class="string">'path'</span>]</span><br><span class="line">    filename = data[<span class="string">'filename'</span>]</span><br><span class="line"></span><br><span class="line">    f = open(filename, <span class="string">'ab'</span>)</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(os.path.join(CURR, mp)):</span><br><span class="line">        tf = open(os.path.join(CURR, mp, file), <span class="string">'rb'</span>)</span><br><span class="line">        f.write(tf.read())</span><br><span class="line">        tf.close()</span><br><span class="line">    </span><br><span class="line">    f.close()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">"SUCCESS"</span>, <span class="number">200</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;python实现大文件切片上传。有段时间没学习一下新东西了，最近偶尔在学习一下并行和分布式的东西。大文件上传的方式有点并行处理的那味道。所以就抽时间写了一点python实现大文件上传，代码写的比较简陋，大家感兴趣的可以自己实现一个。大部分上传文件其实是在前端实现的，但是原理
      
    
    </summary>
    
    
    
      <category term="backend" scheme="https://shunyangli.github.io/tags/backend/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode Part 2</title>
    <link href="https://shunyangli.github.io/post/b672/"/>
    <id>https://shunyangli.github.io/post/b672/</id>
    <published>2022-02-26T03:30:31.000Z</published>
    <updated>2022-06-14T06:41:24.828Z</updated>
    
    <content type="html"><![CDATA[<p>An extension of <a href="https://shunyangli.github.io/2020/05/26/leetcode/#more">leetcode</a>. Keep working on leetcode.</p><h1 id="Daily-Temperatures"><a href="#Daily-Temperatures" class="headerlink" title="Daily Temperatures"></a>Daily Temperatures</h1><p><a href="https://leetcode.com/problems/daily-temperatures/" target="_blank" rel="noopener">Daily Temperatures</a>: Given a list of daily temperatures T, return a list such that, for each day in the input, tells you how many days you would have to wait until a warmer temperature. If there is no future day for which this is possible, put 0 instead.</p><p>For example, given the list of temperatures T = [73, 74, 75, 71, 69, 72, 76, 73], your output should be [1, 1, 4, 2, 1, 1, 0, 0].</p><h2 id="Brute-Force"><a href="#Brute-Force" class="headerlink" title="Brute Force"></a>Brute Force</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dailyTemperatures</span><span class="params">(self, T: List[int])</span> -&gt; List[int]:</span></span><br><span class="line">        num = len(T) - <span class="number">1</span></span><br><span class="line">        data = [<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(T) - <span class="number">2</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> T[i] &gt;= T[num]:</span><br><span class="line">                data.insert(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">                num = i</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                count = <span class="number">1</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(i + <span class="number">1</span>, num + <span class="number">1</span>):</span><br><span class="line">                    <span class="keyword">if</span> T[j] &lt;= T[i]:</span><br><span class="line">                        count += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                data.insert(<span class="number">0</span>, count)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure><p>However, the worst time complexity is $O(N^2)$. The code can not pass one of the complex test case which is (Time Limit Exceeded).</p><h2 id="Advance-Approach"><a href="#Advance-Approach" class="headerlink" title="Advance Approach"></a>Advance Approach</h2><p>Stack can be used to improve the efficiency of this issue. We use stack to store a key-value temperature with decreasing order where key is the index of temperature, and value is the temperature. The time complexity of this approache is $O(N)$. For example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Temperature: [73, 74, 75, 71, 69, 72, 76, 73]</span><br><span class="line">stack = []</span><br><span class="line">res = [0, 0, 0, 0, 0, 0, 0, 0]</span><br><span class="line"></span><br><span class="line">1. index = 0</span><br><span class="line">stack = [(0, 73)]</span><br><span class="line"></span><br><span class="line">2. index = 1</span><br><span class="line">74 &gt; 73, pop (0, 73) and set res[0] = index - 0</span><br><span class="line">stack = [(1, 74)]</span><br><span class="line">res = [1, 0, 0, 0, 0, 0, 0, 0]</span><br><span class="line"></span><br><span class="line">3. index = 2</span><br><span class="line">75 &gt; 74, pop (1, 74) and set res[1] = index - 1</span><br><span class="line">stack = [(2, 75)]</span><br><span class="line">res = [1, 1, 0, 0, 0, 0, 0, 0]</span><br><span class="line"></span><br><span class="line">4. index = 3</span><br><span class="line">71 &lt; 75, add (3, 71) into stack</span><br><span class="line">stack = [(2, 75), (3, 71)]</span><br><span class="line"></span><br><span class="line">5. index = 4</span><br><span class="line">69 &lt; 71, add (3, 69) into stack</span><br><span class="line">stack = [(2, 75), (3, 71), (4, 69)]</span><br><span class="line"></span><br><span class="line">6. index = 5</span><br><span class="line">72 &lt; 69, pop (4, 69) and (3, 71), set res[4] = index - 4, and res[3] = index - 3</span><br><span class="line">stack = [(2, 75), (5, 72)]</span><br><span class="line">res = [1, 1, 0, 2, 1, 0, 0, 0]</span><br><span class="line"></span><br><span class="line">7. index = 6</span><br><span class="line">76 &gt; 72 pop (5, 72) and (2, 75), set res[5] = index - 5, and res[2] = index -2</span><br><span class="line">stack = []</span><br><span class="line">res = [1, 1, 4, 2, 1, 1, 0, 0]</span><br></pre></td></tr></table></figure><p>And implementation is:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dailyTemperatures</span><span class="params">(self, T: List[int])</span> -&gt; List[int]:</span></span><br><span class="line">        stack = []</span><br><span class="line">        res = [<span class="number">0</span>] * len(T)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(T)):</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> stack <span class="keyword">and</span> stack[<span class="number">-1</span>][<span class="number">1</span>] &lt; T[i]:</span><br><span class="line">                index, val = stack.pop()</span><br><span class="line">                res[index] = i - index</span><br><span class="line"></span><br><span class="line">            stack.append((i, T[i]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h1 id="Minimum-Size-Subarray-Sum"><a href="#Minimum-Size-Subarray-Sum" class="headerlink" title="Minimum Size Subarray Sum"></a>Minimum Size Subarray Sum</h1><p><a href="https://leetcode.com/problems/minimum-size-subarray-sum/submissions/" target="_blank" rel="noopener">Minimum Size Subarray Sum</a>: Given an array of positive integers nums and a positive integer target, return the minimal length of a contiguous subarray [numsl, numsl+1, …, numsr-1, numsr] of which the sum is greater than or equal to target. If there is no such subarray, return 0 instead.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: target = 7, nums = [2,3,1,2,4,3]</span><br><span class="line">Output: 2</span><br><span class="line">Explanation: The subarray [4,3] has the minimal length under the problem constraint.</span><br></pre></td></tr></table></figure><h2 id="Brute-Force-1"><a href="#Brute-Force-1" class="headerlink" title="Brute Force"></a>Brute Force</h2><p>The basic approach is to use two loops to solve that. The time complexity of this approach is $O(N^2)$. It will cause time limit exceeded.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minSubArrayLen</span><span class="params">(self, target: int, nums: List[int])</span> -&gt; int:</span></span><br><span class="line">        length = <span class="number">9999</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(nums)):</span><br><span class="line">            res = nums[i]</span><br><span class="line">            <span class="keyword">if</span> res &gt;= target:</span><br><span class="line">                length = <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i + <span class="number">1</span>, len(nums)):</span><br><span class="line">                res += nums[j]</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> res &gt;= target:</span><br><span class="line">                    length = min(length, j - i + <span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> length <span class="keyword">if</span> length != <span class="number">9999</span> <span class="keyword">else</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="Advance-Approach-1"><a href="#Advance-Approach-1" class="headerlink" title="Advance Approach"></a>Advance Approach</h2><p><img src="/post/b672/1.png" alt><br>To solve this issue, we can use <strong>Sliding Window</strong> to solve this issue. This method is similar to the double pointer. The <code>index</code> the left index of this array. When the sum between <code>i</code> and <code>index</code> is greater or equal to the target, then advance <code>i</code> and <code>index</code> to find other positions that sum is greater or equal to the target. The basic idea of sliding windows is shown in the Figure.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minSubArrayLen</span><span class="params">(self, target: int, nums: List[int])</span> -&gt; int:</span></span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        min_len = <span class="number">99999999</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(nums)):</span><br><span class="line">            res += nums[i]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> res &gt;= target:</span><br><span class="line">                length = i - index + <span class="number">1</span></span><br><span class="line">                min_len = min(length, min_len)</span><br><span class="line">                res -= nums[index]</span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> min_len <span class="keyword">if</span> min_len != <span class="number">99999999</span> <span class="keyword">else</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h1 id="Valid-Anagram"><a href="#Valid-Anagram" class="headerlink" title="Valid Anagram"></a>Valid Anagram</h1><p>Given two strings <code>s</code> and <code>t</code>, return true if <code>t</code> is an anagram of <code>s</code>, and false otherwise.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Input: s = &quot;anagram&quot;, t = &quot;nagaram&quot;</span><br><span class="line">Output: true</span><br><span class="line">Input: s = &quot;rat&quot;, t = &quot;car&quot;</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><h2 id="Brute-Force-2"><a href="#Brute-Force-2" class="headerlink" title="Brute Force"></a>Brute Force</h2><p>This issue can be solved by using two loop. But the time complexity is $O(N)$. In addition, it also can be done through sort algorithm, to check whether same. But it is too complex. Here we did not code for this approache.</p><h2 id="Advance-Approach-2"><a href="#Advance-Approach-2" class="headerlink" title="Advance Approach"></a>Advance Approach</h2><p>We can use <code>hashmap</code> to record that how many times they appeared in the string. Therefore, the time complexity is $O(N)$.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isAnagram</span><span class="params">(self, s: str, t: str)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> len(s) != len(t):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        data = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                data[i] = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                data[i] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> t:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> data[i] == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    data[i] -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> key, val <span class="keyword">in</span> data.items():</span><br><span class="line">            <span class="keyword">if</span> data[key] != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><h1 id="Combinations"><a href="#Combinations" class="headerlink" title="Combinations"></a>Combinations</h1><p>Given two integers <code>n</code> and <code>k</code>, return all possible combinations of <code>k</code> numbers out of the range <code>[1, n]</code>. You may return the answer in any order. For example</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Input: n = 4, k = 2</span><br><span class="line">Output:</span><br><span class="line">[</span><br><span class="line">  [2,4],</span><br><span class="line">  [3,4],</span><br><span class="line">  [2,3],</span><br><span class="line">  [1,2],</span><br><span class="line">  [1,3],</span><br><span class="line">  [1,4],</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>It is pretty hard to use loop to solve this issue. Beacause the <code>k</code> determine the number of nested loop, when <code>k=2</code> then it should have three nested loop. However, when k in not a const number, then we can not determine how many loops we need.</p><p>Therefore, we can use recursion to do this kind of issues. We can seen it as a tree as shown in the Figure. The root node is <code>1-n</code> and the deep is <code>k</code>. Pick up the number from left to right without repeating. We can set up a <code>path</code> to record the visited path, and when the length of <code>path</code> is equal to <code>k</code> then add the <code>path</code> to result.</p><p><img src="/post/b672/1.png" alt></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">combine</span><span class="params">(self, n: int, k: int)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">back_tracking</span><span class="params">(n, k, index, path, result)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> len(path) == k:</span><br><span class="line">                result.append([i <span class="keyword">for</span> i <span class="keyword">in</span> path])</span><br><span class="line">                <span class="keyword">return</span> path</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(index + <span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">                path.append(i)</span><br><span class="line">                back_tracking(n, k, i, path, result)</span><br><span class="line">                path.pop()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> back_tracking(n, k, <span class="number">0</span>, [], [])</span><br></pre></td></tr></table></figure><h1 id="Combination-Sum-III"><a href="#Combination-Sum-III" class="headerlink" title="Combination Sum III"></a>Combination Sum III</h1><p><a href="https://leetcode.com/problems/combination-sum-iii/" target="_blank" rel="noopener">Combination Sum III</a>: Find all valid combinations of k numbers that sum up to n such that the following conditions are true:</p><ul><li>Only numbers 1 through 9 are used.</li><li>Each number is used at most once.</li></ul><p>Return a list of all possible valid combinations. The list must not contain the same combination twice, and the combinations may be returned in any order. For example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Input: k = 3, n = 7</span><br><span class="line">Output: [[1,2,4]]</span><br><span class="line">Explanation:</span><br><span class="line">1 + 2 + 4 = 7</span><br><span class="line">There are no other valid combinations.</span><br></pre></td></tr></table></figure><p>This question is pretty similar with the previous one, just add one more constrain (sum = n).</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">combinationSum3</span><span class="params">(self, k: int, n: int)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">combine</span><span class="params">(k, n, index, path, result)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> len(path) == k:</span><br><span class="line">                <span class="keyword">if</span> sum(path) == n:</span><br><span class="line">                    result.append([i <span class="keyword">for</span> i <span class="keyword">in</span> path])</span><br><span class="line">                <span class="keyword">return</span> path</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(index, <span class="number">10</span>):</span><br><span class="line">                path.append(i)</span><br><span class="line">                combine(k, n, i + <span class="number">1</span>, path, result)</span><br><span class="line"></span><br><span class="line">                path.pop()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> combine(k, n, <span class="number">1</span>, [], [])</span><br></pre></td></tr></table></figure><h1 id="Valid-Palindrome"><a href="#Valid-Palindrome" class="headerlink" title="Valid Palindrome"></a>Valid Palindrome</h1><p><a href="https://leetcode.com/problems/valid-palindrome/" target="_blank" rel="noopener">Valid Palindrome</a>: Given a string s, determine if it is a palindrome, considering only alphanumeric characters and ignoring cases.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: s = &quot;A man, a plan, a canal: Panama&quot;</span><br><span class="line">Output: true</span><br><span class="line">Explanation: &quot;amanaplanacanalpanama&quot; is a palindrome.</span><br></pre></td></tr></table></figure><p>This one is pretty easy, we just need to ignore the char which is not belong to <code>a-z, 0-9</code>. During the processing, we can use double pointer to do that. Set a index from the left and a index from the right.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isPalindrome</span><span class="params">(self, s: str)</span> -&gt; bool:</span></span><br><span class="line">        s = s.lower()</span><br><span class="line">        start = <span class="number">0</span></span><br><span class="line">        end = len(s) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> start &lt;= end:</span><br><span class="line">            l = s[start]</span><br><span class="line">            r = s[end]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> l.isalnum():</span><br><span class="line">                start += <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> r.isalnum():</span><br><span class="line">                end -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> s[start] != s[end]:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">            start += <span class="number">1</span></span><br><span class="line">            end -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><h1 id="Next-Greater-Node-In-Linked-List"><a href="#Next-Greater-Node-In-Linked-List" class="headerlink" title="Next Greater Node In Linked List"></a>Next Greater Node In Linked List</h1><p><a href="https://leetcode.com/problems/next-greater-node-in-linked-list/" target="_blank" rel="noopener">Next Greater Node In Linked List</a> is a medium problem.<br>We are given a linked list with <code>head</code> as the first node.  Let’s number the nodes in the list: <code>node_1, node_2, node_3, ... etc.</code></p><p>Each node may have a next larger value: for node_i, next_larger(node_i) is the node_j.val such that <code>j &gt; i</code>, <code>node_j.val &gt; node_i.val,</code> and <code>j</code> is the smallest possible choice.  If such a j does not exist, the next larger value is 0.</p><p>Return an array of integers answer, where <code>answer[i] = next_larger(node_{i+1})</code>.</p><p>Note that in the example inputs (not outputs) below, arrays such as <code>[2,1,5]</code> represent the serialization of a linked list with a head node value of 2, second node value of 1, and third node value of 5.</p><h2 id="Approach"><a href="#Approach" class="headerlink" title="Approach"></a>Approach</h2><p>This problem is pretty similar with <a href="https://leetcode.com/problems/daily-temperatures/" target="_blank" rel="noopener">Daily Temperatures</a> which can be solved by applying stack. For this issue, we can use <code>stack</code> + <code>hashmap</code> to solve it with $O(n)$ time complexity.</p><ol><li>Init stack and the final result.</li><li><code>result</code>(hashmap) will recored the index as key and greater or 0 value as the value</li><li>When the <code>temp</code> node value is greater then the top value of the stack, update the <code>result</code> value and pop the top value of stack.</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"># class ListNode:</span></span><br><span class="line"><span class="comment">#     def __init__(self, val=0, next=None):</span></span><br><span class="line"><span class="comment">#         self.val = val</span></span><br><span class="line"><span class="comment">#         self.next = next</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">nextLargerNodes</span><span class="params">(self, head: ListNode)</span> -&gt; List[int]:</span></span><br><span class="line">        stack = []</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        temp = head</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># stack store like (val, pos)</span></span><br><span class="line">        <span class="keyword">while</span> (temp != <span class="literal">None</span>):</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">while</span> len(stack) != <span class="number">0</span> <span class="keyword">and</span> temp.val &gt; stack[len(stack) - <span class="number">1</span>][<span class="number">0</span>]:</span><br><span class="line">                result[stack[len(stack) - <span class="number">1</span>][<span class="number">1</span>]] = temp.val</span><br><span class="line">                stack.pop(len(stack) - <span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">            stack.append((temp.val, index))</span><br><span class="line">            result[index] = <span class="number">0</span></span><br><span class="line">            </span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">            temp = temp.next</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result.values()</span><br></pre></td></tr></table></figure><p>We can use the following data to give an example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [2,1,5]</span><br><span class="line">Output: [5,5,0]</span><br></pre></td></tr></table></figure><p>In the following part, we will display the <code>result</code> and <code>stack</code> storage.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1. stack.push((2, 0)) stack = [(2, 0)], result = &#123;0: 0&#125;</span><br><span class="line"></span><br><span class="line">2. stack.push((1, 1)), stack = [(2, 0), (1, 1)], result = &#123;0: 0, 1: 0&#125;</span><br><span class="line"></span><br><span class="line">3. The node value is 5, greater than 1, then</span><br><span class="line">    1. top value of stack is (1, 1), then result[1] = node.val (5), stack pop (1, 1)</span><br><span class="line">    2. top value of stack is (2, 0), then result[0] = node.val (5), stack pop (2, 0)</span><br><span class="line">    3. End while loop, and insert the (5, 3) into stack and result.</span><br><span class="line"></span><br><span class="line">The final value in result is:</span><br><span class="line">result = &#123;</span><br><span class="line">    0: 5,</span><br><span class="line">    1: 5,</span><br><span class="line">    2: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="How-Many-Numbers-Are-Smaller-Than-the-Current-Number"><a href="#How-Many-Numbers-Are-Smaller-Than-the-Current-Number" class="headerlink" title="How Many Numbers Are Smaller Than the Current Number"></a>How Many Numbers Are Smaller Than the Current Number</h1><p><a href="https://leetcode.com/problems/how-many-numbers-are-smaller-than-the-current-number/" target="_blank" rel="noopener">How Many Numbers Are Smaller Than the Current Number</a> is an easy problem. Howerver, it is more interesting than other questions.</p><p>Given the array nums, for each <code>nums[i]</code> find out how many numbers in the array are smaller than it. That is, for each <code>nums[i]</code> you have to count the number of valid j’s such that <code>j != i</code> and <code>nums[j] &lt; nums[i]</code>.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Input: nums = [8,1,2,2,3]</span><br><span class="line">Output: [4,0,1,1,3]</span><br><span class="line">Explanation: </span><br><span class="line">For nums[0]=8 there exist four smaller numbers than it (1, 2, 2 and 3). </span><br><span class="line">For nums[1]=1 does not exist any smaller number than it.</span><br><span class="line">For nums[2]=2 there exist one smaller number than it (1). </span><br><span class="line">For nums[3]=2 there exist one smaller number than it (1). </span><br><span class="line">For nums[4]=3 there exist three smaller numbers than it (1, 2 and 2).</span><br></pre></td></tr></table></figure><h2 id="Approach-1"><a href="#Approach-1" class="headerlink" title="Approach"></a>Approach</h2><p>Naive approach is brute force. Just use two nest loop can get the result.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">result = []</span><br><span class="line">for i in range(0, len(nums)):</span><br><span class="line">    num = 0</span><br><span class="line">    for j in range(i, len(nums)):</span><br><span class="line">        if nums[i] &gt; nums[j]:</span><br><span class="line">            num += 1</span><br><span class="line">    result.append(num)</span><br></pre></td></tr></table></figure><p>The time complexity is <code>O(n^2)</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;An extension of &lt;a href=&quot;https://shunyangli.github.io/2020/05/26/leetcode/#more&quot;&gt;leetcode&lt;/a&gt;. Keep working on leetcode.&lt;/p&gt;
&lt;h1 id=&quot;Dail
      
    
    </summary>
    
    
      <category term="leetcode" scheme="https://shunyangli.github.io/categories/leetcode/"/>
    
    
      <category term="leetcode" scheme="https://shunyangli.github.io/tags/leetcode/"/>
    
      <category term="algorithm" scheme="https://shunyangli.github.io/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Nano Editor</title>
    <link href="https://shunyangli.github.io/post/943f/"/>
    <id>https://shunyangli.github.io/post/943f/</id>
    <published>2022-02-08T08:49:26.000Z</published>
    <updated>2022-06-14T06:41:24.838Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="https://www.nano-editor.org/" target="_blank" rel="noopener">Nano</a> is a text editor for terminals.</p><h1 id="Open-and-create-files"><a href="#Open-and-create-files" class="headerlink" title="Open and create files"></a>Open and create files</h1><p>Open or create new files, you can type the following command:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano filename</span><br></pre></td></tr></table></figure><p>This will open a new editor window and you can start editing the file. At the bottom of the window, the most basic command shortcuts that can be used with the nano editor are listed. <code>^</code> means <code>Ctrl</code> keys (e.g., <code>^X</code> = <code>Ctrl + X</code>).</p><h1 id="Search-and-replace"><a href="#Search-and-replace" class="headerlink" title="Search and replace"></a>Search and replace</h1><p>You can use <code>Ctrl + w</code> to search key words, it will match the first key word. Then you can use <code>Alt + w</code> to move to the next key word.</p><p>To search and replace, press <code>Ctrl + \</code>. Enter the search term and the text to be replaced. The editor will move to the first match and ask if you want to replace it. y or n will move to the next match. Pressing A will replace all matches.</p><h1 id="Save-and-exit"><a href="#Save-and-exit" class="headerlink" title="Save and exit"></a>Save and exit</h1><p>To save changes made to a file, press <code>Ctrl + o</code>. If the file does not yet exist, it will be created immediately after saving.</p><p>To exit nano, press <code>Ctrl + x</code>. If there are unsaved changes, you will be asked if you want to save the changes (<code>Y</code> means save, <code>N</code> means not save).</p><p>To save a file, you must have write access to the file. To create a new file, you need to have write access to the directory where the file will be createde</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://www.nano-edit
      
    
    </summary>
    
    
      <category term="tool" scheme="https://shunyangli.github.io/categories/tool/"/>
    
    
      <category term="tool" scheme="https://shunyangli.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>Hadoop Partition</title>
    <link href="https://shunyangli.github.io/post/8700/"/>
    <id>https://shunyangli.github.io/post/8700/</id>
    <published>2021-10-13T13:11:54.000Z</published>
    <updated>2022-06-14T06:41:24.338Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hadoop-Partition-And-Secondary-Sort"><a href="#Hadoop-Partition-And-Secondary-Sort" class="headerlink" title="Hadoop Partition And Secondary Sort"></a>Hadoop Partition And Secondary Sort</h1><p>This article will describe an implementation and process of Hadoop partitioning and secondary sorting. First we need to briefly understand the workflow of Hadoop map-reduce task. In the <a href="https://shunyangli.github.io/2021/09/08/Hadoop-Distributed-System/#more">previous article</a>, we briefly explained the operation mechanism of Hadoop. The mapper task will read the file and process the data, after processing the mapper task will pass the result to the shuffle. shuffle will sort and partition all the map task results, and then will pass the partitioned and sorted data to the reducer, the key-value pairs with the same key will be passed to the same reducer. </p><p><img src="/post/8700/1.png" alt></p><p> The default distribution method used by hadoop is based on the hash value, but in practice, this is not very efficient or performs the task as we require. For example, after partitioning, one node’s reducer is assigned 20 records while the other is assigned 10 million records, so imagine how inefficient this is. Or, we want to process the output file according to a certain rule, assuming there are two reducers, we want the final result to store the results of records starting with “a” in part-00000, and other results in part-00001, the default partitioner is unable to do. So we need to customize our own partition to choose the reducer of records according to our own requirements.</p><h1 id="Why-partition"><a href="#Why-partition" class="headerlink" title="Why partition"></a>Why partition</h1><p>We want to use Hadoop to get a ordered file by using a partition (because it will be sorted before partitioning).  However if the input is huge (e.g. 10 GB), the performance of reducer is pretty inefficient which completely losing the advantage of the parallel architecture provided by MapReduce. We can use a partitioner to sort the data, so that when the reducer processes the data, it can be guaranteed that the data is already sorted. One partition corresponds to one reducer, so all the output of the reducer is ordered, we just need to merge all the output files, then the total file must be ordered.</p><h1 id="Hadoop-Streaming-Partition"><a href="#Hadoop-Streaming-Partition" class="headerlink" title="Hadoop Streaming Partition"></a>Hadoop Streaming Partition</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mapred streaming \</span><br><span class="line"> -D mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapreduce.lib.partition.KeyFieldBasedComparator \</span><br><span class="line"> -D stream.map.output.field.separator=, \</span><br><span class="line"> -D stream.num.map.output.key.fields=2 \</span><br><span class="line"> -D mapreduce.map.output.key.field.separator=,\</span><br><span class="line"> -D mapreduce.partition.keycomparator.options=-k2,2nr \</span><br><span class="line"> -D mapreduce.job.reduces=2\</span><br><span class="line"> -input input</span><br><span class="line"> -output output \</span><br><span class="line"> -mapper /bin/cat \</span><br><span class="line"> -reducer /bin/cat \</span><br><span class="line"> -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-D map.output.key.field.separator=, means the separator for the key is “,”</span><br><span class="line">-D stream.num.map.output.key.fields=2 means the prefix up to the second “,” in a line will be the key and the rest of the line (excluding the second “,”) will be the value.</span><br><span class="line"></span><br><span class="line">e.g.:</span><br><span class="line">1,2,3 then &apos;map.output.key.field.separator&apos; split the input by , and &apos;stream.num.map.output.key.fields=2&apos; will set (1,2) is the key and 3 is the value</span><br><span class="line"></span><br><span class="line">-D map.output.key.field.separator=, means the separator for the key is also “,”</span><br><span class="line"></span><br><span class="line">-D mapreduce.partition.keypartitioner.options=-k1,2” means</span><br><span class="line">MapReduce will partition the map outputs by the first two fields of the keys</span><br></pre></td></tr></table></figure><p>For example, the input files is like this, name (input.txt)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">muse,curious,1</span><br><span class="line">muse,days,2</span><br><span class="line">muse,do,3</span><br><span class="line">muse,growing,4</span><br><span class="line">muse,grown,5</span><br><span class="line">muse,in,1</span><br><span class="line">cat,invent,2</span><br><span class="line">muse,more,3</span><br><span class="line">muse,please,4</span><br><span class="line">cat,subject,5</span><br><span class="line">cat,ten,2</span><br><span class="line">muse,these,3</span><br><span class="line">muse,this,2</span><br><span class="line">muse,times,5</span><br><span class="line">muse,to,6</span><br><span class="line">cat,want,8</span><br><span class="line">muse,with,9</span><br><span class="line">muse,worth,0</span><br><span class="line">muse,*,10</span><br><span class="line">muse,age,12</span><br></pre></td></tr></table></figure><p>Put this file into hdfs:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -put input.txt input</span><br></pre></td></tr></table></figure><p>We partition by two different ranges of keys (mapreduce.partition.keypartitioner.options) (e.g.: key is (muse, curious) value is 1), and we get two different results.</p><p>The first command is partition based the first filed in the key.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hadoop jar $HADOOP_HOME/share/hadoop/tools/lib/hadoop-streaming-*.jar \</span><br><span class="line">-D stream.map.output.field.separator=, \</span><br><span class="line">-D stream.num.map.output.key.fields=2 \</span><br><span class="line">-D map.output.key.field.separator=, \</span><br><span class="line">-D mapreduce.partition.keypartitioner.options=-k1,1 \</span><br><span class="line">-D mapreduce.job.reduces=3 \</span><br><span class="line">-input input/test.txt \</span><br><span class="line">-output ou2 \</span><br><span class="line">-mapper /bin/cat \</span><br><span class="line">-reducer /bin/cat \</span><br><span class="line">-partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner</span><br></pre></td></tr></table></figure><p>The first reducer gets:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat,invent2</span><br><span class="line">cat,subject5</span><br><span class="line">cat,ten2</span><br><span class="line">cat,want8</span><br></pre></td></tr></table></figure><p>The second reducer gets:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">muse,*10</span><br><span class="line">muse,age12</span><br><span class="line">muse,curious1</span><br><span class="line">muse,days2</span><br><span class="line">muse,do3</span><br><span class="line">muse,growing4</span><br><span class="line">muse,grown5</span><br><span class="line">muse,in1</span><br><span class="line">muse,more3</span><br><span class="line">muse,please4</span><br><span class="line">muse,these3</span><br><span class="line">muse,this2</span><br><span class="line">muse,times5</span><br><span class="line">muse,to6</span><br><span class="line">muse,with9</span><br><span class="line">muse,worth0</span><br></pre></td></tr></table></figure><p>The last reducer is empty. With the result of the reducer we get the desired partition.</p><p>The first command is partition based the second filed in the key.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hadoop jar $HADOOP_HOME/share/hadoop/tools/lib/hadoop-streaming-*.jar \</span><br><span class="line">-D stream.map.output.field.separator=, \</span><br><span class="line">-D stream.num.map.output.key.fields=2 \</span><br><span class="line">-D map.output.key.field.separator=, \</span><br><span class="line">-D mapreduce.partition.keypartitioner.options=-k2,2 \</span><br><span class="line">-D mapreduce.job.reduces=3 \</span><br><span class="line">-input input/test.txt \</span><br><span class="line">-output ou1 \</span><br><span class="line">-mapper /bin/cat \</span><br><span class="line">-reducer /bin/cat \</span><br><span class="line">-partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner</span><br></pre></td></tr></table></figure><p>Reducer 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat,subject5</span><br><span class="line">cat,ten2</span><br><span class="line">muse,*10</span><br><span class="line">muse,more3</span><br><span class="line">muse,these3</span><br><span class="line">muse,times5</span><br><span class="line">muse,with9</span><br><span class="line">muse,worth0</span><br></pre></td></tr></table></figure><p>Reducer 2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat,invent2</span><br><span class="line">cat,want8</span><br><span class="line">muse,age12</span><br><span class="line">muse,curious1</span><br><span class="line">muse,days2</span><br><span class="line">muse,do3</span><br></pre></td></tr></table></figure><p>Reducer 3:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">muse,growing4</span><br><span class="line">muse,grown5</span><br><span class="line">muse,in1</span><br><span class="line">muse,please4</span><br><span class="line">muse,this2</span><br><span class="line">muse,to6</span><br></pre></td></tr></table></figure><p>Comparing the two output results we can see that different partition ranges lead to completely different partition results.</p><h1 id="MRJob-example"><a href="#MRJob-example" class="headerlink" title="MRJob example"></a>MRJob example</h1><p>By using the given text file, I did a example that in mrjob.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mrjob.job <span class="keyword">import</span> MRJob</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span><span class="params">(MRJob)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    the number of reducer is 1,</span></span><br><span class="line"><span class="string">    then we can use map separator</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapper</span><span class="params">(self, _, line)</span>:</span></span><br><span class="line">        words = line.split(<span class="string">','</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">yield</span> words[<span class="number">0</span>]   <span class="string">","</span>   words[<span class="number">1</span>], int(words[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reducer</span><span class="params">(self, key, values)</span>:</span></span><br><span class="line">        <span class="keyword">yield</span> key, sum(values)</span><br><span class="line">                </span><br><span class="line"></span><br><span class="line">    SORT_VALUES = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    JOBCONF = &#123;</span><br><span class="line">      <span class="string">'map.output.key.field.separator'</span>: <span class="string">','</span>,</span><br><span class="line">      <span class="string">'mapred.reduce.tasks'</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="string">'mapreduce.partition.keypartitioner.options'</span>:<span class="string">'-k1,1'</span>,</span><br><span class="line">      <span class="string">'partitioner'</span>:<span class="string">'org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner'</span>,</span><br><span class="line">      <span class="string">'mapreduce.partition.keycomparator.options'</span>:<span class="string">'-k1,1 -k2,2n'</span>,</span><br><span class="line">      <span class="string">'mapreduce.job.output.key.comparator.class'</span>:<span class="string">'org.apache.hadoop.mapreduce.lib.partition.KeyFieldBasedComparator'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    Example.run()</span><br></pre></td></tr></table></figure><p>Run the code:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 example.py -r hadoop hdfs:///user/xx/example.txt -o hdfs:///user/xx/output</span><br></pre></td></tr></table></figure><p>The result of three reducers:</p><ol><li><p>None</p></li><li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">muse,*10</span><br><span class="line">muse,age12</span><br><span class="line">muse,curious1</span><br><span class="line">muse,days2</span><br><span class="line">muse,do3</span><br><span class="line">muse,growing4</span><br><span class="line">muse,grown5</span><br><span class="line">muse,in1</span><br><span class="line">muse,more3</span><br><span class="line">muse,please4</span><br><span class="line">muse,these3</span><br><span class="line">muse,this2</span><br><span class="line">muse,times5</span><br><span class="line">muse,to6</span><br><span class="line">muse,with9</span><br><span class="line">muse,worth0</span><br></pre></td></tr></table></figure></li><li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat,invent2</span><br><span class="line">cat,subject5</span><br><span class="line">cat,ten2</span><br><span class="line">cat,want8</span><br></pre></td></tr></table></figure></li></ol><h1 id="Partition-and-secondary-sort-video"><a href="#Partition-and-secondary-sort-video" class="headerlink" title="Partition and secondary sort video"></a>Partition and secondary sort video</h1><iframe width="950" height="525" src="https://www.youtube.com/embed/ljFjAeKjZm8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Hadoop-Partition-And-Secondary-Sort&quot;&gt;&lt;a href=&quot;#Hadoop-Partition-And-Secondary-Sort&quot; class=&quot;headerlink&quot; title=&quot;Hadoop Partition And S
      
    
    </summary>
    
    
    
      <category term="Distributed" scheme="https://shunyangli.github.io/tags/Distributed/"/>
    
  </entry>
  
  <entry>
    <title>mrjob for hadoop</title>
    <link href="https://shunyangli.github.io/post/af28/"/>
    <id>https://shunyangli.github.io/post/af28/</id>
    <published>2021-09-16T12:42:15.000Z</published>
    <updated>2022-06-14T06:41:24.338Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/Yelp/mrjob" target="_blank" rel="noopener">mrjob</a> is the easiest way to write python programs that can run on hadoop. Its most prominent feature is that with the help of mrjob, there is no need to install hadoop or deploy any cluster, and we can run the code (for testing) on our local machine. Also, mrjob can easily run on Amazon Elastic MapReduce.</p><p>Since Hadoop does not currently support the python API, we can only use the stream processing method to complete the mapredduce ren using python. mrjob is a good choice.</p><h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><p>If you did not installed <a href="https://pip.pypa.io/en/stable/" target="_blank" rel="noopener">pip3</a> for Linux, then you can execute the following command:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt install python3-pip</span><br></pre></td></tr></table></figure><p>After that, you can install mrjob by using <code>pip3</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install mrjob</span><br></pre></td></tr></table></figure><p>To check if your installation is correct you can execute in the python3 terminal:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ &gt; python3</span><br><span class="line">Python 3.8.10 (default, Jun  2 2021, 10:49:15) </span><br><span class="line">[GCC 9.4.0] on linux</span><br><span class="line">Type "help", "copyright", "credits" or "license" for more information.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; import mrjob</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br></pre></td></tr></table></figure><p>If there is no output from import, the installation is successful.</p><h1 id="mrjob-example"><a href="#mrjob-example" class="headerlink" title="mrjob example"></a>mrjob example</h1><p>We use a generic word count example to demonstrate the use of mrjob.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mrjob.job <span class="keyword">import</span> MRJob</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WordCount</span><span class="params">(MRJob)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapper</span><span class="params">(self, _, line)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> line.split():</span><br><span class="line">            <span class="keyword">yield</span> (word, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reducer</span><span class="params">(self, key, values)</span>:</span></span><br><span class="line">        <span class="keyword">yield</span> key, sum(values)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    WordCount.run()</span><br></pre></td></tr></table></figure><p>Using yield, you can let the function generate a sequence, the function returns an object of type “generator”, through the object to call the next() method to return the sequence of values.</p><p>Briefly understand: yield is return returns a value, and remember this return position, the next iteration will start from this position after (the next line).</p><p>For example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">➜  ~ &gt; python3                         </span><br><span class="line">Python <span class="number">3.8</span><span class="number">.10</span> (default, Jun  <span class="number">2</span> <span class="number">2021</span>, <span class="number">10</span>:<span class="number">49</span>:<span class="number">15</span>) </span><br><span class="line">[GCC <span class="number">9.4</span><span class="number">.0</span>] on linux</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">3</span>):</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">yield</span> i</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num = count()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num</span><br><span class="line">&lt;generator object count at <span class="number">0x7f5786f7d900</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num.__next__()</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num.__next__()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num.__next__()</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num.__next__()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure><p>By execute the <code>word_count.py</code> in local environment:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 word_count.py input.txt</span><br></pre></td></tr></table></figure><h1 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h1><p>mapreduce is a system for processing large amounts of data on distributed systems. It is based on the paper <a href="https://dl.acm.org/doi/pdf/10.1145/1327452.1327492" target="_blank" rel="noopener">MapReduce: Simplified Data Processing on Large Clusters</a>. mapreduce divides massive data into small data sets, performs the same task in parallel, and finally collates and merges all the sub-results into the final result. The step of splitting the data for the same is called mapper, and the step of merging and organizing later is called reducer. combiner can be seen as an optimizer, but it is not necessary.</p><p>When we are calling the Hadoop framework with mrjob, we first need to configure Hadoop. <strong>You must make sure that yarn is started at the time of mrjob.</strong> </p><p>Configuration of <code>mapred-site.xml</code> :</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.app.mapreduce.am.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=$HADOOP_MAPRED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=$HADOOP_MAPRED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=$HADOOP_MAPRED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Configuration of <code>yarn-site.xml</code>:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="Execute-hadoop-on-mrjob"><a href="#Execute-hadoop-on-mrjob" class="headerlink" title="Execute hadoop on mrjob"></a>Execute hadoop on mrjob</h1><p>Use the same word count code, then we can execute the file by using:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 word_count.py -r hadoop input.txt</span><br></pre></td></tr></table></figure><p>mrjob can also call the file above the hdfs:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 word_count.py -r hadoop hdfs:///input/input.txt</span><br></pre></td></tr></table></figure><h1 id="Hadoop-JAVA-and-mrjob-installation"><a href="#Hadoop-JAVA-and-mrjob-installation" class="headerlink" title="Hadoop, JAVA and mrjob installation"></a>Hadoop, JAVA and mrjob installation</h1><iframe width="950" height="534" src="https://www.youtube.com/embed/lux2RA7ul4w" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://github.com/Yelp/mrjob&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;mrjob&lt;/a&gt; is the easiest way to write python programs that can run
      
    
    </summary>
    
    
    
      <category term="Distributed" scheme="https://shunyangli.github.io/tags/Distributed/"/>
    
  </entry>
  
  <entry>
    <title>Hadoop Distributed System</title>
    <link href="https://shunyangli.github.io/post/515d/"/>
    <id>https://shunyangli.github.io/post/515d/</id>
    <published>2021-09-08T10:01:55.000Z</published>
    <updated>2022-06-14T06:41:24.378Z</updated>
    
    <content type="html"><![CDATA[<p>HDFS的原理以及Hadoop的安装，MapReduce的运行流程，shuffle的运行机制。</p><h1 id="hdfs-功能"><a href="#hdfs-功能" class="headerlink" title="hdfs 功能"></a>hdfs 功能</h1><p>HDFS：分布式文件管理系统 </p><p>Hadoop fs：使用面最广，可以操作任何文件系统。 </p><p>hadoop dfs与hdfs dfs：只能操作HDFS文件系统相关（包括与Local FS间的操作），前者已经Deprecated，一般使用后者。 </p><p>Hadoop/hdfs fs/dfs {args} {args} </p><h1 id="hdfs-实现原理"><a href="#hdfs-实现原理" class="headerlink" title="hdfs 实现原理"></a>hdfs 实现原理</h1><p>当在使用hdfs dfs -put命令的时候，文件会被切块（文件块的大小通过参数来决定，默认是128M）存放到不同的datanode server里面，具体分布到哪个datanode取决于namenode server。<br>namenode会记录并维护不同的文件块所存放的具体位置（存放在哪个datanode里面），这些信息被称作元数据。 </p><pre><code class="shell">e.g.: file被分割成3块，分别存放在datanode0, datanode1 and datanode 2。 那么在namenode会记录: file: {block0: datanode0-server, block1: datanode1-server, block2: datanode2-server。 </code></pre><p>当在使用hdfs dfs -get 的时候，系统会在namenode获取源数据，然后根据元数据记录的文件块存放的位置进行获取文件块，然后合并。<br><img src="/post/515d/1.png" alt></p><h2 id="hdfs副本"><a href="#hdfs副本" class="headerlink" title="hdfs副本"></a>hdfs副本</h2><p>为了防止datanode出现宕机情况，hdfs会对文件进行储存副本，副本的具体数量由用户设定。就是把同一文件块储存在不同的datanode上面。 </p><h2 id="hdfs特点"><a href="#hdfs特点" class="headerlink" title="hdfs特点"></a>hdfs特点</h2><p>hdfs是适应一次写入，多次读的场景，不支持文件的修改。所以hdfs不适合做网盘应用，因为延迟高，开销大。<br>优点：可以线性扩展（不够存我直接再租几个服务器就够了），数据储存可靠性高，分布式运算处理方便。 </p><h1 id="hdfs-读-写数据流程"><a href="#hdfs-读-写数据流程" class="headerlink" title="hdfs 读/写数据流程"></a>hdfs 读/写数据流程</h1><h2 id="hdfs读数据流程"><a href="#hdfs读数据流程" class="headerlink" title="hdfs读数据流程"></a>hdfs读数据流程</h2><ul><li><p>和namenode通信查询元数据，根据元数据找到文件快所在的datanode server </p></li><li><p>挑选一个datanode server（就近原则，然后随机），建立socket 通信 </p></li><li><p>datanode开始发送数据（采用streaming），以packet为单位做校验 </p></li><li><p>client以packet为单位接受，在本地缓存，然后写入目标文件（获取所有的文件快后进行合并） </p></li></ul><p><img src="/post/515d/2.png" alt></p><h2 id="hdfs写数据流程"><a href="#hdfs写数据流程" class="headerlink" title="hdfs写数据流程"></a>hdfs写数据流程</h2><ul><li><p>client和namenode通信并请求上传文件，namenode检查文件是否存在 </p></li><li><p>namenode返回给client是否可以上传 </p></li><li><p>client请求第一个block该传输到哪些datanode（因为包含副本） </p></li><li><p>namenode返回所需要上传的datanode server（数量取决于副本的数量），假设返回A B C三台server </p></li><li><p>client和datanode A建立pipeline（本质是RPC调用），A收到请求后调用B建立pipeline，B收到请求后和C建立pipeline，然后逐级返回client </p></li><li><p>client开始给A上传文件块，以packet为单位，A收到之后传给B，B收到之后传给C </p></li><li><p>当一个文件块上传完成之后，client再次请求namenode上传下一个文件块 </p></li><li><p><img src="/post/515d/3.png" alt></p></li></ul><h1 id="hdfs-namenode-工作原理"><a href="#hdfs-namenode-工作原理" class="headerlink" title="hdfs namenode 工作原理"></a>hdfs namenode 工作原理</h1><p>namenode负责：响应client请求，维护路径树，管理元数据（查询，修改） </p><h2 id="hdfs元数据管理机制"><a href="#hdfs元数据管理机制" class="headerlink" title="hdfs元数据管理机制"></a>hdfs元数据管理机制</h2><ul><li><p>内存中有一份完整的元数据（特定的数据结构） </p></li><li><p>磁盘中有一个准完整的元数据的镜像文件 </p></li><li><p>当client对hdfs中的文件新增或者修改的时候，首先会在edits文件中记录操作日志，当client操作成功之后，相应的元数据会更新到内存中。每隔一段时间会有secondary namenode将namenode上积累的所有edits和一个最新的元数据镜像下载到本地，并加载到内存中进行合并（这个过程被称为checkpoint） </p></li></ul><p><img src="/post/515d/4.png" alt></p><h1 id="MapReduce-原理"><a href="#MapReduce-原理" class="headerlink" title="MapReduce 原理"></a>MapReduce 原理</h1><p><img src="/post/515d/5.png" alt></p><p>在map的时候会对同一个文件进行处理，每一个mserver里面的map会访问不同的部分，然后对文本数据进行处理，且map过程输出的格式是key value的形式。<br>在map task执行完之后会把数据传到shuffle里面，然后shuffle传递给reduce task。reduce会拉取在map里面处理过的数据，对key value进行整合（类似db里面的group by操作）。 </p><h1 id="shuffle原理"><a href="#shuffle原理" class="headerlink" title="shuffle原理"></a>shuffle原理</h1><p>shuffle是map和reduce中间的数据调度机制，主要包含缓存，分区，排序 </p><p>在map task里面有一个缓冲区，把处理过的key-value数据放到缓存里面，但是由于缓存有限，所以当缓冲区使用达到一定限制后（80%），split thread（一个线程，归map task管）会把缓冲区的数据写入到磁盘，split在处理缓冲数据的时候会对数据进行排序和分区，默认是hash partition进行分区，根据key的值hash分区。每split一次会写入到磁盘的一个新的文件（sort and partition）。在map完所有的数据之后，对所有溢出文件进行合并和排序，在合并的时候对每个分区的数据进行合并。 </p><p><img src="/post/515d/6.png" alt></p><p>在reduce阶段，拉取所有map tasks的最终结果，并对这些数据做排序。</p><p><img src="/post/515d/7.png" alt></p><p>Reduce function会拿到根据key聚合数据，每个聚合组调用一次reduce方法。会有多个reduce task同时运行。 </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;HDFS的原理以及Hadoop的安装，MapReduce的运行流程，shuffle的运行机制。&lt;/p&gt;
&lt;h1 id=&quot;hdfs-功能&quot;&gt;&lt;a href=&quot;#hdfs-功能&quot; class=&quot;headerlink&quot; title=&quot;hdfs 功能&quot;&gt;&lt;/a&gt;hdfs 功能&lt;/h
      
    
    </summary>
    
    
    
      <category term="Distributed" scheme="https://shunyangli.github.io/tags/Distributed/"/>
    
  </entry>
  
  <entry>
    <title>bipartite graph data pre-processing</title>
    <link href="https://shunyangli.github.io/post/3fe5/"/>
    <id>https://shunyangli.github.io/post/3fe5/</id>
    <published>2021-07-28T10:16:59.000Z</published>
    <updated>2022-06-14T06:41:24.838Z</updated>
    
    <content type="html"><![CDATA[<p>The initialized downloaded data is messy and the graph id is not continuous, so a data preprocessing method is written to allow the data to be loaded into memory faster. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">filepath = os.getcwd() + <span class="string">"/"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_files</span><span class="params">(filename: str, sep: str, skip: int)</span>:</span></span><br><span class="line">    data = []</span><br><span class="line">    filename = filepath + filename[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'r'</span>) <span class="keyword">as</span> lines:</span><br><span class="line">        lines = list(lines)</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines[skip:]:</span><br><span class="line">            nodes = line.split(sep)</span><br><span class="line">            temp = [int(nodes[<span class="number">0</span>]), int(nodes[<span class="number">1</span>])]</span><br><span class="line">            <span class="keyword">for</span> val <span class="keyword">in</span> nodes[<span class="number">2</span>:]:</span><br><span class="line">                temp.append(val)</span><br><span class="line">            data.append(temp)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_data</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    encoding the data</span></span><br><span class="line"><span class="string">    :param data:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    u_node = &#123;&#125;</span><br><span class="line">    u_id = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    v_node = &#123;&#125;</span><br><span class="line">    v_id = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> u_node:</span><br><span class="line">            u_node[line[<span class="number">0</span>]] = u_id</span><br><span class="line">            u_id += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">1</span>] <span class="keyword">not</span> <span class="keyword">in</span> v_node:</span><br><span class="line">            v_node[line[<span class="number">1</span>]] = v_id</span><br><span class="line">            v_id += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    nodes = <span class="string">""</span></span><br><span class="line">    edges = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> data:</span><br><span class="line">        nodes += <span class="string">"&#123;&#125; &#123;&#125;"</span>.format(u_node[line[<span class="number">0</span>]], v_node[line[<span class="number">1</span>]])</span><br><span class="line">        nodes += <span class="string">" "</span>.join(line[<span class="number">2</span>:])</span><br><span class="line">        nodes += <span class="string">"\n"</span></span><br><span class="line">        edges += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> u_id, v_id, edges, nodes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">store_file</span><span class="params">(filename, data)</span>:</span></span><br><span class="line">    meta = filepath + filename + <span class="string">'.meta'</span></span><br><span class="line">    edge = filepath + filename + <span class="string">'.e'</span></span><br><span class="line"></span><br><span class="line">    f = open(edge, <span class="string">'w'</span>)</span><br><span class="line">    f.write(data[<span class="number">3</span>])</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line">    lines = <span class="string">"&#123;&#125;\n&#123;&#125;\n&#123;&#125;\n"</span>.format(data[<span class="number">0</span>], data[<span class="number">1</span>], data[<span class="number">2</span>])</span><br><span class="line">    f = open(meta, <span class="string">'w'</span>)</span><br><span class="line">    f.write(lines)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute</span><span class="params">(args)</span>:</span></span><br><span class="line">    filename = args.filename</span><br><span class="line">    sep = args.sep</span><br><span class="line">    outfile = args.out</span><br><span class="line">    skip = args.skip</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> outfile <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        outfile = str(filename).split(<span class="string">'.'</span>)[<span class="number">1</span>][:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    data = read_files(filename, sep, int(skip))</span><br><span class="line">    parsed_data = parse_data(data)</span><br><span class="line">    store_file(outfile, parsed_data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">'Processing csv data'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--filename'</span>, help=<span class="string">'Please add file name'</span>, required=<span class="literal">True</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--sep'</span>, help=<span class="string">'Separator'</span>, default=<span class="string">' '</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--out'</span>, help=<span class="string">'output file name'</span>, default=<span class="literal">None</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--skip'</span>, help=<span class="string">'how many lines need to be skiped'</span>, default=<span class="number">1</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"Start processing: "</span>, args.filename)</span><br><span class="line">    execute(args)</span><br><span class="line">    print(<span class="string">"Finished"</span>)</span><br></pre></td></tr></table></figure><h1 id="How-to-use-it"><a href="#How-to-use-it" class="headerlink" title="How to use it"></a>How to use it</h1><p>You can get help information by using <code>--help</code>.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">usage: data.py [-h] --filename FILENAME [--sep SEP] [--out OUT] [--skip SKIP]</span><br><span class="line"></span><br><span class="line">Processing csv data</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help           show this help message and exit</span><br><span class="line">  --filename FILENAME  Please add file name</span><br><span class="line">  --sep SEP            Separator</span><br><span class="line">  --out OUT            output file name</span><br><span class="line">  --skip SKIP          how many lines need to be skiped、</span><br></pre></td></tr></table></figure><p><code>--sep</code> default value is a space, <code>--skip</code> default value is 1.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;The initialized downloaded data is messy and the graph id is not continuous, so a data preprocessing method is written to allow the data 
      
    
    </summary>
    
    
      <category term="Data processing" scheme="https://shunyangli.github.io/categories/Data-processing/"/>
    
    
      <category term="Data processing" scheme="https://shunyangli.github.io/tags/Data-processing/"/>
    
  </entry>
  
  <entry>
    <title>Union-Find Set</title>
    <link href="https://shunyangli.github.io/post/14e7/"/>
    <id>https://shunyangli.github.io/post/14e7/</id>
    <published>2021-05-25T03:45:50.000Z</published>
    <updated>2022-06-14T06:41:24.358Z</updated>
    
    <content type="html"><![CDATA[<p>In computer science, a disjoint-set data structure is a data structure used to handle the merging and querying of disjoint sets (a series of sets with no duplicate elements).</p><h1 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h1><p>A non-intersecting forest represents each set as a tree (deepth with 1), where each node is an element. A node holds a reference to its parent node, and the root node of the tree holds an empty reference or a reference to itself or some other invalid value to indicate itself as the root node. This data structure was first proposed by Bernard A. Galler and Michael J. Fischer in 1964,but it took several years before a precise analysis was completed. As shown:<br><img src="/post/14e7/1.png" alt></p><h1 id="New-Approach"><a href="#New-Approach" class="headerlink" title="New Approach"></a>New Approach</h1><p>There are many different types of variations of this data structure that we can change to suit different needs. I used two HashMap to store the roots and parent (<code>parent</code> and <code>roots</code>). For <code>parent</code>, it stores the roots of every element, for <code>roots</code>, it stores the root of all the elements.<br><code>parent</code> can be seen as <code>{node: root}</code>, <code>roots</code> can be seen as <code>{root: [node1, node2, ...]}</code>.</p><h2 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h2><p>In my method, I use Hashmap to store the tree. So, the search complexity is $O(n)$.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> parent[x]</span><br></pre></td></tr></table></figure><h2 id="Union"><a href="#Union" class="headerlink" title="Union"></a>Union</h2><p>For union, we need to set the root of such element to be a new root. And merge the childs of such root.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">union</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    rootX = parent[x]</span><br><span class="line">    rootY = parent[y]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> rootX == rootY:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    parent[y] = rootX</span><br><span class="line">    roots[rootX] += roots[y]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> roots[y]:</span><br><span class="line">        parent[n] = rootX</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">del</span> roots[y]</span><br></pre></td></tr></table></figure><h1 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h1><p>It can be used for subgraph pattern matching decompistion, bipartite graph and commuity.</p><h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UF</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :param parent &#123;node: root&#125;</span></span><br><span class="line"><span class="string">        :param roots: &#123;root: [n1,n2..]&#125;</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.parent = &#123;&#125;</span><br><span class="line">        self.roots = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, n):</span><br><span class="line">            self.parent[i] = i</span><br><span class="line">            self.roots[i] = [i]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">union</span><span class="params">(self, p, q)</span>:</span></span><br><span class="line">        rootP = self.parent[p]</span><br><span class="line">        rootQ = self.parent[q]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> rootP == rootQ:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        self.parent[q] = rootP</span><br><span class="line">        self.roots[rootP] += self.roots[q]</span><br><span class="line">        <span class="keyword">del</span> self.roots[q]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        to find x parent</span></span><br><span class="line"><span class="string">        :param x:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">in</span> self.parent:</span><br><span class="line">            <span class="keyword">return</span> self.parent[x]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isConnect</span><span class="params">(self, p, q)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        check whether two val has same root</span></span><br><span class="line"><span class="string">        :param p:</span></span><br><span class="line"><span class="string">        :param q:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        rootP = self.find(p)</span><br><span class="line">        rootQ = self.find(q)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> rootP == rootQ</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getRoots</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.roots.keys()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getRecords</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.roots</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    uf = UF()</span><br><span class="line">    uf.init(<span class="number">10</span>)</span><br><span class="line">    uf.union(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    uf.union(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    uf.union(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    uf.union(<span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">    uf.union(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    x = uf.find(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    print(x)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;In computer science, a disjoint-set data structure is a data structure used to handle the merging and querying of disjoint sets (a series
      
    
    </summary>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/categories/Algorithm/"/>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Prime Number</title>
    <link href="https://shunyangli.github.io/post/4d31/"/>
    <id>https://shunyangli.github.io/post/4d31/</id>
    <published>2021-04-25T05:18:45.000Z</published>
    <updated>2022-06-14T06:41:24.358Z</updated>
    
    <content type="html"><![CDATA[<p>In math, prime numbers are whole numbers greater than 1, that have only two factors – 1 and the number itself. Prime numbers are divisible only by the number 1 or itself. For example, 2, 3, 5, 7 and 11 are the first few prime numbers.</p><h1 id="Brute-Force"><a href="#Brute-Force" class="headerlink" title="Brute Force"></a>Brute Force</h1><p>For this solution we can use two loops to handle. For example, we want to find all the prime number between 2 and 100, then we can write code like this:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">num = <span class="number">100</span></span><br><span class="line">primes = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, num):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>, i):</span><br><span class="line">        <span class="keyword">if</span> i % j == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        primes.append(i)</span><br></pre></td></tr></table></figure><p>The time complexity is $O(n\sqrt{n})$. But when the number is huge, then it is very slow. There is a small optimization in the method. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">num = <span class="number">100</span></span><br><span class="line">primes = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, num):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>, i // <span class="number">2</span> + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> i % j == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        primes.append(i)</span><br></pre></td></tr></table></figure><h1 id="Ehrlich-Sieve-Algorithm"><a href="#Ehrlich-Sieve-Algorithm" class="headerlink" title="Ehrlich Sieve Algorithm"></a>Ehrlich Sieve Algorithm</h1><p>The algorithm enumerates all the numbers from small to large, and for each prime number, it sifts all its multiples, and the rest is the prime number. The time complexity is $O(loglog(n))$.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">primes = []</span><br><span class="line">is_prime = [<span class="literal">True</span>] * (num + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, num):</span><br><span class="line">    <span class="keyword">if</span> is_prime[i]:</span><br><span class="line">        primes.append(i)</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> range(<span class="number">1</span>, num // i + <span class="number">1</span>):</span><br><span class="line">            is_prime[i * m] = <span class="literal">False</span></span><br></pre></td></tr></table></figure><h1 id="Performance-Evaluation"><a href="#Performance-Evaluation" class="headerlink" title="Performance Evaluation"></a>Performance Evaluation</h1><p>We set the value of <code>num</code> to <code>[10000, 50000, 100000, 200000]</code>. For Brute Force (BF) we used its optimization algorithm. For Ehrlich Sieve (ES) we do not change anything.</p><p><img src="/post/4d31/1.png" alt></p><p>We can see that as the number increases the time consumed by BF is higher. For all the test, the time cost of ES algorithm no more than one seconds.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;In math, prime numbers are whole numbers greater than 1, that have only two factors – 1 and the number itself. Prime numbers are divisibl
      
    
    </summary>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/categories/Algorithm/"/>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>A* Search Algorithm</title>
    <link href="https://shunyangli.github.io/post/44e7/"/>
    <id>https://shunyangli.github.io/post/44e7/</id>
    <published>2021-04-21T04:06:33.000Z</published>
    <updated>2022-06-14T06:41:24.378Z</updated>
    
    <content type="html"><![CDATA[<p>A* search algorithm is a heuristic search which works on path planning and graph traversal (weighted).<br>It is an extension of <a href="https://shunyangli.github.io/2020/05/03/Algorithm/">Dijkstra</a> algorithm. The formula of Dijkstra is $f(n)=g(n)$, and the formula of A* is $f(n)=g(n) + h(n)$, where $g(n)$ is the cost from start to current node and $h(n)$ is the estimated cost from source node to target node. Manhattan distance or Euclidean distance is usually used to estimate. A* algorithm is better than Dijkstra when $h(n)$ is admissible (never overstimates). The time complexity is $O(|E|log|V|)$ and space complexity is $O(|v|)$. The worst case is same with Dijkstra. </p><h1 id="Pseudocode"><a href="#Pseudocode" class="headerlink" title="Pseudocode"></a>Pseudocode</h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;A* search algorithm is a heuristic search which works on path planning and graph traversal (weighted).&lt;br&gt;It is an extension of &lt;a href=&quot;
      
    
    </summary>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/categories/Algorithm/"/>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Bidirectional BFS</title>
    <link href="https://shunyangli.github.io/post/c0bf/"/>
    <id>https://shunyangli.github.io/post/c0bf/</id>
    <published>2021-04-15T13:25:01.000Z</published>
    <updated>2022-06-14T06:41:24.848Z</updated>
    
    <content type="html"><![CDATA[<p>Bidirectional BFS is applicable to the case where the target node is known; the initial node expands toward the target node and the target node expands toward the initial node at the same time, until the same node appears in both expansion directions, and the search ends. For example, in a maze, when we need to know the number of steps to reach each location, a normal BFS is sufficient, but if we only need to know the number of steps to reach a specific location, we should use a two-way BFS. Start BFS from two target points at the same time, so we will have two different queues. Update the smaller one each time until there are elements in the two queues that overlap, indicating that the path is found. For example in the following graph, it will stop at node 9.</p><p><img src="/post/c0bf/1.png" alt></p><h1 id="Time-Complexity"><a href="#Time-Complexity" class="headerlink" title="Time Complexity"></a>Time Complexity</h1><p>Suppose if the branching factor of the tree is b and the distance between the target vertex and the source is d, then the normal BFS search complexity will be $O(b^d)$. On the other hand, if we perform two search operations, the complexity of each search will be $O(b^{d/2})$ and the total complexity will be $O(b^{d/2} + b^{d/2})$, which is much less than $O(b^d)$.</p><p>The branch factor refers to the number of children of each node in the expanded tree, i.e., the number of new elements that can be reached by each element. For example, in a maze where you can only move up and down, the branch factor is 4.</p><h1 id="Word-Ladder"><a href="#Word-Ladder" class="headerlink" title="Word Ladder"></a>Word Ladder</h1><p><a href="https://leetcode.com/problems/word-ladder" target="_blank" rel="noopener">Word Ladder</a> is a hard level question. It can be solved by using BFS. However BFS will time out. We can use Bidirectional to solve this issue.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&gt; findLadders(<span class="built_in">string</span> from, <span class="built_in">string</span> to, <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&amp; wordList) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">unordered_set</span>&lt;<span class="built_in">string</span>&gt; lexicon(wordList.begin(), wordList.end());</span><br><span class="line">        <span class="keyword">auto</span> result = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&gt;&#123;&#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// check whether exist to, if not just return a empty</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">not</span> lexicon.count(to)) &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// init a word maps for double bfs</span></span><br><span class="line">        <span class="keyword">auto</span> word_maps = <span class="built_in">unordered_map</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&gt;&#123;&#125;;</span><br><span class="line">        <span class="comment">// the left vector</span></span><br><span class="line">        <span class="keyword">auto</span> left = <span class="built_in">unordered_set</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;from&#125;;</span><br><span class="line">        <span class="comment">// the right vector</span></span><br><span class="line">        <span class="keyword">auto</span> right = <span class="built_in">unordered_set</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;to&#125;;</span><br><span class="line">        <span class="comment">// contain all the visited elements</span></span><br><span class="line">        <span class="keyword">auto</span> visited = <span class="built_in">unordered_set</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// the bfs direction, could start at from and start at end</span></span><br><span class="line">        <span class="comment">// true means start at from</span></span><br><span class="line">        <span class="comment">// false means start at end</span></span><br><span class="line">        <span class="comment">// this is helpful for store the word into hashmap</span></span><br><span class="line">        <span class="keyword">auto</span> ahead = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">auto</span> found = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// which contain all the words</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">not</span> left.empty() <span class="keyword">and</span> <span class="keyword">not</span> right.empty()) &#123;</span><br><span class="line">            <span class="comment">// change the position when left &gt; right</span></span><br><span class="line">            <span class="comment">// part of two end bfs algorithm</span></span><br><span class="line">            <span class="keyword">if</span> (left.size() &gt; right.size()) &#123;</span><br><span class="line">                <span class="built_in">std</span>::swap(left, right);</span><br><span class="line">                ahead = <span class="keyword">not</span> ahead;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// contain all the words which generate according to left set words</span></span><br><span class="line">            <span class="comment">// which like insert to queue in bfs</span></span><br><span class="line">            <span class="keyword">auto</span> <span class="built_in">queue</span> = <span class="built_in">unordered_set</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// insert all the left set into visited</span></span><br><span class="line">            visited.insert(left.begin(), left.end());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// loop all the element in the left</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> origin_word : left) &#123;</span><br><span class="line">                <span class="keyword">auto</span> neighbors = neighbor(origin_word, visited, lexicon);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; word : neighbors) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">std</span>::find(right.begin(), right.end(), word) != right.end()) &#123;</span><br><span class="line">                        found = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (ahead) &#123;</span><br><span class="line">                        word_maps[word].push_back(origin_word);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        word_maps[origin_word].push_back(word);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="built_in">queue</span>.insert(word);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// put the new path to left then do new iterator</span></span><br><span class="line">            left = <span class="built_in">queue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// if found the to word, then generate the word ladders</span></span><br><span class="line">            <span class="keyword">if</span> (found) &#123;</span><br><span class="line">                result.push_back(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;to&#125;);</span><br><span class="line">                <span class="comment">// the first one should be from</span></span><br><span class="line">                <span class="keyword">while</span> (result[<span class="number">0</span>][<span class="number">0</span>] != from) &#123;</span><br><span class="line">                    result = generate_result(result, word_maps);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// std::sort(result.begin(), result.end());</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * generate the neighbor words according to the word</span></span><br><span class="line"><span class="comment">     * to change the char from a-z</span></span><br><span class="line"><span class="comment">     * @param word the currecnt word to generate neighor words</span></span><br><span class="line"><span class="comment">     * @param visited the visited word</span></span><br><span class="line"><span class="comment">     * @param lexicon all the words</span></span><br><span class="line"><span class="comment">     * @return the neighors of the word</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">auto</span> <span class="title">neighbor</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; word,</span></span></span><br><span class="line"><span class="function"><span class="params">                  <span class="keyword">const</span> <span class="built_in">unordered_set</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&amp; visited,</span></span></span><br><span class="line">                  const unordered_set&lt;std::string&gt;&amp; lexicon) -&gt; unordered_set&lt;std::string&gt; &#123;</span><br><span class="line">        <span class="comment">// contains all the neighbor words</span></span><br><span class="line">        <span class="keyword">auto</span> words = <span class="built_in">unordered_set</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::size_type&#123;<span class="number">0</span>&#125;; i &lt; word.size(); i++) &#123;</span><br><span class="line">            <span class="comment">// because we does n</span></span><br><span class="line">            <span class="comment">// ot want to change the current word</span></span><br><span class="line">            <span class="comment">// so we use curr_char to store the char which will be replaced</span></span><br><span class="line">            <span class="keyword">char</span> curr_char = word[i];</span><br><span class="line">            <span class="comment">// change the curr with a-z and check whether visited and whether in lexicon</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> c = <span class="string">'a'</span>; c &lt;= <span class="string">'z'</span>; ++c) &#123;</span><br><span class="line">                word[i] = c;</span><br><span class="line">                <span class="comment">// to avoid same word</span></span><br><span class="line">                <span class="keyword">if</span> (curr_char == c) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// the word should not visited and should in lexicon</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">not</span> visited.count(word) </span><br><span class="line">                   <span class="keyword">and</span> lexicon.count(word)) &#123;</span><br><span class="line">                    words.insert(word);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            word[i] = curr_char;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> words;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * iterate the result according to the end word</span></span><br><span class="line"><span class="comment">     * it can be a recurrsion, but I do not want to do that</span></span><br><span class="line"><span class="comment">     * recurrsion not stable.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * In the hashmap the word stored as: end-&gt;&#123;w1, w2, w2&#125;</span></span><br><span class="line"><span class="comment">     * this means w1, w2, w3 can convert to end, similar idea for start</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param words is the result which contain as list</span></span><br><span class="line"><span class="comment">     * @param word_maps hashmap, key is word, values is word ladders</span></span><br><span class="line"><span class="comment">     * @return a new list of result and then loop again</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">auto</span> <span class="title">generate_result</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&gt;&amp; words,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">unordered_map</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&gt;&amp; word_maps)</span></span></span><br><span class="line">       -&gt; std::vector&lt;std::vector&lt;std::string&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">auto</span> temp = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// the word_maps were stored as a hashmap</span></span><br><span class="line">        <span class="comment">// key is the word, value is the word ladders</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; word_list : words) &#123;</span><br><span class="line">            <span class="keyword">auto</span> t = word_list[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// get the related word from hashmap</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; word : word_maps[t]) &#123;</span><br><span class="line">                <span class="comment">// insert the value in the front of list</span></span><br><span class="line">                <span class="keyword">auto</span> w = word_list;</span><br><span class="line">                w.insert(w.begin(), word);</span><br><span class="line">                temp.push_back(w);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>This problem is also the first assignment of <a href="https://webcms3.cse.unsw.edu.au/COMP6771/20T2/" target="_blank" rel="noopener">COMP6771</a> in 20T2.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Bidirectional BFS is applicable to the case where the target node is known; the initial node expands toward the target node and the targe
      
    
    </summary>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/categories/Algorithm/"/>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Automatically generate gitignore</title>
    <link href="https://shunyangli.github.io/post/c26f/"/>
    <id>https://shunyangli.github.io/post/c26f/</id>
    <published>2021-04-15T11:25:59.000Z</published>
    <updated>2022-06-14T06:41:24.378Z</updated>
    
    <content type="html"><![CDATA[<p>We use <a href="https://github.com/" target="_blank" rel="noopener">Git</a> a lot when working on projects, but not all of the files we need to put into github, such as datasets, virtual environments, and configuration files. So we need to configure .gitignore to automatically ignore these files that don’t need to be added to the Git admin. Configuring .gitignore is usually tedious because you need to add all the uncessary files.</p><p><a href="https://github.com/Antrikshy/ignr.py" target="_blank" rel="noopener">ignr</a> is a tool which can generate .gitignore files automatically. It is implmeneted by Python.</p><h1 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h1><p>If you already installed python and pip, then you can execute the following command:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install ignr</span><br></pre></td></tr></table></figure><h1 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h1><p>The <a href="https://github.com/Antrikshy/ignr.py" target="_blank" rel="noopener">ignr</a> supports over four hundred different .gitignore templates, which we can view with the<code>ignr -l</code>command or search for with the <code>ignr -s</code>  command. For example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ignr -s python</span><br></pre></td></tr></table></figure><p>Searches for supplied query in list of available templates from gitignore.io.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ignr -n python</span><br></pre></td></tr></table></figure><p>It will generate python’s project gitignore file in the currect directory.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;We use &lt;a href=&quot;https://github.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Git&lt;/a&gt; a lot when working on projects, but not all of the files we n
      
    
    </summary>
    
    
      <category term="git" scheme="https://shunyangli.github.io/categories/git/"/>
    
    
      <category term="git" scheme="https://shunyangli.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>Mail activation</title>
    <link href="https://shunyangli.github.io/post/9b8a/"/>
    <id>https://shunyangli.github.io/post/9b8a/</id>
    <published>2020-07-04T05:36:33.000Z</published>
    <updated>2022-06-14T06:41:24.358Z</updated>
    
    <content type="html"><![CDATA[<p>本文会教大家怎么做邮箱验证，以及怎么发送好看一点的邮箱的HTML模板。很久没写过有用的教程，本来今天我应该在干经济，实在写不下去了，我跑来写这些了。(⊙︿⊙)关于怎么使用flask发送邮件，我在之前的教程有说的。<a href="https://shunyangli.github.io/2019/10/08/Flask-Mail/#more">传送门</a></p><p>技术：</p><ul><li>flask</li><li>html</li><li>css</li></ul><h1 id="HTML-Template"><a href="#HTML-Template" class="headerlink" title="HTML Template"></a>HTML Template</h1><p>首先我们需要知道flask使用的是Jinja2的模板。</p><ol><li>需要首先设计一个HTML来展示你相对应的邮箱验证的界面。我已经提前做好了一个，所有的源代码我都放到最后面了，到时候大家可以下载跑一下看看。</li></ol><p><img src="/post/9b8a/1.png" alt></p><ol start="2"><li>设置一下HTML所需要的参数，激活所需要的URL，用户名等。</li><li>写flask部分的代码</li></ol><p><strong>首先初始化flask：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itsdangerous <span class="keyword">import</span> TimedJSONWebSignatureSerializer <span class="keyword">as</span> Serializer</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, session</span><br><span class="line"><span class="keyword">from</span> flask_mail <span class="keyword">import</span> Mail, Message</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line">app.config[<span class="string">'MAIL_SERVER'</span>] = <span class="string">'smtp.qq.com'</span></span><br><span class="line">app.config[<span class="string">'MAIL_PORT'</span>] = <span class="number">465</span></span><br><span class="line">app.config[<span class="string">'MAIL_USE_SSL'</span>] = <span class="literal">True</span></span><br><span class="line">app.config[<span class="string">'MAIL_USERNAME'</span>] = <span class="string">'xxxx'</span></span><br><span class="line">app.config[<span class="string">'MAIL_PASSWORD'</span>] = <span class="string">'xxxx'</span></span><br><span class="line">app.config[<span class="string">'MAIL_DEFAULT_SENDER'</span>] = <span class="string">'xxxx@qq.com'</span></span><br><span class="line"></span><br><span class="line">mail = Mail(app)</span><br></pre></td></tr></table></figure><p><strong>初始化发送邮件的function:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 异步发送function</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">async_send_mail</span><span class="params">(app, msg)</span>:</span></span><br><span class="line">    <span class="comment"># 获取当前程序的上下文</span></span><br><span class="line">    <span class="keyword">with</span> app.app_context():</span><br><span class="line">        <span class="comment"># 发送邮件</span></span><br><span class="line">        mail.send(msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义发送函数, message的配置和上面讲的一样</span></span><br><span class="line"><span class="comment"># **kwargs 指传进来的参数, 可以传多个参数进来。eg: username = 'xxx', link = 'xxx.com'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span><span class="params">(to, subject, template, **kwargs)</span>:</span></span><br><span class="line">    msg = Message(subject, sender = <span class="string">'1479201404@qq.com'</span>, recipients=[to])</span><br><span class="line">    msg.html = render_template(template + <span class="string">'.html'</span>, **kwargs)</span><br><span class="line">    thr = Thread(target=async_send_mail, args=[app, msg])</span><br><span class="line">    thr.start()</span><br><span class="line">    <span class="comment"># 返回调用的结果</span></span><br><span class="line">    <span class="keyword">return</span> thr</span><br></pre></td></tr></table></figure><p><strong>初始化加密fucntion：</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encryption</span><span class="params">(data, expires_in=<span class="number">3600</span>)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    加密json</span></span><br><span class="line"><span class="string">    :param data: 需要加密的数据</span></span><br><span class="line"><span class="string">    :param expires_in: 过期时间</span></span><br><span class="line"><span class="string">    :return: 返回加密的str</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    s = Serializer(app.config[<span class="string">'SECRET_KEY'</span>], expires_in=expires_in)</span><br><span class="line">    <span class="keyword">return</span> s.dumps(data).decode(<span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryption</span><span class="params">(token)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    解密token到json数据</span></span><br><span class="line"><span class="string">    :param token: 密文</span></span><br><span class="line"><span class="string">    :return: 解密的数据</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    s = Serializer(app.config[<span class="string">'SECRET_KEY'</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = s.loads(token)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    <span class="keyword">except</span> SignatureExpired:</span><br><span class="line">        print(<span class="string">'Token expired'</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">'Unknown error'</span>)</span><br></pre></td></tr></table></figure><p><strong>最后开始写flask路由部分的代码:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        email = request.form.get(<span class="string">'email'</span>)</span><br><span class="line">        <span class="keyword">if</span> email <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            session[email] = email</span><br><span class="line">            token = encryption(email)</span><br><span class="line">            send_mail(email, <span class="string">'Activate you account'</span>, <span class="string">'activate'</span>, action_url=<span class="string">'127.0.0.1:5000/activate/&#123;&#125;'</span>.format(token))</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'&lt;h1&gt;success&lt;/h1&gt;'</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/activate/&lt;token&gt;', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(token)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> token <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"False"</span></span><br><span class="line">    </span><br><span class="line">    email = decryption(token)</span><br><span class="line">    <span class="keyword">if</span> session.get(email) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"False"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">"True"</span></span><br></pre></td></tr></table></figure><p>结果如下:</p><p><img src="/post/9b8a/2.png" alt></p><p><img src="/post/9b8a/3.png" alt></p><p><img src="/post/9b8a/4.png" alt></p><p>具体代码可以下载查看：<a href="./mail-activation.zip">下载</a></p><p><strong>ps：需要修改相对应的邮箱和邮箱的配置</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;本文会教大家怎么做邮箱验证，以及怎么发送好看一点的邮箱的HTML模板。很久没写过有用的教程，本来今天我应该在干经济，实在写不下去了，我跑来写这些了。(⊙︿⊙)关于怎么使用flask发送邮件，我在之前的教程有说的。&lt;a href=&quot;https://shunyangli.git
      
    
    </summary>
    
    
    
      <category term="api" scheme="https://shunyangli.github.io/tags/api/"/>
    
  </entry>
  
  <entry>
    <title>database</title>
    <link href="https://shunyangli.github.io/post/1c6b/"/>
    <id>https://shunyangli.github.io/post/1c6b/</id>
    <published>2020-07-03T03:47:42.000Z</published>
    <updated>2022-07-06T11:18:52.775Z</updated>
    
    <content type="html"><![CDATA[<p>包含一些database常见的问题，MySQL的索引，怎么使用索引等等。</p><h1 id="数据库的三大范式"><a href="#数据库的三大范式" class="headerlink" title="数据库的三大范式"></a>数据库的三大范式</h1><p>第一范式：每个列都不能再拆分</p><p>第二范式：在第一范式的基础上，非主键列完全依赖于主键，而不能是依赖于主键的一部分</p><p>第三范式：在第二范式的基础上，非主键列只依赖于主键，不依赖于其他非主键。</p><h1 id="引擎"><a href="#引擎" class="headerlink" title="引擎"></a>引擎</h1><p>MySQL里面储存引擎MyISAM与InnoDB的区别：</p><p><strong>InnoDB引擎：</strong>提供了对数据库ACID的支持，并且提供了行级锁和外键的约束。它的设计目的就是处理大数据容量的数据库系统。<strong>可以自适应哈希索引</strong>（聚簇索引：在索引中保存了数据，从而避免直接读取磁盘，因此对查询性能有很大的提升）</p><p><strong>MyISAM引擎：</strong>不提供事务支持，也不支持行级锁和外键。<strong>只支持表级锁。支持压缩表和空间数据索引。</strong>（非聚簇索引：索引和数据分开存，在索引里面找到需要的内存地址，然后去读取）</p><p>MyISAM 崩溃后发生损坏的概率比 InnoDB 高很多，而且恢复的速度也更慢。InnoDB现在是MySQL的默认引擎。</p><h1 id="MySQL的ACID原理"><a href="#MySQL的ACID原理" class="headerlink" title="MySQL的ACID原理"></a>MySQL的ACID原理</h1><p><strong>原子性(Atomicity)、一致性(Consistency)、隔离性(Isolation)、持久性(Durability)</strong></p><p>我们以从A账户转账50元到B账户为例进行说明一下ACID，四大特性。</p><p><strong>原子性：</strong></p><p>一个事物是一个不可分割的单位，其中的操作<strong>要么全做，要么不做，不存在中间状态。</strong>要么转账成功，要么失败，不存在中间状态。</p><blockquote><p>如果没办法保证原子性会怎么样？</p></blockquote><p>可能会导致A的账户少了50元，但是B的账户也没多50。系统总金额会少50.。。。</p><p><strong>隔离性：</strong></p><p>是指在并发执行的时候，<em>事务内部的操作与其他的事务是隔离的</em>，并发操作的时候各个事务之间不能相互干扰。</p><blockquote><p>如果没办法保证隔离性会发生什么？</p></blockquote><p>比如说A有200，B有0，A向B转账两次，每次50元。如果没发保证隔离性，就会导致A扣款了两次，但是B只增加了一次，A就变成了100，B只有50。又凭空蒸发了。</p><p><strong>持久性：</strong></p><p>指的是当事务提交之后，它对数据库的改变就应该是永久性的。如果接下来有什么错误发生也不会被影响到。</p><blockquote><p>如果没办法保证持久性会发生什么？</p></blockquote><p>如果你正在写入磁盘的时候，突然服务器宕机了，在内存中修改的数据全部丢失了，持久性就无法保证。</p><p><strong>一致性：</strong></p><p>是指事务执行前后，数据处于一种合法的状态。。那什么是合法的数据状态呢？ oK，这个状态是满足预定的约束就叫做合法的状态，再通俗一点，这状态是由你自己来定义的。<strong>「满足这个状态，数据就是一致的，不满足这个状态，数据就是不一致的」</strong>！（就是自己去规定的一个状态，比如账户余额必须大于100）</p><blockquote><p>如果没办法保证一致性会发生什么？</p></blockquote><p>例一：A账户有200元，转账300元出去，此时A账户余额为-100元。你自然就发现了此时数据是不一致的，为什么呢？因为你定义了一个状态，余额这列必须大于0。</p><p><strong>数据库必须要实现AID三大特性，才有可能实现一致性。</strong>例如，原子性无法保证，显然一致性也无法保证。</p><h2 id="MySQL怎么实现ACID的"><a href="#MySQL怎么实现ACID的" class="headerlink" title="MySQL怎么实现ACID的"></a>MySQL怎么实现ACID的</h2><p>MySQL里面InnoDB是使用<strong><code>undo log</code> 是实现原子性</strong>的关键，<strong>当事物回滚的时候能够撤销所有已经成功执行的SQL语句。</strong>他需要记录你要回滚的相应日志信息：</p><ol><li>当你delete一条数据的时候，就需要记录这条数据的信息，回滚的时候，insert这条旧数据</li><li>当你update一条数据的时候，就需要记录之前的旧值，回滚的时候，根据旧值执行update操作</li><li>当年insert一条数据的时候，就需要这条记录的主键，回滚的时候，根据主键执行delete操作</li></ol><p>InnoDB使用<strong><code>redo log</code>是实现持久性</strong>的关键，Mysql是先把磁盘上的数据加载到内存中，在内存中对数据进行修改，同时会在<code>redo log</code>里面记录该操作，当宕机重启之后，会将<code>redo log</code>中的内容回复到数据库里面。</p><p><strong>MySQL使用的是锁和MVCC机制保证隔离性。</strong></p><h1 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a>ACID</h1><p>数据库事务中的四大特性：ACID</p><h2 id="Atomicity"><a href="#Atomicity" class="headerlink" title="Atomicity"></a>Atomicity</h2><p>A：原子性（Atomicity），一个事务（transcation）中的所有操作，要么全部完成，要么全部不完成，不会出现完成一半的情况。事务在执行过程中发生错误会被回滚（rollbac）到事务开始前的状态。</p><p>原子性和一致性通过Undo log来实现。Undo log的原理很简单，为了满足事务的原子性，在操作任何数据之前，首先将数据备份到一个地方（这个存储数据备份的地方称为Undo log）。然后进行数据的修改。如果出现了错误或者用户执行了ROLLBACK语句，系统可以利用Undo log中的备份将数据恢复到事务开始之前的状态。</p><h2 id="Consistency"><a href="#Consistency" class="headerlink" title="Consistency"></a>Consistency</h2><p>C：一致性（Consistency），事务的一致性指的是在一个事务执行之前和执行之后数据库都必须处于一致性状态。如果事务成功地完成，那么系统中所有变化将正确地应用，系统处于有效状态。如果在事务中出现错误，那么系统中的所有变化将自动地回滚，系统返回到原始状态。(参考分布式数据库的一致性)。</p><p>数据一致性可以参考Raft算法和Paxos算法。</p><h2 id="Isolation"><a href="#Isolation" class="headerlink" title="Isolation"></a>Isolation</h2><p>I：隔离性（Isolation），指的是在并发环境中，当不同的事务同时操纵相同的数据时，每个事务都有各自的完整数据空间。由并发事务所做的修改必须与任何其他并发事务所做的修改隔离。事务查看数据更新时，数据所处的状态要么是另一事务修改它之前的状态，要么是另一事务修改它之后的状态，事务不会查看到中间状态的数据。 打个比方，你买东西这个事情，是不影响其他人的。</p><p>如果要实现数据库事务最高隔离性，也就是最安全的隔离。最简单的解决方法就是当一个事务执行的时候，其他事务都阻塞，等当前事务执行完之后再执行。但是对于现在的多核CPU是非常浪费资源的。所以为了充分利用计算资源，可以使用多版本并发控制（MVCC）来解决该问题。</p><h3 id="Read-amp-Write-Lock"><a href="#Read-amp-Write-Lock" class="headerlink" title="Read &amp; Write Lock"></a>Read &amp; Write Lock</h3><p>读写锁还是比较容易理解的。当在读取数据的时候，应该对读取的数据先加锁后读取，读取完之后的某个时间再进行解开读锁。读锁只能读取数据不能写入。因为如果加了读锁，说明某个事务准备读取数据，如果被别的事务修改了数据，那么数据就不准确了。<strong>但是多个事务可以同时对同一个数据进行读锁，因为所有事务都是只读不写。</strong></p><p>写锁具有排他性（exclusive lock）。当一个事务准备对一个数据进行写操作的时候，先要对数据加写锁，然后才可以修改数据。这个时候其他事务就无法对这个数据进行解锁，除非这个写锁释放。写锁是为了必然多个事务同时修改同一个数据。</p><h3 id="One-Phase-Lock"><a href="#One-Phase-Lock" class="headerlink" title="One Phase Lock"></a>One Phase Lock</h3><p>一段锁即事务开始的时候，一次性申请全部的锁，以后不会申请任何锁。如果期中某个锁不可用，则整个申请就不成功，事务就不会执行，在事务尾端则一次性释放所有锁。一段锁不会造成死锁，但是事务的并发度不高。</p><h3 id="Two-Phase-Lock"><a href="#Two-Phase-Lock" class="headerlink" title="Two Phase Lock"></a>Two Phase Lock</h3><p>两段锁，整个事务分成两个阶段，前一个阶段为加锁，后一个阶段为解锁。在加锁阶段，事务只能加锁，也能操作数据，但不能解锁。直到事务释放第一个锁，就进入解锁阶段，此过程当中事务只能解锁，也能操作数据，不能再加锁。两段锁协议使得事务具备较高的并发。由于在加锁阶段没有顺序要求，所以会存在死锁的情况。如果两个事务分别申请了A，B锁，接着又申请对方的锁，此时进入到死锁状态。</p><h3 id="Multiversion-Concurrency-Control"><a href="#Multiversion-Concurrency-Control" class="headerlink" title="Multiversion Concurrency Control"></a>Multiversion Concurrency Control</h3><p>加锁的方式处理事务一个比较大的问题就是会造成死锁（dead lock）,原因就是一个事务加锁的数据并不止只有一行。事务A对行C加写锁，事务B对行D加写锁，接着事务希望获取行D的锁，事务B希望获取行C的锁，这样很容就死锁了。</p><p>MVCC提供的只是一种思路，具体的实现比较多样化。大体的思路是每一行保存冗余数据，读写的时间戳，也可以称为版本号，<strong>在对某一行数据继续update或者delete的时候，并不直接操作，而是复制多一份副本进行操作，这个就是所谓多版本（multiversion）</strong></p><p>相当于利用时间戳对数据进行维护保持数据的隔离性。</p><h2 id="Durability"><a href="#Durability" class="headerlink" title="Durability"></a>Durability</h2><p>D：持久性（Durability），指的是只要事务成功结束，它对数据库所做的更新就必须永久保存下来。即使发生系统崩溃，重新启动数据库系统后，数据库还能恢复到事务成功结束时的状态。打个比方，你买东西的时候需要拿收据，即使老板忘记了那也有据可查。</p><p>重做日志（Redo Log）用来实现事务的持久性。Redo log记录的是新数据的备份。在事务提交前，只要将Redo log持久化即可，不需要将数据持久化。当系统崩溃时，虽然数据没有持久化，但是Redo log已经持久化。系统可以根据Redo log的内容，将所有数据恢复到最新的状态。</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;包含一些database常见的问题，MySQL的索引，怎么使用索引等等。&lt;/p&gt;
&lt;h1 id=&quot;数据库的三大范式&quot;&gt;&lt;a href=&quot;#数据库的三大范式&quot; class=&quot;headerlink&quot; title=&quot;数据库的三大范式&quot;&gt;&lt;/a&gt;数据库的三大范式&lt;/h1&gt;&lt;p&gt;第一
      
    
    </summary>
    
    
    
      <category term="db" scheme="https://shunyangli.github.io/tags/db/"/>
    
  </entry>
  
  <entry>
    <title>Distributed Things</title>
    <link href="https://shunyangli.github.io/post/f61e/"/>
    <id>https://shunyangli.github.io/post/f61e/</id>
    <published>2020-06-26T05:05:27.000Z</published>
    <updated>2022-06-14T06:41:24.348Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Distributed-session"><a href="#Distributed-session" class="headerlink" title="Distributed session"></a>Distributed session</h1><p>怎么使用flask来做分布式session，以及为什么要使用分布式的session。</p><p>因为cookie不太适合存一些敏感信息，所以一般敏感的信息会存到session里。但是大部分时候都是cookie和session结合使用。session是存在服务器里面的相对安全一点。</p><p><strong>储存原理：</strong></p><p>通过cookie存一个session_id，然后具体的数据是保存到session里面，而session会存到server里面。比如在用户登录之后服务器会在cookie里面保存一个session_id，下次再发起请求的时候会把该session_id携带上来，服务器根据session_id在session的库中获取用户的session数据。</p><p><strong>flask默认采用的方式是将session数据加密，然后存到cookie里面。但是也可以换成别的方式。</strong></p><h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><p>先来了解一下flask默认的session的使用方法。因为要使用session所以必须要设置<code>SECRET_KEY</code>才能正常启动。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">by using flask session to learn distribute system</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line">app.config[<span class="string">'SESSION_PERMANENT'</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 获取session里面的key，如果不存在就返回nothing</span></span><br><span class="line">    <span class="keyword">return</span> session.get(<span class="string">'key'</span>, <span class="string">'nothing'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/test', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">session_test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 设置session里面key的值</span></span><br><span class="line">    session[<span class="string">'key'</span>] = <span class="string">'TEST'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'ok'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/set', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_key</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># 根据参数来设置session里面的key</span></span><br><span class="line">    key = request.args.get(<span class="string">'key'</span>)</span><br><span class="line">    session[<span class="string">'key'</span>] = key</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'ok'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/get', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_key</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> session.get(<span class="string">'key'</span>, <span class="string">'nothing'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/delete', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_key</span><span class="params">()</span>:</span></span><br><span class="line">    session.pop(<span class="string">'key'</span>)</span><br><span class="line">    <span class="comment"># del session['key']</span></span><br><span class="line">    <span class="comment"># session.clear()</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'ok'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>在这里就不给大家截图了，大家可以自己输入这些代码尝试一下。</p><h2 id="session的过期时间"><a href="#session的过期时间" class="headerlink" title="session的过期时间"></a>session的过期时间</h2><p>如果没有设置session的有效时间，默认的就是关闭浏览器之后过期。如果设置<code>session.permanent=True</code>，那session默认31天之后过期。如果不想31天后过期可以设置<code>app.config[&#39;PERMANENT_SESSION_LIFETIME&#39;] = 3600</code>来修改过期时间。</p><h2 id="session的删除"><a href="#session的删除" class="headerlink" title="session的删除"></a>session的删除</h2><p>session的储存方法类似字典。有三种删除的方法<code>session.pop(&#39;key&#39;)</code>, <code>del session[&#39;key&#39;]</code>, <code>session.clear()</code>最后一个表示清除整个session的数据。</p><h2 id="分布式的session"><a href="#分布式的session" class="headerlink" title="分布式的session"></a>分布式的session</h2><p><img src="/post/f61e/1.png" alt></p><p>利用flask-session把session存到服务器里面。flask-session支持多种数据库：</p><ul><li>redis</li><li>memcached</li><li>filesystem</li><li>MongoDB</li><li>sqlalchmey</li></ul><p>因为redis是把数据储存到内存上面的，速度相当快，所以一般用redis来储存session的。</p><p>首先把<code>flask-seesion</code>，<code>redis</code>安装一下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install flask-session</span><br><span class="line">pip3 install redis</span><br></pre></td></tr></table></figure><p>然后在代码里面配置redis的信息就好：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">使用redis来配置session</span></span><br><span class="line"><span class="string">类似分布式的session的数据</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request</span><br><span class="line"><span class="keyword">from</span> flask_session <span class="keyword">import</span> Session</span><br><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> Redis</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置使用session的储存方式</span></span><br><span class="line">app.config[<span class="string">'SESSION_TYPE'</span>] = <span class="string">'redis'</span></span><br><span class="line">app.config[<span class="string">'SESSION_REDIS'</span>] = Redis(</span><br><span class="line">    host=<span class="string">'127.0.0.1'</span>,</span><br><span class="line">    port=<span class="number">6379</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 类似是否对session加密</span></span><br><span class="line">app.config[<span class="string">'SESSION_USE_SIGNER'</span>] = <span class="literal">True</span></span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 是否长期使用session, 一般是关闭的, 浏览器关闭则session失效</span></span><br><span class="line">app.config[<span class="string">'SESSION_PERMANENT'</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># session有效时长</span></span><br><span class="line">app.config[<span class="string">'PERMANENT_SESSION_LIFETIME'</span>] = <span class="number">3600</span></span><br><span class="line">Session(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> session.get(<span class="string">'key'</span>, <span class="string">'nothing'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/test', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">session_test</span><span class="params">()</span>:</span></span><br><span class="line">    session[<span class="string">'key'</span>] = <span class="string">'TEST'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'ok'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/set', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_key</span><span class="params">()</span>:</span></span><br><span class="line">    key = request.args.get(<span class="string">'key'</span>)</span><br><span class="line">    print(key)</span><br><span class="line">    session[<span class="string">'key'</span>] = key</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'ok'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/get', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_key</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> session.get(<span class="string">'key'</span>, <span class="string">'nothing'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>我们可以通过<code>redis-cli</code>来查看相对应的session信息：</p><p><img src="/post/f61e/2.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Distributed-session&quot;&gt;&lt;a href=&quot;#Distributed-session&quot; class=&quot;headerlink&quot; title=&quot;Distributed session&quot;&gt;&lt;/a&gt;Distributed session&lt;/h1&gt;&lt;p&gt;怎么
      
    
    </summary>
    
    
    
      <category term="Distributed" scheme="https://shunyangli.github.io/tags/Distributed/"/>
    
  </entry>
  
  <entry>
    <title>cpp learning note</title>
    <link href="https://shunyangli.github.io/post/da06/"/>
    <id>https://shunyangli.github.io/post/da06/</id>
    <published>2020-06-01T06:41:33.000Z</published>
    <updated>2022-06-14T06:41:24.838Z</updated>
    
    <content type="html"><![CDATA[<p>COMP6771 lecture note. COMP6771学习笔记</p><h1 id="cpp"><a href="#cpp" class="headerlink" title="cpp"></a>cpp</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Hello world"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line">auto main() -&gt; int &#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Hello world"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="cpp-数据类型"><a href="#cpp-数据类型" class="headerlink" title="cpp 数据类型"></a>cpp 数据类型</h1><p>学过c语言应该对数据类型都有所了解，cpp的数据类型和c语言差不多，但是比c语言要多几种。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span>, <span class="keyword">int</span>, <span class="keyword">float</span>, <span class="keyword">double</span>, <span class="keyword">char</span>, <span class="keyword">void</span>(无类型), <span class="keyword">wchar_t</span>(宽字符型)</span><br></pre></td></tr></table></figure><p><code>wchar_t</code> 是这样定义的，所以<code>wchar_t</code>和<code>short int</code>占用的空间一样：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">short</span> <span class="keyword">int</span> <span class="keyword">wchar_t</span>;</span><br></pre></td></tr></table></figure><p><code>typedef</code>的作用就是给数据类型换一个名字而已，语法：<code>typedef type name</code>，比如：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="keyword">int</span> bit;</span><br></pre></td></tr></table></figure><p>编译器会理解成<code>bit</code>和<code>int</code>是一样的数据类型。</p><p><strong>枚举类型：</strong></p><p><code>enum</code>是枚举类型的关键词，枚举类型的定义如下：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> <span class="keyword">enum</span>-name &#123; <span class="built_in">list</span> of names&#125; var-<span class="built_in">list</span>;</span><br></pre></td></tr></table></figure><p>enum-name 是枚举类型名。list of name 是由逗号分隔开的。</p><p>例如，我们可以使用枚举类型来定义一个color：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> color &#123;</span><br><span class="line">    red,</span><br><span class="line">    green,</span><br><span class="line">    blue</span><br><span class="line">&#125; c;</span><br></pre></td></tr></table></figure><p>在color里面red默认是0，green默认是1，blue默认是2。也可以手动去更改相对应的数字，比如:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">enum</span> color &#123;</span><br><span class="line">    red = <span class="number">1</span>,</span><br><span class="line">    green,</span><br><span class="line">    blue</span><br><span class="line">&#125; c;</span><br></pre></td></tr></table></figure><p>那么green就是2，blue就是3。也可以去定义<code>c = red || c = blue</code>等等，这样c代表的就是不同的数字。一般在去设定人物名称或者别的不同类型的时候会用到枚举来替代数字，这样更容易分辨。比如说：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// assume:</span></span><br><span class="line"><span class="comment">// 0 is red,</span></span><br><span class="line"><span class="comment">// 1 is green</span></span><br><span class="line"><span class="comment">// 这样的话很难记住，如果使用枚举就不需要考虑这些，直接对数据进行判断就行</span></span><br><span class="line"><span class="keyword">if</span> (color == red) <span class="comment">/*better than*/</span> <span class="keyword">if</span> (color == <span class="number">1</span>)</span><br><span class="line"><span class="comment">// it's hard to known what is 1</span></span><br></pre></td></tr></table></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">enum</span> color &#123;</span><br><span class="line">    red,</span><br><span class="line">    green,</span><br><span class="line">    blue</span><br><span class="line">&#125; c;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    c = blue;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; c &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; color::red &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>提示：</em></p><ol><li>枚举变量可以直接输出，但<strong>不能直接输入</strong></li><li><strong>不能直接将常量赋给枚举变量</strong></li><li>不同类型的枚举变量之间<strong>不能相互赋值</strong></li><li>枚举变量的输入输出<strong>一般都采用switch</strong>语句将其转换为字符或字符串；枚举类型数据的其他处理也往往应用switch语句，以保证程序的合法性和可读性。</li></ol><p><strong>常见的类型修饰符：</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span>, <span class="keyword">short</span>, <span class="keyword">signed</span>, <span class="keyword">unsigned</span></span><br></pre></td></tr></table></figure><p><em>long int 与 int 都是 4 个字节</em></p><p>可以使用<code>&lt;limits&gt;</code> 来查看相对应的数据类型的限制（在c语言里面声明头文件需要<code>*.h</code>，在cpp里面不需要带.h）</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;limits&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Type size"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Int: "</span> &lt;&lt; <span class="keyword">sizeof</span>(<span class="keyword">int</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Max int: "</span> &lt;&lt; numeric_limits&lt;<span class="keyword">int</span>&gt;::max() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"Min int: "</span> &lt;&lt; numeric_limits&lt;<span class="keyword">int</span>&gt;::min() &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如果使用<code>using namespace xxx;</code>，在调用function的时候不需要<code>xxx:cout</code>，可以直接使用function。<code>endl = \n</code>，就是换行符的意思。<code>&lt;&lt;</code>可以理解为合并字符串，有点类似于shell里面的<code>&lt;</code>（<del>不一样，只是类似</del>） <code>numeric_limits</code>这个函数里面使用到了<em>泛型</em>，但是忘得差不多了o(╥﹏╥)o。。。慢慢补吧，如果学过Java那么应该对这部分比较熟悉。</p><p>变量的声明：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">type variable_name = value;</span><br><span class="line"><span class="keyword">int</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> b,c;</span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> b;</span><br></pre></td></tr></table></figure><p>未初始化的变量都被默认为null。</p><p><strong><em>声明extern关键字的全局变量和函数可以使得它们能够跨文件被访问。</em></strong></p><h1 id="cpp-变量作用域"><a href="#cpp-变量作用域" class="headerlink" title="cpp 变量作用域"></a>cpp 变量作用域</h1><p><strong>局部变量：</strong></p><p>在函数或代码块内部声明的变量称为局部变量。他们在函数体内声明后仅能被其声明的所在函数体内部的后续语句操作。局部变量不能被函数外部访问到。也就是说只作用于这一个函数内：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; a &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; cal(<span class="number">1</span>, <span class="number">2</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> c = a + b;</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>比如在<code>int cal(int,int)</code>里面定义了一个c的变量，那么这个c只能作用于<code>cal</code>这个function内。</p><p><strong>全局变量：</strong></p><p>在整个cpp文件内都可以用。在整个生命周期内都可以使用。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    cal(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; sum &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">cal</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">    sum = a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就可以在任意函数调用<code>sum</code>这个变量。</p><h1 id="cpp-常量"><a href="#cpp-常量" class="headerlink" title="cpp 常量"></a>cpp 常量</h1><p>二进制，八进制，十进制，十六进制。二进制是以<code>0bxx</code>开头，数字范围是0和1。八进制是0开头的，数字范围是0-7。十进制就是我们常用的数字。十六进制是<code>ox</code>开头，取值范围是<code>0-9, A-F</code>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">212 // 合法   </span><br><span class="line">215u// 合法  </span><br><span class="line">0xFeeL  // 合法  </span><br><span class="line">078 // 不合法: 8不是合法的八进制  </span><br><span class="line">032UU   // 不合法: U后缀不能重复使用</span><br></pre></td></tr></table></figure><p>其中<code>u</code>代表的是<code>unsigned</code>，也可以是<code>l</code> 等：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">85 // 十进制</span><br><span class="line">0213   // 八进制</span><br><span class="line">0x4b   // 十六进制</span><br><span class="line">30 // 整型</span><br><span class="line">30u// 无符号整型</span><br><span class="line">30l// 长整型</span><br><span class="line">30ul   // 无符号整型</span><br></pre></td></tr></table></figure><h1 id="cpp储存类型"><a href="#cpp储存类型" class="headerlink" title="cpp储存类型"></a>cpp储存类型</h1><p>储存类型如下：</p><ol><li>auto</li><li>register</li><li>static</li><li>extern</li><li>mutable</li></ol><p><strong>auto储存类型：</strong></p><p><strong>auto</strong> 关键字用于两种情况：声明变量时根据初始化表达式自动推断该变量的类型、声明函数时函数返回值的占位符。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> a = <span class="number">3.14</span>;</span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">int</span> month;</span><br></pre></td></tr></table></figure><p>auto 仅能运用于函数内的局部变量。</p><p><strong>register 存储类型：</strong></p><p><strong>register</strong> 存储类用于定义存<strong>储在寄存器中而不是 RAM 中的局部变量</strong>。这意味着变量的最大尺寸等于寄存器的大小（通常是一个词），<strong>且不能对它应用一元的 ‘&amp;’ 运算符</strong>（因为它没有内存位置）。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">register</span> <span class="keyword">int</span>  miles;</span><br></pre></td></tr></table></figure><p><strong>register类型应该仅应用于需要快速访问的变量</strong>，比如计数器。需要注意的是，定义 register 类型的变量并不意味着该变量一定就存储在寄存器中，这仅仅意味着需要按照硬件以及具体实现的限制来判定到底是不是存储在寄存器中。</p><p><strong>static储存类型：</strong></p><p><strong>static</strong> 存储类型的变量意味着该变量将会从始至终地存活在程序的整个生命周期内，而不会随着每次访问到它所在的代码块时就建立该变量，离开代码块时就销毁该变量</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">call_num</span> <span class="params">()</span></span>;</span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    call_num();</span><br><span class="line">    call_num();</span><br><span class="line">    call_num();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">call_num</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> a = <span class="number">5</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; a-- &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">输出结果：</span></span><br><span class="line"><span class="comment">5</span></span><br><span class="line"><span class="comment">4</span></span><br><span class="line"><span class="comment">3</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p><strong>extern 存储类型：</strong></p><p><strong>extern</strong> 存储类型用于使全局变量的引用对所有程序文件可见。如果前面已经定义了一个变量名，那么就不能再使用 extern 来声明同一变量名的变量了。有点类似于Python的<code>import</code>。</p><p>在<code>main.app</code>中：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">int</span> num;</span><br><span class="line"><span class="function"><span class="keyword">extern</span> <span class="keyword">void</span> <span class="title">write_line</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    num = <span class="number">1</span>;</span><br><span class="line">    write_line();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在<code>write.app</code>中：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">int</span> num;</span><br><span class="line"><span class="comment">//void write_line();</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">write_line</span><span class="params">(<span class="keyword">void</span>)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"count is : "</span> &lt;&lt; num &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>编译： <code>g++ main.cpp write.app -o main</code></p><p>运行：<code>./main</code></p><p>结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">count is : 1</span><br></pre></td></tr></table></figure><p>写着写着发现和C语言如此相似（基础部分）。(<em>^▽^</em>)</p><h1 id="cpp-Const-类型"><a href="#cpp-Const-类型" class="headerlink" title="cpp Const 类型"></a>cpp Const 类型</h1><p><strong>Const</strong> 被当做一个很基础但是很有用的关键字。</p><p><strong>先说下为什么用const：</strong></p><ol><li>Clear code (know a function won’t try and modify something just by reading the signature)</li><li>Immutable objects are easier to reason about.</li><li>The complier <strong>may</strong> be able to mkae certain optimisations</li><li>Immutable objects are <strong>much</strong> easier to use in multithreading situations.</li></ol><p>eg:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> x = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> y = <span class="number">173</span></span><br></pre></td></tr></table></figure><p><strong>const修饰普通类型的变量：</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> <span class="keyword">const</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">int</span> b = a;</span><br><span class="line"></span><br><span class="line">a = <span class="number">8</span>; <span class="comment">// error</span></span><br></pre></td></tr></table></figure><p>a可以被定义为一个常量，也可以把a的内容赋值给b。<strong>但是不能对b再次赋值</strong>。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line">auto main() -&gt; int &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">int</span> a = <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">int</span> *p = (<span class="keyword">int</span>*)&amp;a;</span><br><span class="line">    *p = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; *p &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; <span class="string">"A: "</span> &lt;&lt; *p &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">Output: </span></span><br><span class="line"><span class="comment">1</span></span><br><span class="line"><span class="comment">A: 1</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure><p>我们可以通过得到a的地址，然后对地址直接重新赋值的方法来改变a的值。<strong>（指针就是一个变量的地址，&amp;取地址，*取内容）</strong>。</p><p><strong>const修饰指针变量：</strong></p><ol><li>const修饰指针指向的内容，则内容为不变量</li><li>const修饰指针，则指针为不变量</li><li>const修饰指针和指针指向的内容，则指针和指针指向的内容都是不可变</li></ol><p>For 1：</p><p>内容不可以变，但是可以通过地址重新改变数据。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> a = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> b = a</span><br></pre></td></tr></table></figure><p>当<code>int b = a</code>的时候b只是得到了a的内容，所以可以修改。</p><p>For 2：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">int</span> * <span class="keyword">const</span> p = &amp;a;</span><br><span class="line">*p = <span class="number">9</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// error code</span></span><br><span class="line"><span class="keyword">int</span> c = <span class="number">10</span>;</span><br><span class="line">p = &amp;c;</span><br></pre></td></tr></table></figure><p><em>在const左边，代表地址不可变，所以在第一次把a的地址赋值给p的时候没什么问题，但是当把c的地址赋值给p是就不行，*</em>因为地址不可以变**。</p><p>For 3：</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> a = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> * <span class="keyword">const</span> p = &amp;a;</span><br></pre></td></tr></table></figure><p>啥都变不了。</p><p><strong>ps: 左定值，右定向，const修饰不变量</strong></p><h2 id="References-and-const"><a href="#References-and-const" class="headerlink" title="References and const"></a>References and const</h2><p>在这里reference可以表示为引用的意思。在reference里面<code>&amp;</code>不带比较地址。<strong>一个reference天生就是const。也就是说，一旦将一个reference绑定到一个对象，就无法再将它重新绑定到另一个不同的对象。在声 明一个reference之后没有写法可以将它重新绑定到另外一个对象</strong></p><ul><li><strong>A reference to const means you can’t modify the object using the reference</strong></li><li><strong>The object is still able to be modified, just not through this reference</strong></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> i = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span>&amp; ref = i;</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; ref &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">i++; <span class="comment">// This is fine</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; ref &lt;&lt; <span class="string">'\n'</span>;</span><br><span class="line">ref++; <span class="comment">// This is not</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> j = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span>&amp; jref = j; <span class="comment">// this is allowed</span></span><br><span class="line"><span class="keyword">auto</span>&amp; ref = j; <span class="comment">// not allowed</span></span><br></pre></td></tr></table></figure><h1 id="cpp-functions"><a href="#cpp-functions" class="headerlink" title="cpp functions"></a>cpp functions</h1><p>c++function有两种放回形式</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">auto square(int const x) -&gt; int &#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">square</span><span class="params">(<span class="keyword">int</span> <span class="keyword">const</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Overload：</strong></p><p><strong>指函数名相同，但是它的参数表列个数或顺序，类型不同</strong>。<em>但是不能靠返回类型来判断。</em><br>（1）相同的范围（在同一个作用域中） ；<br>（2）函数名字相同；<br>（3）参数不同；<br>（4）virtual 关键字可有可无。<br>（5）返回值可以不同；</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">auto square(int const x) -&gt; int &#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">auto square(double const x) -&gt; double &#123;</span><br><span class="line">    <span class="keyword">return</span> x * x;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>突然发现了一个很有意思的东西：<code>const int * = int const *</code></strong></p><h2 id="Overload-Resolution"><a href="#Overload-Resolution" class="headerlink" title="Overload Resolution"></a>Overload Resolution</h2><p>这个过程简称方程匹配（function matching）</p><ol><li>Find function name</li><li>Select viable ones: Same number arguments + each argument convertible</li><li>Best match：Type much better in at least one argument</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auto g() -&gt; void;</span><br><span class="line">auto f(int) -&gt; void;</span><br><span class="line">auto f(int, int) -&gt; void;</span><br><span class="line">auto f(double, double = 3.14) -&gt; void;</span><br><span class="line">f(<span class="number">5.6</span>); <span class="comment">// calls f(double, double)</span></span><br></pre></td></tr></table></figure><p>尽量少的overload，或者不用，因为不容易分辨。</p><h2 id="Functions-pass-by-reference"><a href="#Functions-pass-by-reference" class="headerlink" title="Functions: pass by reference"></a>Functions: pass by reference</h2><ul><li>The formal parameter merely acts as an alias for the actual parameter</li><li>Anytime the method/function uses the formal parameter (for reading or writing), it is actually using the actual parameter</li><li>Pass by reference is useful when:<ul><li><strong>The argument has no copy operation</strong></li><li><strong>The argument is large</strong></li></ul></li></ul><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line">auto swap(int&amp; x, int&amp; y) -&gt; void &#123;</span><br><span class="line">  <span class="keyword">auto</span> <span class="keyword">const</span> tmp = x;</span><br><span class="line">  x = y;</span><br><span class="line">  y = tmp;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">auto main() -&gt; int &#123;</span><br><span class="line">  <span class="keyword">auto</span> i = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">auto</span> j = <span class="number">2</span>;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">' '</span> &lt;&lt; j &lt;&lt; <span class="string">'\n'</span>; <span class="comment">// 1 2</span></span><br><span class="line">  swap(i, j);</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">' '</span> &lt;&lt; j &lt;&lt; <span class="string">'\n'</span>; <span class="comment">// 2 1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>reference可以让function的执行速度变快。</p><h1 id="structures"><a href="#structures" class="headerlink" title="structures"></a>structures</h1><p>和c语言的structure差不多的。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">scientist</span> &#123;</span></span><br><span class="line">    <span class="built_in">string</span> family_name;</span><br><span class="line">    <span class="built_in">string</span> given_name;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt; files;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">auto main() -&gt; int &#123;</span><br><span class="line">    scientist s = scientist &#123;</span><br><span class="line">        .family_name = <span class="string">"Li"</span>,</span><br><span class="line">        .given_name = <span class="string">"Shunyang"</span>,</span><br><span class="line">        .files = &#123;</span><br><span class="line">                <span class="string">"c++"</span>,</span><br><span class="line">                <span class="string">"python"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; s.family_name  &lt;&lt; <span class="string">" "</span> &lt;&lt; s.given_name &lt;&lt; s.files[<span class="number">0</span>] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="Declarations-vs-Definitions"><a href="#Declarations-vs-Definitions" class="headerlink" title="Declarations vs Definitions"></a>Declarations vs Definitions</h1><ol><li>A declaration makes known the type and the name of a variable</li><li>A definition is a declaration, but also does extra things<ol><li>A variable definition allocates storage for, and constructs a variable</li><li>A class definition allows you to create variables of the class’ type</li><li>You can call functions with only a declaration, but must provide a definition later</li></ol></li><li>Everything must have precisely one definition</li></ol><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">declared_fn</span><span class="params">(<span class="keyword">int</span> arg)</span></span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">declared_type</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// This class is defined, but not all the methods are.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">defined_type</span> &#123;</span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">declared_member_fn</span><span class="params">(<span class="keyword">double</span>)</span></span>;</span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">defined_member_fn</span><span class="params">(<span class="keyword">int</span> arg)</span> </span>&#123; <span class="keyword">return</span> arg; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// These are all defined.</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">defined_fn</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="number">1</span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">int</span> <span class="keyword">const</span> j = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">auto</span> vd = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt;&#123;&#125;;</span><br></pre></td></tr></table></figure><p><strong>In c++, the global will not 0 without initialization，in function it will be null without initialization both are defination</strong></p><h1 id="Program-error"><a href="#Program-error" class="headerlink" title="Program error"></a>Program error</h1><ol><li>Compile-time</li><li>Link-time</li><li>Run-time</li><li>Logic</li></ol><p>这些错误循序渐进。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auto main() -&gt; int &#123;</span><br><span class="line">  a = <span class="number">5</span>; <span class="comment">// Compile-time error: type not specified</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因为没有返回任何数据，在编译的过程中就可以发现的错误。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"catch2/catch.hpp"</span></span></span><br><span class="line"></span><br><span class="line">auto is_cs6771() -&gt; bool;</span><br><span class="line"></span><br><span class="line">TEST_CASE(<span class="string">"This is all the code"</span>)</span><br><span class="line">  CHECK(is_cs6771()); <span class="comment">// Link-time error: is_cs6771 not defined.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>找到function相对应的文件和声明。（can not find library）</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// attempting to open a file...</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">auto</span> file = <span class="built_in">std</span>::ifstream(<span class="string">"hello.txt"</span>); <span class="keyword">not</span> file) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="built_in">std</span>::runtime_error(<span class="string">"Error: file not found.\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>运行时候出错，不能找到相对应的资源。</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> empty = <span class="built_in">std</span>::<span class="built_in">string</span>(<span class="string">""</span>);</span><br><span class="line">CHECK(empty[<span class="number">0</span>] == <span class="string">'C'</span>); <span class="comment">// Logic error: bad character access</span></span><br></pre></td></tr></table></figure><p>逻辑上的错误，属于操作失误，比如说out index range，这些都是操作的失误。</p><h1 id="Test-Case"><a href="#Test-Case" class="headerlink" title="Test Case"></a>Test Case</h1><p>在cpp test case里面，CHECK和REQUIRED的区别：REQUIRE会导致test立马fail，但是CHECK不会，只会导致一个fail，test case还能继续。</p><h1 id="Week-2-lecture-notes"><a href="#Week-2-lecture-notes" class="headerlink" title="Week 2 lecture notes"></a>Week 2 lecture notes</h1><p>Why do we want to use libraries:</p><ul><li>well documented</li><li>well tested</li><li>well reviewed</li><li>many feedback</li></ul><p>What we use:</p><ul><li>c++ stl</li><li>abseil</li><li>catch2 (testing)</li><li>{fmt} string format</li><li>gsl-lite</li><li>range-v3 (iterators)</li></ul><p><strong>Algorithms and Conatiners and Ranges combined to Iterators.</strong></p><p><code>std::vecotr</code> is always the defalut container</p><p>Sequence containers:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">std</span>::vecotr</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">array</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">deque</span></span><br><span class="line"><span class="built_in">std</span>::forward_list</span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">list</span></span><br></pre></td></tr></table></figure><p>Unordered associate container:</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// a collection of unique keys</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">unordered_map</span></span><br><span class="line">absl::flat_hash_map</span><br><span class="line"></span><br><span class="line"><span class="comment">// a unique key with a values</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">unordered_set</span></span><br><span class="line">absl::flat_hash_set</span><br></pre></td></tr></table></figure><h2 id="String-in-cpp"><a href="#String-in-cpp" class="headerlink" title="String in cpp"></a>String in cpp</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> gretting = <span class="built_in">std</span>::<span class="built_in">string</span>(<span class="string">"hello world"</span>);</span><br></pre></td></tr></table></figure><p>可以在一个区域内使用<code>using namespaces</code></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>::string_literals;</span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> str = <span class="string">"hello world"</span>s;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拼接字符串</span></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> str = absl::StrCat(<span class="string">"hello"</span>, <span class="string">"word"</span>);</span><br></pre></td></tr></table></figure><p>formatting string</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;fmt/format.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 有点类似python的写法，参考python的写法</span></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> str = fmt::format(<span class="string">"Hello: &#123;&#125;"</span>, <span class="string">"world"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// name parameters, 这个参数可以多次使用</span></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> str = fmt::format(<span class="string">"&#123;key&#125;: &#123;value&#125;, &#123;value&#125;"</span>, fmt::arg(<span class="string">"key"</span>, <span class="number">1</span>),</span><br><span class="line">                            fmt::arg(<span class="string">"value"</span>, <span class="number">12</span>));</span><br></pre></td></tr></table></figure><h2 id="vector-in-cpp"><a href="#vector-in-cpp" class="headerlink" title="vector in cpp"></a>vector in cpp</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> vec = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="comment">// 删除末尾的元素</span></span><br><span class="line">vec.pop_back();</span><br><span class="line">REQUIRE(ranges::distance(vec) == <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// erase 的作用也是删除元素，不过可以删除任意位置的元素</span></span><br><span class="line"><span class="comment">// index 从0开始的</span></span><br><span class="line"><span class="built_in">std</span>::erase(vec, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 清空list</span></span><br><span class="line">vec.clear();)</span><br></pre></td></tr></table></figure><p>初始化数组</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 初始化数组长度为5，且每一个元素为0</span></span><br><span class="line"><span class="keyword">auto</span> vec = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(<span class="number">5</span>);</span><br><span class="line">REQUIRE(ranges::distance(vec) == <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">CHECK(vec[<span class="number">0</span>] == <span class="number">0</span>);</span><br><span class="line">CHECK(vec[<span class="number">1</span>] == <span class="number">0</span>);</span><br><span class="line">CHECK(vec[<span class="number">2</span>] == <span class="number">0</span>);</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以指定初始化内容</span></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> str = <span class="built_in">std</span>::<span class="built_in">string</span>(<span class="string">"hello world"</span>);</span><br><span class="line"><span class="keyword">auto</span> all = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;(<span class="number">2</span>, str);</span><br><span class="line"></span><br><span class="line">CHECK(all[<span class="number">0</span>] == str);</span><br><span class="line">CHECK(all[<span class="number">1</span>] == str);</span><br></pre></td></tr></table></figure><h2 id="stack"><a href="#stack" class="headerlink" title="stack"></a>stack</h2><p>可以直接根据reference来写。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#inlcude <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// stack 是先进后出的数据结构</span></span><br><span class="line"><span class="keyword">auto</span> <span class="built_in">stack</span> = <span class="built_in">std</span>::<span class="built_in">stack</span>&lt;card&gt;();</span><br><span class="line">REQUIRE(<span class="built_in">stack</span>.empty());</span><br></pre></td></tr></table></figure><h2 id="queue"><a href="#queue" class="headerlink" title="queue"></a>queue</h2><p>可以直接根据reference来写。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#inlcude <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"> </span><br><span class="line"><span class="comment">// 先进先出</span></span><br><span class="line"><span class="keyword">auto</span> <span class="built_in">queue</span> = <span class="built_in">std</span>::<span class="built_in">queue</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;&#125;;</span><br><span class="line"><span class="built_in">queue</span>.push(<span class="string">"x"</span>);</span><br><span class="line"><span class="built_in">queue</span>.pop();</span><br></pre></td></tr></table></figure><p>记得插图</p><h2 id="some-algorithm-in-iterators"><a href="#some-algorithm-in-iterators" class="headerlink" title="some algorithm in iterators"></a>some algorithm in iterators</h2><p>有毒，直接卡死了。。。但是别的因该是可以的，在使用<code>ranges::swap()</code>的时候速度很快。<br>但是感觉和<code>std::swap</code>没什么区别。。。稍微快了那么一点。。。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#inlcude <span class="meta-string">&lt;range/v3/algorithm.hpp&gt;</span></span></span><br><span class="line"><span class="comment">// count numbers</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> num = ranges::count(<span class="built_in">vector</span>, <span class="string">"x"</span>);</span><br><span class="line"><span class="keyword">auto</span> node = ranges::find(<span class="built_in">vector</span>, <span class="string">"x"</span>);</span><br><span class="line"><span class="comment">// node != vector.end() 才算是找到了，和普通的find效果是一样的</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ranges::adjacent_find 的做用就是找到两个相邻的一样的数据，并且直接返回该数据</span></span><br><span class="line"><span class="comment">// a, b, c, a ranges::adjacent_find(xxx, a)会返回最后一个a</span></span><br><span class="line"><span class="keyword">auto</span> node = ranges::adjacent_find(<span class="built_in">vector</span>, <span class="string">"x"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// ranges::next(xx), 下一个， iterator的形式</span></span><br><span class="line"><span class="keyword">auto</span> node = ranges::next(<span class="built_in">vector</span>);</span><br></pre></td></tr></table></figure><h2 id="Lambda-expressions"><a href="#Lambda-expressions" class="headerlink" title="Lambda expressions"></a>Lambda expressions</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;range/v3/algorithm.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> vec = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'a'</span>&#125;;</span><br><span class="line"><span class="comment">// 使用lambda表达式来计算a的数量</span></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> numbers = ranges::count_if(vec, [](<span class="keyword">auto</span> <span class="keyword">const</span>&amp; x) &#123;</span><br><span class="line">    <span class="keyword">return</span> x == <span class="string">'a'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 也可以指定返回格式，一般都是bool</span></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> numbers = ranges::count_if(vec, [](<span class="keyword">auto</span> <span class="keyword">const</span>&amp; x)-&gt;<span class="keyword">bool</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x == <span class="string">'a'</span>;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">CHECK(numbers == <span class="number">2</span>);</span><br></pre></td></tr></table></figure><p>Surprise binary search</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;range/v3/algorithm.hpp&gt;</span></span></span><br><span class="line"><span class="keyword">auto</span> nums = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;<span class="string">'1'</span>,<span class="string">'3'</span>,<span class="string">'2'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>&#125;;</span><br><span class="line"><span class="comment">// 排序，这两种方法都可以排序，但是ranges快一点。。</span></span><br><span class="line">ranges::sort(nums);</span><br><span class="line"><span class="built_in">std</span>::sort(nums);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"range/v3/algorithm/is_sorted.hpp"</span></span></span><br><span class="line"><span class="comment">// 检查是否排序</span></span><br><span class="line">ranges::is_sorted(nums);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取某一个区间, 这个区间内都是这个element</span></span><br><span class="line"><span class="keyword">auto</span> [first, last] = ranges::equal_range(nums, <span class="string">'1'</span>);</span><br><span class="line"><span class="comment">// first = 3, last = 4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用[temp] 需要声明temp</span></span><br><span class="line"><span class="keyword">auto</span> temp = <span class="string">"1"</span>;</span><br><span class="line">ranges::all_of(first, last, [temp](<span class="keyword">auto</span> <span class="keyword">const</span>&amp; x) &#123;<span class="keyword">return</span> x == temp&#125;);</span><br></pre></td></tr></table></figure><h1 id="Week-2-part-2"><a href="#Week-2-part-2" class="headerlink" title="Week 2 part 2"></a>Week 2 part 2</h1><p>the difference between <code>ranges::distance</code> and <code>vector::size</code><br>下面三种方法都是为了使用auto，来遍历数组</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// E.g. 1</span></span><br><span class="line"><span class="keyword">auto</span> v = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(other.size());</span><br><span class="line"></span><br><span class="line"><span class="comment">// E.g. 2 (yuck, but best option till you get more experience)</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; ranges::distance(v); ++i) &#123;</span><br><span class="line">    <span class="keyword">using</span> size_type = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::size_type; <span class="comment">// C++ typedef</span></span><br><span class="line">    v[gsl_lite::narrow_cast&lt;size_type&gt;(i)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// E.g. 3 i should not leave the scope of the loop</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::size_type&#123;<span class="number">0</span>&#125;; i &lt; v.size(); ++i) &#123;</span><br><span class="line">    v[i];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>类型转换</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> doubles = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">double</span>&gt;&#123;<span class="number">0.0</span>,<span class="number">1.0</span>&#125;;</span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> ints = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&#123;doubles.begin(), doubles.end()&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 所以这时候ints就是</span></span><br><span class="line"><span class="comment">// 2 个0</span></span><br><span class="line">CHECK(ints = <span class="built_in">std</span>::<span class="built_in">vector</span>(<span class="number">2</span>, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p>genreate a sequence of integers on deman<br>生成一个序列</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#inlcude <span class="meta-string">&lt;range/v3/numberic.hpp&gt;</span></span></span><br><span class="line"><span class="comment">// 初始化大小为10的vector</span></span><br><span class="line"><span class="keyword">auto</span> vec = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(<span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// iota的作用就是生成一个从0到vec长度的数字存到vec里面</span></span><br><span class="line"><span class="comment">// 0..ranges::distance(vec)</span></span><br><span class="line">ranges::iota(vec, <span class="number">0</span>);</span><br></pre></td></tr></table></figure><p><strong>使用piping</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;range/v3/range.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span>  <span class="meta-string">&lt;range/v3/view.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 老师ppt上写错了</span></span><br><span class="line"><span class="comment">// 生成的结果好像是array，但是没办法检查type，我也不知道了</span></span><br><span class="line"><span class="comment">// 生成结果是iota_view 不是array </span></span><br><span class="line"><span class="comment">// 输出结果 [0,1,2,3,4,5,6,7,8,9]</span></span><br><span class="line"><span class="keyword">auto</span> numbers = ranges::views::iota(<span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 通过使用pipling的方法转换</span></span><br><span class="line"><span class="keyword">auto</span> vec = numbers | ranges::to&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&gt;;</span><br></pre></td></tr></table></figure><p><strong>Filters(keep if)</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;range/v3/range.hpp&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;range/v3/view.hpp&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> view = ranges::views;</span><br><span class="line"><span class="keyword">auto</span> is_blue = [] (card <span class="keyword">const</span> c) &#123;<span class="keyword">return</span> c.lolor == color::blue&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> all_blue = hand | views::filter(is_blue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 都可以check是不是有这个元素</span></span><br><span class="line">ranges::find();</span><br><span class="line"><span class="comment">// 也可以使用lambda表达式</span></span><br><span class="line">ranges::any_of();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除某个元素，都可以使用lambda的表达式</span></span><br><span class="line"><span class="keyword">auto</span> no_blue = hand | views::remove_if(is_blue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 在使用find的时候差别</span></span><br><span class="line"><span class="built_in">std</span>::find(vec.begin(), vec.end(), x);</span><br><span class="line">ranges::find(vec, x);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// reversing, 反转链表</span></span><br><span class="line"><span class="keyword">auto</span> res = hand | views::reverse;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 还有一个find_if, 但是返回的是指针, 需要*得到内容</span></span><br><span class="line"><span class="keyword">auto</span> res = ranges::find_if (hand, is_blue);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 另一种用法</span></span><br><span class="line">ranges::to&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&gt;(views::reverse(hand));</span><br></pre></td></tr></table></figure><p>transform<br>通过一种形式来转换吧，可以理解为替换</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> res = hand | views::transform([]()&#123;&#125;);</span><br></pre></td></tr></table></figure><p>split</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">views::split(<span class="string">' '</span>) | views::transform([]()&#123;&#125;) | ranges::to&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;;</span><br></pre></td></tr></table></figure><p>join</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> words = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;<span class="string">"hello"</span>, <span class="string">"word"</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> res = words | views::join(<span class="string">' '</span>) | ranges::to&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;;</span><br></pre></td></tr></table></figure><p>concatenating ranges (结合ranges)</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> str1 = <span class="string">"hello "</span>;</span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> str2 = <span class="string">"word"</span>;</span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> str3 = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&#123;<span class="string">" ni"</span>, <span class="string">" hao"</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 合并字符串</span></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> str = views::concat(str1, str2, str3 | views::join(<span class="string">' '</span>)) | ranges:to&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;;</span><br></pre></td></tr></table></figure><p>use only the first n elements</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> vec = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>&#125;;</span><br><span class="line"><span class="comment">// 取前两个</span></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> n = vec | views::take(<span class="number">2</span>) | ranges::to&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&gt;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 取后几个</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">auto</span> <span class="keyword">const</span> n = vec | views::take_last(<span class="number">2</span>) | ranges::to&lt;<span class="built_in">vector</span>&gt;;</span><br></pre></td></tr></table></figure><h1 id="week3"><a href="#week3" class="headerlink" title="week3"></a>week3</h1><h2 id="Explicit-type-conversions"><a href="#Explicit-type-conversions" class="headerlink" title="Explicit type conversions"></a>Explicit type conversions</h2><ol><li>A constructor for a class has only 1 parameter, the compiler will create an<br>implicit type conversion from the parameter to the class</li><li>This may be the behaviour you want(but usually not)<ul><li>You have to opt-out of this implicit type conversion with the explicit keyword</li></ul></li></ol><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 当加了explicit关键字以后就不能使用 auto a3 = 20这种写法了</span></span><br><span class="line"><span class="comment">// 因为explicit是为了避免这种隐式调用</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">age</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> age_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    age(<span class="keyword">int</span> age)</span><br><span class="line">    : age_&#123;age&#125; &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">auto main() -&gt; int &#123;</span><br><span class="line">    age a3 = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">auto</span> a2 = age&#123;<span class="number">20</span>&#125;;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通常情况下是不建议使用的，因为为了保持代码整洁<code>explicit</code>通常不会添加到construcotr里面的。<br>但是貌似在vlab里面还是要加，保持代码稳定</p><p><strong>explicit是为了避免隐式调用。隐式调用通常发生在只有一个参数的时候。。</strong></p><p>比如在不使用explicit的时候这样的写法是可以通过编译的：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    Point(<span class="keyword">int</span> x = <span class="number">1</span>, <span class="keyword">int</span> y = <span class="number">2</span>) : x_&#123;x&#125;, y_&#123;y&#125; &#123;&#125;;</span><br><span class="line">    auto get_x() const -&gt; int &#123;return x_;&#125;;</span><br><span class="line">    auto get_y() const -&gt; int &#123;return y_;&#125;;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> x_;</span><br><span class="line">    <span class="keyword">int</span> y_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">displayPoint</span><span class="params">(<span class="keyword">const</span> Point&amp; p)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"("</span> &lt;&lt; p.get_x() &lt;&lt; <span class="string">","</span></span><br><span class="line">         &lt;&lt; p.get_y() &lt;&lt; <span class="string">")"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">auto main() -&gt; int &#123;</span><br><span class="line">    Point p = <span class="number">2</span>;</span><br><span class="line">    displayPoint(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// (2,2)</span></span><br></pre></td></tr></table></figure><p>虽然<code>displayPoint</code>要求的是一个Point类型，但是我们传过去一个2也能成功编译的。就是因为这隐式调用. 另外说一句, 在对象刚刚定义时, 即使你使用的是赋值操作符<code>=</code>, 也是会调用构造函数, 而不是重载的<code>operator=</code>运算符.</p><p>但是当我们声明了<code>explicit</code>的时候就不可以隐式调用了：</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by lsy on 2020/6/25.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Point</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    explicit Point(int x = 1, int y = 2) : x_&#123;x&#125;, y_&#123;y&#125; &#123;&#125;;</span><br><span class="line">    auto get_x() const -&gt; int &#123;return x_;&#125;;</span><br><span class="line">    auto get_y() const -&gt; int &#123;return y_;&#125;;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> x_;</span><br><span class="line">    <span class="keyword">int</span> y_;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">displayPoint</span><span class="params">(<span class="keyword">const</span> Point&amp; p)</span> </span>&#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"("</span> &lt;&lt; p.get_x() &lt;&lt; <span class="string">","</span></span><br><span class="line">         &lt;&lt; p.get_y() &lt;&lt; <span class="string">")"</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// error </span></span><br><span class="line">auto main() -&gt; int &#123;</span><br><span class="line">    Point p = <span class="number">2</span>;</span><br><span class="line">    displayPoint(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个时候main函数里面这些都会报错的。</p><h2 id="Const-objects"><a href="#Const-objects" class="headerlink" title="Const objects"></a>Const objects</h2><p>Member functions are by default only be possible on non-const objects</p><ul><li>You <strong>can declare a const member function</strong> which is valid on const objects</li><li>A const member function may only modify mutable members<ul><li>A mutable member should mean that the state of the member can change without the state of the object changing</li><li>Good uses of mutable members are rare</li><li>Mutable is not something you should set lightly</li><li>One example where it might be useful is a cache</li></ul></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">person</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">mutable</span> <span class="built_in">std</span>::<span class="built_in">string</span> name_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">person</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">string</span> <span class="keyword">const</span>&amp; name)</span></span></span><br><span class="line">    : name_&#123;name&#125; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    auto set_name(std::string const&amp; name) const -&gt; void &#123;</span><br><span class="line">        name_ = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    auto get_name() const -&gt; std::string const&amp; &#123;</span><br><span class="line">        <span class="keyword">return</span> name_;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">auto main() -&gt; int &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> p1 = person&#123;<span class="string">"charles"</span>&#125;;</span><br><span class="line">    p1.set_name(<span class="string">"charles li"</span>);</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; p1.get_name() &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// const object</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一个const的object只能调用const的function</span></span><br><span class="line"><span class="comment">     * 需要先定义function是const的才呢给你调用</span></span><br><span class="line"><span class="comment">     * 一般只能调用没什么作用的function，不能进行赋值</span></span><br><span class="line"><span class="comment">     * 可以随意定义function是const但是不做任何事情</span></span><br><span class="line"><span class="comment">     * const object 不能修改内部变量的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * 在 const object里面可以使用mutable来修改相对行的变量， 但是调用的function也必须是const的</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="this-function"><a href="#this-function" class="headerlink" title="this function"></a>this function</h2><ul><li>A member function has an extra implicit parameter, named this<ul><li>This is a pointer to the object on behalf of which the function is called</li><li>A member function does not explicitly define it, but may explicitly use it</li><li>The compiler treats an unqualified reference to a class member as being made through the this pointer.</li></ul></li><li>For the next few slides, we’ll be taking a look at the BookSale example in the course repo</li></ul><p>在使用class的时候也可以只用<code>this</code>的方法<br><strong>还有就是在定义的时候可以考虑使用这个， 因为如果变量不使用下划线<code>age_</code>，这样不容易分辨出到底使用的是什么变量可能是gobal或者别的<br>所以一般会采用this。</strong><br>其实就是识情况而定</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">age</span>&#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> age_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    age(<span class="keyword">int</span> age)</span><br><span class="line">    : age_&#123;age&#125; &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    auto get_age() -&gt; int &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;age_;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    auto set_age(const int age) -&gt; void &#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;age_ = age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="static-members"><a href="#static-members" class="headerlink" title="static members"></a>static members</h2><ul><li>Static functions and members belong to the class (i.e. every object), as opposed to a particular object.</li><li>These are essentially globals defined inside the scope of the class<ul><li>Use static members when something is associated with a class, but not a particular instance</li><li><strong>Static data has global lifetime (program start to program end)</strong></li></ul></li></ul><p><code>static</code>可以被全局调用，并且从开始到结束都能存活。<br><code>static</code>的function可以被直接调用，可以不通过object来调用，object没办法调用static function。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">string</span> name_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    user(<span class="built_in">std</span>::<span class="built_in">string</span> <span class="keyword">const</span>&amp; name)</span><br><span class="line">    : name_&#123;name&#125; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    static auto valid_name(std::string const&amp; name) -&gt; bool &#123;</span><br><span class="line">        <span class="keyword">return</span> name.length() &lt; <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">auto main() -&gt; int &#123;</span><br><span class="line">    <span class="keyword">auto</span> name = <span class="built_in">std</span>::<span class="built_in">string</span>&#123;<span class="string">"Charles li"</span>&#125;;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; user::valid_name(name) &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p><code>static</code> 也可以用正变量里面，但是必须在public里面，不然没办法调用。<br><strong>但是在使用变量的时候必须声明是const，不然会报错，但是可以在前面加inline。</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> <span class="keyword">const</span> MAX=<span class="number">123</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// inline表示只能在一个文件里面，只定义一次。。</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">user</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">inline</span> <span class="keyword">static</span> <span class="keyword">int</span> MAX=<span class="number">123</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="OOP"><a href="#OOP" class="headerlink" title="OOP"></a>OOP</h2><p>当使用<code>default</code>的时候表示没有参数，只是为了让编译器安静，没什么用。。。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">intvec</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    intvec() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">intvec</span><span class="params">(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::size_type length)</span></span></span><br><span class="line">    : vec_(length, 0) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; vec_;</span><br><span class="line">&#125;;</span><br><span class="line">auto main() -&gt; int &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> a = intvec&#123;&#125;;</span><br><span class="line">    <span class="keyword">auto</span> b = intvec&#123;<span class="number">2</span>&#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h1 id="week3-part2"><a href="#week3-part2" class="headerlink" title="week3 part2"></a>week3 part2</h1><p><strong><code>nodiscard</code>指的是当返回值被抛弃时，编译器给出警告</strong><br>*<em>friend 友元，别人是你的朋友，他可以访问我的东西。（但不是我可以访问他的东西: *</em></p><ul><li><p>类的友元函数是定义在类外部，但有权访问类的所有私有（private）成员和保护（protected）成员。尽管友元函数的原型有在类的定义中出现过，但是友元函数并不是成员函数。</p></li><li><p>友元可以是一个函数，该函数被称为友元函数；友元也可以是一个类，该类被称为友元类，在这种情况下，整个类及其所有成员都是友元。</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">INTEGER</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="function"><span class="keyword">friend</span> <span class="keyword">void</span> <span class="title">Print</span><span class="params">(<span class="keyword">const</span> INTEGER&amp; obj)</span></span>;<span class="comment">//声明友元函数</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 请注意：print() 不是任何类的成员函数，函数名前不加类声明符</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Print</span><span class="params">(<span class="keyword">const</span> INTEGER&amp; obj）</span></span></span><br><span class="line"><span class="function"><span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    <span class="comment">//函数体</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">void</span> main()</span></span></span><br><span class="line"><span class="function"><span class="params">&#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    INTEGER obj;</span></span></span><br><span class="line"><span class="function"><span class="params">    Print(obj);<span class="comment">//直接调用</span></span></span></span><br><span class="line"><span class="function"><span class="params">&#125;</span></span></span><br></pre></td></tr></table></figure><p>}<br>特点:<br>友元关系不能被继承；<br>友元关系是单向的，不具有交换性。若类 B 是类 A 的友元，类 A 不一定是类 B 的友元，要看在类中是否有相应的声明；<br>友元关系不具有传递性。若类 B 是类 A 的友元，类 C 是 B 的友元，类 C 不一定是类 A 的友元，同样要看类中是否有相应的申明；<br><strong>友元函数并不是类的成员函数，因此在类外定义的时候不能加上 class::function name；</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">// Created by lsy on 2020/6/21.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">point</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> x_;</span><br><span class="line">    <span class="keyword">int</span> y_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    point(<span class="keyword">int</span> <span class="keyword">const</span>&amp; x, <span class="keyword">int</span> <span class="keyword">const</span>&amp; y) : x_&#123;x&#125;, y_&#123;y&#125; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    [[nodiscard]] auto x() const -&gt; int &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;x_;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [[nodiscard]] auto y() const -&gt; int &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;y_;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对operator进行重定义，但是只作用在这个class里面</span></span><br><span class="line">    <span class="keyword">friend</span> point <span class="keyword">operator</span>+(point <span class="keyword">const</span>&amp; p1, point <span class="keyword">const</span>&amp; p2);</span><br><span class="line">    <span class="keyword">friend</span> <span class="built_in">std</span>::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream&amp; os, point <span class="keyword">const</span>&amp; p);</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// friend function可以访问内部class变量，但是class不可以访问friend（关系不够好啊，哈哈哈）</span></span><br><span class="line"><span class="comment">// 而且friend可以访问class的private的变量</span></span><br><span class="line"><span class="comment">// 和普通的定义方法不一样，因为不是类的函数，所以不需要申明class::function name</span></span><br><span class="line">point <span class="keyword">operator</span>+(point <span class="keyword">const</span>&amp; p1, point <span class="keyword">const</span>&amp; p2) &#123;</span><br><span class="line">    <span class="keyword">return</span> point&#123;p1.x() + p2.x(), p1.y() + p2.y()&#125;;</span><br><span class="line">&#125;</span><br><span class="line">point <span class="keyword">operator</span>+(point <span class="keyword">const</span>&amp; p1, point <span class="keyword">const</span>&amp; p2) &#123;</span><br><span class="line">    <span class="keyword">return</span> point&#123;p1.x_ + p2.x_, p1.y_ + p2.y_&#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相当与overloadding一个function</span></span><br><span class="line"><span class="built_in">std</span>::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream&amp; os, point <span class="keyword">const</span>&amp; p) &#123;</span><br><span class="line">    os &lt;&lt; <span class="string">"("</span> &lt;&lt; p.x() &lt;&lt; <span class="string">", "</span> &lt;&lt; p.y() &lt;&lt; <span class="string">")\n"</span>;</span><br><span class="line">    <span class="keyword">return</span> os;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">auto main() -&gt; int &#123;</span><br><span class="line">    <span class="keyword">auto</span> p1 = point&#123;<span class="number">1</span>, <span class="number">2</span>&#125;;</span><br><span class="line">    <span class="keyword">auto</span> p2 = point(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; p1 + p2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>一般把friend的function放在class的定义里面</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">point</span> &#123;</span></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="keyword">int</span> x_;</span><br><span class="line">    <span class="keyword">int</span> y_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    point(<span class="keyword">int</span> <span class="keyword">const</span>&amp; x, <span class="keyword">int</span> <span class="keyword">const</span>&amp; y) : x_&#123;x&#125;, y_&#123;y&#125; &#123;&#125;</span><br><span class="line"></span><br><span class="line">    [[nodiscard]] auto x() const -&gt; int &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;x_;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    [[nodiscard]] auto y() const -&gt; int &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>-&gt;y_;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 对operator进行重定义，但是只作用在这个class里面</span></span><br><span class="line">    <span class="keyword">friend</span> point <span class="keyword">operator</span>+(point <span class="keyword">const</span>&amp; p1, point <span class="keyword">const</span>&amp; p2)&#123;</span><br><span class="line">        <span class="keyword">return</span> point&#123;p1.x() + p2.x(), p1.y() + p2.y()&#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">friend</span> <span class="built_in">std</span>::ostream&amp; <span class="keyword">operator</span>&lt;&lt;(<span class="built_in">std</span>::ostream&amp; os, point <span class="keyword">const</span>&amp; p) &#123;</span><br><span class="line">        os &lt;&lt; <span class="string">"("</span> &lt;&lt; p.x() &lt;&lt; <span class="string">", "</span> &lt;&lt; p.y() &lt;&lt; <span class="string">")\n"</span>;</span><br><span class="line">        <span class="keyword">return</span> os;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><h2 id="operator-overloadding"><a href="#operator-overloadding" class="headerlink" title="operator overloadding"></a>operator overloadding</h2><p>就是对一些操作字符的重构。。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">int</span> <span class="keyword">operator</span>+(<span class="keyword">int</span> <span class="keyword">const</span>&amp; a, <span class="keyword">int</span> <span class="keyword">const</span>&amp; b) &#123;<span class="keyword">return</span> a + b;&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;COMP6771 lecture note. COMP6771学习笔记&lt;/p&gt;
&lt;h1 id=&quot;cpp&quot;&gt;&lt;a href=&quot;#cpp&quot; class=&quot;headerlink&quot; title=&quot;cpp&quot;&gt;&lt;/a&gt;cpp&lt;/h1&gt;&lt;figure class=&quot;highlight c
      
    
    </summary>
    
    
    
      <category term="cpp" scheme="https://shunyangli.github.io/tags/cpp/"/>
    
  </entry>
  
</feed>
