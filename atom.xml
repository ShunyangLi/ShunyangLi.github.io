<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Shunyang Li</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://shunyangli.github.io/"/>
  <updated>2022-09-01T11:16:54.000Z</updated>
  <id>https://shunyangli.github.io/</id>
  
  <author>
    <name>Shunyang Li</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Flink Gelly</title>
    <link href="https://shunyangli.github.io/post/a496/"/>
    <id>https://shunyangli.github.io/post/a496/</id>
    <published>2022-08-27T13:05:38.000Z</published>
    <updated>2022-09-01T11:16:54.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Flink-Gelly"><a href="#Flink-Gelly" class="headerlink" title="Flink Gelly"></a>Flink Gelly</h1><p>Gelly is Flinkâ€™s Graph API. It contains a set of methods and utilities designed to simplify the development of graph analysis applications in Flink. In Gelly, graphs can be converted and modified using advanced functions similar to those provided by the batch API. gelly provides methods for creating, converting and modifying graphs, as well as a library of graph algorithms.</p><h1 id="Load-Graph"><a href="#Load-Graph" class="headerlink" title="Load Graph"></a>Load Graph</h1><p>In Gelly, a <code>Graph</code> is consist of <code>DataSet</code> vertices and <code>DataSet</code> Edges. <code>Vertex</code> is implement based on <code>Tuple2</code>. <code>Edge</code> is implement based on <code>Tuple3</code>. A <code>Vertex</code> is defined by a unique ID and a value. Vertex IDs should implement the Comparable interface. Vertices without value can be represented by setting the value type to NullValue. An <code>Edge</code> is defined by a source ID (the ID of the source Vertex), a target ID (the ID of the target Vertex) and an optional value. The source and target IDs should be of the same type as the Vertex IDs. Edges with no value have a NullValue value type. (<a href="https://nightlies.apache.org/flink/flink-docs-release-1.15/docs/libs/gelly/graph_api/" target="_blank" rel="noopener">https://nightlies.apache.org/flink/flink-docs-release-1.15/docs/libs/gelly/graph_api/</a>).</p><p><code>Graph</code> can be loaded based on <code>DataSet&lt;Vertex&lt;K, VV&gt;&gt;</code> or <code>fromTupleDataSet</code>. To make it easier and faster to load graphs, we can use <code>csv</code> file to load the graph.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ExecutionEnvironment env = ExecutionEnvironment.getExecutionEnvironment();</span><br><span class="line">Graph&lt;Long, Long, Long&gt; graph = Graph.fromCsvReader(<span class="string">"data\\taro.v"</span>, <span class="string">"data\\taro.e"</span>, env)</span><br><span class="line">                .types(Long.class, Long.class, Long.class);</span><br></pre></td></tr></table></figure><p>The data graph format shown below.</p><p>For vertices file:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1,1</span><br><span class="line">2,2</span><br><span class="line">3,3</span><br><span class="line">4,4</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>For edges file:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1,2,0</span><br><span class="line">1,3,0</span><br><span class="line">1,4,0</span><br><span class="line">2,3,0</span><br><span class="line">...</span><br></pre></td></tr></table></figure><h1 id="Tips"><a href="#Tips" class="headerlink" title="Tips"></a>Tips</h1><p>When load the graph with generic type. For example, use <code>fatMap</code> to load the graph. It is possible that you may encounter the following problems:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: org.apache.flink.api.common.functions.InvalidTypesException: Type of TypeVariable <span class="string">'K'</span> in <span class="string">'class org.dkr.graph.io.utils.VertexSplitter'</span> could not be determined. This is most likely a type erasure problem. <span class="function">The type extraction currently supports types with generic variables only in cases where all variables in the return type can be deduced from the input <span class="title">type</span><span class="params">(s)</span>. Otherwise the type has to be specified explicitly using type information.</span></span><br></pre></td></tr></table></figure><p>When this problem is encountered, it can be solved by declaring the return data type. For example:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">DataSet&lt;Tuple2&lt;K, VV&gt;&gt; vertices = data</span><br><span class="line">        .flatMap(<span class="keyword">new</span> FlatMapFunction())</span><br><span class="line">        .returns(Types.TUPLE(TypeInformation.of(dataType), TypeInformation.of(dataType)))</span><br></pre></td></tr></table></figure><p>Another weird issue is that if you use <code>Edge&lt;K, EV&gt;</code> to load edges data, you only have two data types inside your Edge Object (vertex ID type and edge value type). This problem cannot be solved by using <code>returns</code> function. This issue will cause some functions to be unusable, such as <code>graph.inDegrees()</code>. <strong>You can use Tuple&lt;K, K, EV&gt; instead of Edge&lt;K, EV&gt; to solve this issue.</strong> </p><h1 id="Basic-Graph-Algorithms"><a href="#Basic-Graph-Algorithms" class="headerlink" title="Basic Graph Algorithms"></a>Basic Graph Algorithms</h1><h2 id="BFS"><a href="#BFS" class="headerlink" title="BFS"></a>BFS</h2><p>There are two approaches two deisgn the <code>BFS</code> algorithm in <code>Gelly</code>. We can use <code>runVertexCentricIteration</code> or <code>runScatterGatherIteration</code>. </p><h3 id="runVertexCentricIteration-Approach"><a href="#runVertexCentricIteration-Approach" class="headerlink" title="runVertexCentricIteration Approach:"></a><code>runVertexCentricIteration</code> Approach:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Edge;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Graph;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Vertex;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.pregel.ComputeFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.pregel.MessageCombiner;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.pregel.MessageIterator;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BFS</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long src = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">int</span> maxInteractions = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BFSV</span><span class="params">(<span class="keyword">int</span> maxInteractions, Long src)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.src = src;</span><br><span class="line">        <span class="keyword">this</span>.maxInteractions = maxInteractions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Graph&lt;Long, Long, Long&gt; <span class="title">run</span><span class="params">(Graph&lt;Long, Long, Long&gt; graph)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> graph</span><br><span class="line">                .mapVertices(<span class="keyword">new</span> InitVertex(<span class="keyword">this</span>.src))</span><br><span class="line">                .runVertexCentricIteration(<span class="keyword">new</span> VertexComputeFunction(<span class="keyword">this</span>.src), <span class="keyword">new</span> VertexValueCombiner(), <span class="keyword">this</span>.maxInteractions);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">InitVertex</span> <span class="keyword">implements</span> <span class="title">MapFunction</span>&lt;<span class="title">Vertex</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>&gt;, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Long src;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InitVertex</span><span class="params">(Long src)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.src = src;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Long <span class="title">map</span><span class="params">(Vertex&lt;Long, Long&gt; value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (value.getId().equals(<span class="keyword">this</span>.src)) <span class="keyword">return</span> <span class="number">1L</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * send message and update the values.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">VertexComputeFunction</span> <span class="keyword">extends</span> <span class="title">ComputeFunction</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Long src;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">VertexComputeFunction</span><span class="params">(Long src)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.src = src;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">compute</span><span class="params">(Vertex&lt;Long, Long&gt; vertex, MessageIterator&lt;Long&gt; messages)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (vertex.getId().equals(<span class="keyword">this</span>.src)) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Edge&lt;Long, Long&gt; edge : getEdges()) &#123;</span><br><span class="line">                    sendMessageTo(edge.getTarget(), vertex.getValue() + <span class="number">1L</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">                Long minDistance =  Long.MAX_VALUE;</span><br><span class="line">                <span class="keyword">for</span> (Long msg : messages) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (msg &lt; minDistance) &#123;</span><br><span class="line">                        minDistance = msg;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// does not receive any new values</span></span><br><span class="line">                <span class="keyword">if</span> (minDistance == Long.MAX_VALUE) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (vertex.getValue() &gt; minDistance || vertex.getValue() == <span class="number">0L</span>) &#123;</span><br><span class="line">                    setNewVertexValue(minDistance);</span><br><span class="line"></span><br><span class="line">                    <span class="keyword">for</span> (Edge&lt;Long, Long&gt; edge : getEdges()) &#123;</span><br><span class="line">                        <span class="comment">// can not use vertex value to update.</span></span><br><span class="line">                        sendMessageTo(edge.getTarget(), minDistance + <span class="number">1L</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * combiner for vertex's message, choose the smallest one</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">VertexValueCombiner</span> <span class="keyword">extends</span> <span class="title">MessageCombiner</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">combineMessages</span><span class="params">(MessageIterator&lt;Long&gt; messages)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            Long minDistance = Long.MAX_VALUE;</span><br><span class="line">            <span class="keyword">for</span> (Long msg : messages) &#123;</span><br><span class="line">                <span class="keyword">if</span> (msg &lt; minDistance) &#123;</span><br><span class="line">                    minDistance = msg;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            sendCombinedMessage(minDistance);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="runScatterGatherIteration-Approach"><a href="#runScatterGatherIteration-Approach" class="headerlink" title="runScatterGatherIteration Approach:"></a><code>runScatterGatherIteration</code> Approach:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Edge;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Graph;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Vertex;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.spargel.GatherFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.spargel.MessageIterator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.spargel.ScatterFunction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BFS</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long src = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">int</span> maxInteractions = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BFS</span><span class="params">(<span class="keyword">int</span> maxInteractions, Long src)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.src = src;</span><br><span class="line">        <span class="keyword">this</span>.maxInteractions = maxInteractions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * return a new graph with the bfs traversal order</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> graph input data graph</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> a new graph</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Graph&lt;Long, Long, Long&gt; <span class="title">run</span><span class="params">(Graph&lt;Long, Long, Long&gt; graph)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> graph</span><br><span class="line">                .mapVertices(<span class="keyword">new</span> InitVertex(<span class="keyword">this</span>.src))</span><br><span class="line">                .runScatterGatherIteration(<span class="keyword">new</span> MapOrderMessenger(), <span class="keyword">new</span> VertexOrderUpdater(), <span class="keyword">this</span>.maxInteractions);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * init the vertex value, the vertex value present the traversal order</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">InitVertex</span> <span class="keyword">implements</span> <span class="title">MapFunction</span>&lt;<span class="title">Vertex</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>&gt;, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Long src;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InitVertex</span><span class="params">(Long src)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.src = src;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Long <span class="title">map</span><span class="params">(Vertex&lt;Long, Long&gt; value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (value.getId().equals(<span class="keyword">this</span>.src)) <span class="keyword">return</span> <span class="number">1L</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * traversal the vertex, if it has been visited, then send the traversal order to its neighbor</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MapOrderMessenger</span> <span class="keyword">extends</span> <span class="title">ScatterFunction</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessages</span><span class="params">(Vertex&lt;Long, Long&gt; vertex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (vertex.getValue() &gt; <span class="number">0L</span>) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Edge&lt;Long, Long&gt; edge : getEdges()) &#123;</span><br><span class="line">                    sendMessageTo(edge.getTarget(), vertex.getValue() + <span class="number">1L</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * based on the received message, then update the vertex value</span></span><br><span class="line"><span class="comment">     * since the processing is parallel, the received value can be multiple time, choose the smallest one</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">VertexOrderUpdater</span> <span class="keyword">extends</span> <span class="title">GatherFunction</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateVertex</span><span class="params">(Vertex&lt;Long, Long&gt; vertex, MessageIterator&lt;Long&gt; inMessages)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            Long minDistance = Long.MAX_VALUE;</span><br><span class="line">            <span class="keyword">for</span> (Long msg : inMessages) &#123;</span><br><span class="line">                <span class="keyword">if</span> (msg &lt; minDistance) &#123;</span><br><span class="line">                    minDistance = msg;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (vertex.getValue() &gt; minDistance || vertex.getValue() == <span class="number">0L</span>) &#123;</span><br><span class="line">                setNewVertexValue(minDistance);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>For the usage of these functions, please refer to <a href="https://nightlies.apache.org/flink/flink-docs-release-1.15/docs/libs/gelly/iterative_graph_processing/" target="_blank" rel="noopener">doc</a></p><h2 id="K-core-Decomposition"><a href="#K-core-Decomposition" class="headerlink" title="K-core Decomposition"></a>K-core Decomposition</h2><blockquote><p>A k-core of G can therefore be obtained by recursively removing all the vertices of degree less than k, until<br>all vertices in the remaining graph have at least degree k (<a href="https://hal.archives-ouvertes.fr/hal-00004807v2/document" target="_blank" rel="noopener">https://hal.archives-ouvertes.fr/hal-00004807v2/document</a>)</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.FilterFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Edge;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Graph;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Vertex;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.VertexJoinFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.spargel.GatherFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.spargel.MessageIterator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.spargel.ScatterFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.types.LongValue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Objects;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">KCore</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Long k;</span><br><span class="line">    <span class="keyword">private</span>  <span class="keyword">int</span> maxInteractions = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">KCore</span><span class="params">(<span class="keyword">int</span> maxInteractions, Long k)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.k = k;</span><br><span class="line">        <span class="keyword">this</span>.maxInteractions = maxInteractions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Graph&lt;Long, Long, Long&gt; <span class="title">run</span><span class="params">(Graph&lt;Long, Long, Long&gt; graph)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// set the new values</span></span><br><span class="line">        <span class="keyword">return</span> graph</span><br><span class="line">                .joinWithVertices(graph.inDegrees(), <span class="keyword">new</span> VertexUpdateFunction())</span><br><span class="line">                .runScatterGatherIteration(<span class="keyword">new</span> VertexDegreeMessenger(<span class="keyword">this</span>.k), <span class="keyword">new</span> VertexDegreeUpdater(), <span class="keyword">this</span>.maxInteractions)</span><br><span class="line">                .filterOnVertices(<span class="keyword">new</span> FilterFunction&lt;Vertex&lt;Long, Long&gt;&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">filter</span><span class="params">(Vertex&lt;Long, Long&gt; value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> value.getValue() &gt; <span class="number">0</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * based on the degree value to update the vertex value</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">VertexUpdateFunction</span> <span class="keyword">implements</span> <span class="title">VertexJoinFunction</span>&lt;<span class="title">Long</span>, <span class="title">LongValue</span>&gt; </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Long <span class="title">vertexJoin</span><span class="params">(Long vertexValue, LongValue inputValue)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Long.valueOf(String.valueOf(inputValue));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * if the vertex value is less than k, then set the vertex value as 0</span></span><br><span class="line"><span class="comment">     * and the send the indicator to message</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">VertexDegreeMessenger</span> <span class="keyword">extends</span> <span class="title">ScatterFunction</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>, <span class="title">String</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Long k;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">VertexDegreeMessenger</span><span class="params">(Long k)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.k = k;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessages</span><span class="params">(Vertex&lt;Long, Long&gt; vertex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (vertex.getValue() &lt; <span class="keyword">this</span>.k) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Edge&lt;Long, Long&gt; edge : getEdges()) &#123;</span><br><span class="line">                    sendMessageTo(edge.getTarget(), vertex.getId() + <span class="string">" "</span> + edge.getTarget());</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                sendMessageTo(vertex.getId(), <span class="string">"0"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * based on the received message, to check whether the degree has been updated</span></span><br><span class="line"><span class="comment">     * if not updated, then update the degree by minus 1. if the status is 0, then set the degree as 0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">VertexDegreeUpdater</span> <span class="keyword">extends</span> <span class="title">GatherFunction</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>, <span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> HashMap&lt;String, Boolean&gt; map;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">VertexDegreeUpdater</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateVertex</span><span class="params">(Vertex&lt;Long, Long&gt; vertex, MessageIterator&lt;String&gt; inMessages)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (String msg : inMessages) &#123;</span><br><span class="line">                <span class="keyword">if</span> (Objects.equals(msg, <span class="string">"0"</span>)) &#123;</span><br><span class="line">                    setNewVertexValue(<span class="number">0L</span>);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (map.containsKey(msg)) <span class="keyword">continue</span>;</span><br><span class="line">                map.put(msg, <span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">                setNewVertexValue(vertex.getValue() - <span class="number">1</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Connected-Component"><a href="#Connected-Component" class="headerlink" title="Connected Component"></a>Connected Component</h2><p>Connected component detection in Flink Gelly:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.FilterFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Edge;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Graph;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Vertex;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.spargel.GatherFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.spargel.MessageIterator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.spargel.ScatterFunction;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Connected component detection</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CC</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxInteractions = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CC</span><span class="params">(<span class="keyword">int</span> maxInteractions)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.maxInteractions = maxInteractions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Graph&lt;Long, Long, Long&gt; <span class="title">run</span><span class="params">(Graph&lt;Long, Long, Long&gt; graph)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> graph</span><br><span class="line">                .mapVertices(<span class="keyword">new</span> InitVertex())</span><br><span class="line">                .runScatterGatherIteration(</span><br><span class="line">                        <span class="keyword">new</span> MapOrderMessenger(),</span><br><span class="line">                        <span class="keyword">new</span> VertexOrderUpdater(),</span><br><span class="line">                        <span class="keyword">this</span>.maxInteractions);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">InitVertex</span> <span class="keyword">implements</span> <span class="title">MapFunction</span>&lt;<span class="title">Vertex</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>&gt;, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Long <span class="title">map</span><span class="params">(Vertex&lt;Long, Long&gt; value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * the first visited vertex id will be the root of the connect component</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MapOrderMessenger</span> <span class="keyword">extends</span> <span class="title">ScatterFunction</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessages</span><span class="params">(Vertex&lt;Long, Long&gt; vertex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">for</span> (Edge&lt;Long, Long&gt; edge : getEdges()) &#123;</span><br><span class="line">                sendMessageTo(edge.getTarget(), vertex.getValue());</span><br><span class="line">            &#125;</span><br><span class="line">            sendMessageTo(vertex.getId(), vertex.getId());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * choose the root of the connect component</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">VertexOrderUpdater</span> <span class="keyword">extends</span> <span class="title">GatherFunction</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateVertex</span><span class="params">(Vertex&lt;Long, Long&gt; vertex, MessageIterator&lt;Long&gt; inMessages)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            Long minDistance = Long.MAX_VALUE;</span><br><span class="line">            <span class="keyword">for</span> (Long msg : inMessages) &#123;</span><br><span class="line">                <span class="keyword">if</span> (msg &lt; minDistance) &#123;</span><br><span class="line">                    minDistance = msg;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (vertex.getValue() &gt; minDistance || vertex.getValue() == <span class="number">0L</span>) &#123;</span><br><span class="line">                setNewVertexValue(minDistance);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Single-Source-Shortest-Path"><a href="#Single-Source-Shortest-Path" class="headerlink" title="Single Source Shortest Path"></a>Single Source Shortest Path</h2><p>Given a source vertex, find the shortest path to its neighbor:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.FilterFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.api.common.functions.MapFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Edge;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Graph;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.Vertex;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.spargel.GatherFunction;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.spargel.MessageIterator;</span><br><span class="line"><span class="keyword">import</span> org.apache.flink.graph.spargel.ScatterFunction;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * single source shortest path</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SSSP</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> maxInteractions = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> Long src = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SSSP</span><span class="params">(<span class="keyword">int</span> maxInteractions, Long src)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.src = src;</span><br><span class="line">        <span class="keyword">this</span>.maxInteractions = maxInteractions;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Graph&lt;Long, Long, Long&gt; <span class="title">run</span><span class="params">(Graph&lt;Long, Long, Long&gt; graph)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> graph</span><br><span class="line">                .mapVertices(<span class="keyword">new</span> InitVertex(<span class="keyword">this</span>.src))</span><br><span class="line">                .runScatterGatherIteration(</span><br><span class="line">                        <span class="keyword">new</span> MapOrderMessenger(),</span><br><span class="line">                        <span class="keyword">new</span> VertexOrderUpdater(),</span><br><span class="line">                        <span class="keyword">this</span>.maxInteractions)</span><br><span class="line">                .filterOnVertices(<span class="keyword">new</span> FilterFunction&lt;Vertex&lt;Long, Long&gt;&gt;() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">filter</span><span class="params">(Vertex&lt;Long, Long&gt; value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                        <span class="keyword">return</span> value.getValue() != Long.MAX_VALUE;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">InitVertex</span> <span class="keyword">implements</span> <span class="title">MapFunction</span>&lt;<span class="title">Vertex</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>&gt;, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">final</span> Long src;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InitVertex</span><span class="params">(Long src)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.src = src;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> Long <span class="title">map</span><span class="params">(Vertex&lt;Long, Long&gt; value)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (value.getId().equals(<span class="keyword">this</span>.src)) <span class="keyword">return</span> <span class="number">0L</span>;</span><br><span class="line">            <span class="keyword">return</span> Long.MAX_VALUE;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">MapOrderMessenger</span> <span class="keyword">extends</span> <span class="title">ScatterFunction</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessages</span><span class="params">(Vertex&lt;Long, Long&gt; vertex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (vertex.getValue() != Long.MAX_VALUE) &#123;</span><br><span class="line">                <span class="keyword">for</span> (Edge&lt;Long, Long&gt; edge : getEdges()) &#123;</span><br><span class="line">                    sendMessageTo(edge.getTarget(), vertex.getValue() + edge.getValue());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * choose the root of the connect component</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">VertexOrderUpdater</span> <span class="keyword">extends</span> <span class="title">GatherFunction</span>&lt;<span class="title">Long</span>, <span class="title">Long</span>, <span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateVertex</span><span class="params">(Vertex&lt;Long, Long&gt; vertex, MessageIterator&lt;Long&gt; inMessages)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">            Long minDistance = Long.MAX_VALUE;</span><br><span class="line">            <span class="keyword">for</span> (Long msg : inMessages) &#123;</span><br><span class="line">                <span class="keyword">if</span> (msg &lt; minDistance) &#123;</span><br><span class="line">                    minDistance = msg;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (vertex.getValue() &gt; minDistance) &#123;</span><br><span class="line">                setNewVertexValue(minDistance);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Flink-Gelly&quot;&gt;&lt;a href=&quot;#Flink-Gelly&quot; class=&quot;headerlink&quot; title=&quot;Flink Gelly&quot;&gt;&lt;/a&gt;Flink Gelly&lt;/h1&gt;&lt;p&gt;Gelly is Flinkâ€™s Graph API. It con
      
    
    </summary>
    
    
    
      <category term="Distributed" scheme="https://shunyangli.github.io/tags/Distributed/"/>
    
  </entry>
  
  <entry>
    <title>Flask API</title>
    <link href="https://shunyangli.github.io/post/30e4/"/>
    <id>https://shunyangli.github.io/post/30e4/</id>
    <published>2022-07-20T10:08:04.000Z</published>
    <updated>2022-07-20T10:17:01.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Flask-API"><a href="#Flask-API" class="headerlink" title="Flask API"></a>Flask API</h1><p>ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹<code>flask api</code> å’Œ <a href="https://flask-restful.readthedocs.io/en/latest/" target="_blank" rel="noopener">Flask-RESTful API </a> çš„ä¸¤ç§ä¸åŒç”¨æ³•ã€‚ã€‚é¦–å…ˆAPIåªä¼šè¿”å›žjsonçš„ç±»åž‹ï¼Œä¸ä¼šè¿”å›žHTMLã€‚APIä¸€èˆ¬é€‚ç”¨äºŽå‰åŽç«¯åˆ†ç¦»çš„æƒ…å†µã€‚Flask APIçš„å®žçŽ°æ–¹å¼æœ‰ä¸¤ç§ã€‚ç¬¬ä¸€ç§å°±æ˜¯ä¸ç”¨<code>flask_restplus</code>ã€‚ç¬¬äºŒç§æ˜¯ç”¨<code>flask_restplus</code>ã€‚é¦–å…ˆç»™å¤§å®¶è¯´ä¸€ä¸‹ä¸ç”¨<code>flask_restplus</code>æ€Žä¹ˆå†™ã€‚</p><h2 id="ä¸ä½¿ç”¨-flask-restplus"><a href="#ä¸ä½¿ç”¨-flask-restplus" class="headerlink" title="ä¸ä½¿ç”¨ flask_restplus"></a>ä¸ä½¿ç”¨ flask_restplus</h2><p>åœ¨ä¸é€‚ç”¨<code>flask_restplus</code>çš„æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥ç›´æŽ¥ä½¿ç”¨routeçš„å½¢å¼æ¥å†™APIã€‚åªæ˜¯æŠŠ<code>return render_template</code>æ”¹æˆäº†<code>return jsonify</code> æ¥è¿”å›žä¸€ä¸ªjsonç±»åž‹çš„æ•°æ®ã€‚å¯ä»¥æ ¹æ®ä¸åŒçš„requestçš„æ–¹å¼(GET, POST, DELETE)å¯ä»¥å¤„ç†ä¸åŒçš„äº‹æƒ…ï¼Œæ¯”å¦‚DELETEå¯ä»¥ç”¨æ¥åˆ é™¤æ•°æ®ï¼Œ POSTå¯ä»¥æ·»åŠ æ•°æ®ï¼ŒGETå¯ä»¥èŽ·å–æ•°æ®ã€‚å…·ä½“å®žçŽ°æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, jsonify</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># SECRET_KEY å¯ä»¥è®¾ç½®ä¸ºä»»æ„çš„string</span></span><br><span class="line">app.config[<span class="string">"SECRET_KEY"</span>] = <span class="string">"WHATEVER"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/index', methods=["POST","GET","DELETE"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"GET"</span>:</span><br><span class="line">        username = request.args.get(<span class="string">"username"</span>)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">"GET"</span>: username&#125;)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        username = request.args.get(<span class="string">"username"</span>)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">"POST"</span>: username&#125;)</span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"DELETE"</span>:</span><br><span class="line">        username = request.args.get(<span class="string">"username"</span>)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">"DELETE"</span>: username&#125;)</span><br><span class="line"></span><br><span class="line">app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>GET è¯·æ±‚æµ‹è¯•å¦‚ä¸‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "http://127.0.0.1:5000/index?username=admin" -H "accept: application/json"</span><br></pre></td></tr></table></figure><p>ç»“æžœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"GET"</span>: <span class="string">"admin"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>POST è¯·æ±‚æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST "http://127.0.0.1:5000/index?username=admin" -H "accept: application/json"</span><br></pre></td></tr></table></figure><p>ç»“æžœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"POST"</span>: <span class="string">"admin"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>DELETE è¯·æ±‚æµ‹è¯•å¦‚ä¸‹</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X DELETE "http://127.0.0.1:5000/index?username=admin" -H "accept: application/json"</span><br></pre></td></tr></table></figure><p>ç»“æžœå¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"DELETE"</span>: <span class="string">"admin"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ä½¿ç”¨flask-restplus"><a href="#ä½¿ç”¨flask-restplus" class="headerlink" title="ä½¿ç”¨flask_restplus"></a>ä½¿ç”¨flask_restplus</h2><p>Flask-RESTful æä¾›äº† reqparse ä¸€ç§ç±»ä¼¼ argparse å‚æ•°è§£æžæœºåˆ¶ä»¥ç®€åŒ–å‚æ•°å¤„ç†ã€‚æ‰€ä»¥å¤„ç†è¯·æ±‚æ•°æ®çš„æ—¶å€™å’ŒFlaskä¸å¤ªä¸€æ ·ã€‚<code>parser = reqparse.RequestParser():</code> reqparseä½¿ç”¨RequestParser() å¯ä»¥ä»Ž flask.Request.valuesï¼Œä»¥åŠ flask.Request.json è§£æžå€¼ã€‚è¿™é‡Œåˆ›å»ºäº†ä¸€ä¸ªè§£æžå¯¹è±¡parserã€‚<code>parser.add_argument(&#39;task&#39;)ï¼š</code>å‘parserå¯¹è±¡ä¸­æ·»åŠ ä½ è¦å…³æ³¨çš„å‘½ä»¤è¡Œå‚æ•°å’Œé€‰é¡¹ï¼Œæ¯ä¸€ä¸ªadd_argumentæ–¹æ³•å¯¹åº”ä¸€ä¸ªä½ è¦å…³æ³¨çš„å‚æ•°æˆ–é€‰é¡¹ã€‚<code>parser.parse_args()ï¼š</code>è°ƒç”¨parse_args()æ–¹æ³•è¿›è¡Œè§£æžï¼Œè§£æžæˆåŠŸä¹‹åŽå³å¯ä½¿ç”¨ã€‚<code>POST, GET, DELETE</code>èŽ·å–å‚æ•°çš„æ–¹å¼ä¸€æ ·ã€‚åœ¨å®šä¹‰APIçš„æ—¶å€™å¯ä»¥æ˜¯ç”¨<code>@api.param</code>æ·»åŠ å‚æ•°ï¼Œåœ¨webç«¯æµ‹è¯•çš„æ—¶å€™æ¯”è¾ƒæ–¹ä¾¿ã€‚<code>@app.doc(description=&#39;xx&#39;)</code>æ·»åŠ å¯¹è¿™ä¸ªAPIçš„æè¿°ã€‚<code>@app.response(200,&#39;success&#39;)</code>å®šä¹‰è·¯ç”±codeçš„ä¿¡æ¯ï¼Œæ™®éæ˜¯ç”¨çš„æ˜¯200ï¼Œ404ï¼Œ400ï¼Œ403ç­‰ç­‰ã€‚</p><p>æˆ‘å‘çŽ°æœ€è¿‘flaskçš„ç‰ˆæœ¬ç¨³å®šæ€§å¾ˆå·®ï¼Œå°¤å…¶æ˜¯<code>werkzeug</code>å’Œflaskä¹‹é—´çš„ç‰ˆæœ¬å†²çªï¼Œå¤§å®¶æœ€å¥½ç”¨è™šæ‹Ÿæœºè¿›è¡Œæµ‹è¯•å®žéªŒæ¯”è¾ƒå¥½ã€‚ã€‚ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify, make_response, request</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Api, reqparse, abort, Resource</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = <span class="string">'WHATEVER'</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@api.route('/login')</span></span><br><span class="line"><span class="meta">@api.param('username')</span></span><br><span class="line"><span class="meta">@api.doc(description="This is test")</span></span><br><span class="line"><span class="meta">@api.response(200, 'Success')</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span><span class="params">(Resource)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">()</span>:</span></span><br><span class="line">        parser = reqparse.RequestParser()</span><br><span class="line">        parser.add_argument(<span class="string">'username'</span>, type=str)</span><br><span class="line">        args = parser.parse_args()</span><br><span class="line">        username = args.get(<span class="string">"username"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å¦‚æžœç»“æžœæ­£ç¡®å¯ä»¥ç›´æŽ¥make_response</span></span><br><span class="line">        <span class="comment"># å¦‚æžœä¸æ­£ç¡®å¯ä»¥ç”¨abort</span></span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">"admin"</span>:</span><br><span class="line">            <span class="keyword">return</span> make_response(jsonify(&#123;<span class="string">"POST"</span>: username&#125;),<span class="number">200</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            abort(<span class="number">400</span>, <span class="string">"username not currect"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">()</span>:</span></span><br><span class="line">        parser = reqparse.RequestParser()</span><br><span class="line">        parser.add_argument(<span class="string">'username'</span>, type=str)</span><br><span class="line">        args = parser.parse_args()</span><br><span class="line">        username = args.get(<span class="string">"username"</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> username == <span class="string">"admin"</span>:</span><br><span class="line">            <span class="keyword">return</span> make_response(jsonify(&#123;<span class="string">"GET"</span>: username&#125;),<span class="number">200</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            abort(<span class="number">400</span>, <span class="string">"username not currect"</span>)</span><br><span class="line"></span><br><span class="line">app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>GET è¯·æ±‚æµ‹è¯•ï¼š</p><p>APIçš„è¯·æ±‚æ–¹æ³•å’Œflaskä¸å¤ªä¸€æ ·ï¼Œéœ€è¦ <code>-d åŠ ä¸Šå‚æ•°</code>ï¼Œ POSTè¯·æ±‚ä¹Ÿæ˜¯ä¸€æ ·</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "http://127.0.0.1:5000/login" -H "accept: application/json" -d "username=admin"</span><br></pre></td></tr></table></figure><p>è¯·æ±‚ç»“æžœï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"GET"</span>: <span class="string">"admin"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>POST è¯·æ±‚æµ‹è¯•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST "http://127.0.0.1:5000/login" -H "accept: application/json" -d "username=admin"</span><br></pre></td></tr></table></figure><p>è¯·æ±‚ç»“æžœï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"POST"</span>: <span class="string">"admin"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»™å¤§å®¶çœ‹ä¸€ä¸‹<code>abort</code>çš„æ˜¾ç¤ºç»“æžœï¼š</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"message"</span>: <span class="string">"username not currect"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…å¤§å®¶å¯ä»¥ç›´æŽ¥æ‰“å¼€<code>http://127.0.0.1:5000</code>å¯ä»¥æ˜¾ç¤ºç•Œé¢æ¥æµ‹è¯•ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š </p><p><img src="/post/30e4/s.png" alt></p><h1 id="å‰ç«¯è¯·æ±‚API"><a href="#å‰ç«¯è¯·æ±‚API" class="headerlink" title="å‰ç«¯è¯·æ±‚API"></a>å‰ç«¯è¯·æ±‚API</h1><p>æ˜¨å¤©å†™çš„å¤ªæ™šå°±å…ˆç¡äº†ï¼Œä»Šå¤©ç»™è¡¥ä¸Šæ€Žä¹ˆç”¨<code>AJAX</code>ä¹Ÿå°±æ˜¯å‰ç«¯æ¥è¯·æ±‚APIæ•°æ®çš„ã€‚å¤§å®¶å¯ä»¥è‡ªè¡Œäº†è§£ä¸€ä¸‹<code>AJAX</code>çš„functionä»€ä¹ˆçš„ï¼Œdemoç”¨çš„æ˜¯<code>JQuery</code>ä¸­çš„<code>AJAX</code>ã€‚å› ä¸ºç‰µæ¶‰åˆ°äº†è·¨åŸŸè¯·æ±‚ï¼Œæ‰€ä»¥åŽç«¯ä¹Ÿç¨å¾®æœ‰ä¸€ç‚¹æ”¹å˜ã€‚éœ€è¦ç”¨åˆ°<code>flask_cors</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚åªéœ€è¦åœ¨ä¸Šé¢çš„Pythonä»£ç åŠ ä¸¤è¡Œä»£ç å°±OKäº†ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask_cors <span class="keyword">import</span> CORS</span><br><span class="line">...... <span class="comment"># è¿™äº›æ˜¯åˆå§‹åŒ–appéƒ¨åˆ†</span></span><br><span class="line">CORS(app)</span><br><span class="line">......</span><br></pre></td></tr></table></figure><p>å¦‚æžœä¸åŠ <code>CROS(app)</code>çš„è¯ä¼šåœ¨æµè§ˆå™¨çš„è°ƒè¯•<code>Console</code>å‡ºçŽ°ä»¥ä¸‹æŠ¥é”™ï¼š</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Access to XMLHttpRequest at <span class="string">'http://127.0.0.1:5000/login?username=admi'</span> <span class="keyword">from</span> origin <span class="string">'null'</span> has been blocked by CORS policy: No <span class="string">'Access-Control-Allow-Origin'</span> header is present on the requested resource.</span><br></pre></td></tr></table></figure><p>å‰ç«¯ä»£ç å…·ä½“å®žçŽ°å¦‚ä¸‹ï¼š</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span></span><br><span class="line"><span class="javascript">    $.ajax (&#123;</span></span><br><span class="line"><span class="javascript">        url: <span class="string">'http://127.0.0.1:5000/login'</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line"><span class="javascript">            username: <span class="string">"admin"</span></span></span><br><span class="line">        &#125;, </span><br><span class="line"><span class="javascript">        error: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="comment">// data åŒ…å«äº†æ•´ä¸ªçš„é”™è¯¯ä¿¡æ¯</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// data.status æŒ‡çš„æ˜¯è¿”å›žçš„é”™è¯¯ä»£ç ï¼Œæ¯”å¦‚400</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">// data.responseJSON.message æŒ‡è¿”å›žçš„é”™è¯¯ä¿¡æ¯ï¼Œ username not currect</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"ERROR: "</span>, data)</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        success: <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(data)</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        type: <span class="string">"GET"</span></span></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="æ‹“å±•"><a href="#æ‹“å±•" class="headerlink" title="æ‹“å±•"></a>æ‹“å±•</h1><p>å½“æˆ‘ä»¬æœ‰å¤šä¸ª<code>api</code>åŠŸèƒ½éœ€è¦å®žçŽ°ï¼Œæ¯”å¦‚ç™»å½•ï¼Œæ³¨å†Œç­‰ç­‰ã€‚ä¸ºäº†æ›´å¥½çš„åŒºåˆ†æ¯ä¸ªåŠŸèƒ½ä¹‹é—´çš„urlï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>api.namespace()</code>å¯¹ä¸åŒåŠŸèƒ½åˆ›å»ºä¸åŒçš„å˜é‡ã€‚æ¯”å¦‚æˆ‘ä»¬éœ€è¦å®žçŽ°æ³¨å†Œï¼Œç™»å½•ï¼ˆéªŒè¯æ¨¡å—ï¼‰æ—¶æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>auth = api.namespace(&#39;auth&#39;, description=&quot;Authentication Services&quot;)</code>ã€‚åŒæ—¶ä¸ºäº†èƒ½æ›´åŠ æ–¹ä¾¿çš„åœ¨apiæä¾›çš„æŽ¥å£é‡Œé¢è¿›è¡Œæµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸ªmethodè¿›è¡Œå£°æ˜Ž<code>response</code>ï¼Œ<code>param</code> æˆ–è€…<code>doc</code>ç­‰ç­‰ã€‚æ¯”å¦‚ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, jsonify, make_response, request</span><br><span class="line"><span class="keyword">from</span> flask_restplus <span class="keyword">import</span> Api, reqparse, abort, Resource</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">api = Api(app)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = <span class="string">'WHATEVER'</span></span><br><span class="line"></span><br><span class="line">auth = api.namespace(<span class="string">'auth'</span>, description=<span class="string">"Authentication Services"</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@auth.route("/login", strict_slashes=False)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Login</span><span class="params">(Resource)</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @auth.response(200, 'Success')</span></span><br><span class="line"><span class="meta">    @auth.response(400, 'Missing args')</span></span><br><span class="line"><span class="meta">    @auth.response(403, 'Not register')</span></span><br><span class="line"><span class="meta">    @auth.param('password', 'Password')</span></span><br><span class="line"><span class="meta">    @auth.param('username', 'Username')</span></span><br><span class="line"><span class="meta">    @auth.doc(description="Please enter username and password. "</span></span><br><span class="line">                          <span class="string">"If the username and password correct, a token will be returned"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">post</span><span class="params">(self)</span>:</span></span><br><span class="line">        username = get_request_args(<span class="string">"username"</span>, str)</span><br><span class="line">        password = get_request_args(<span class="string">"password"</span>, str)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> make_response(jsonify(username=username,password=password), <span class="number">200</span>)</span><br><span class="line">  </span><br><span class="line">app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ–¹ä¾¿ä½¿ç”¨ï¼Œæˆ‘åˆ›é€ äº†ä¸€ä¸ªå…¬å¼€çš„è½»é‡çº§<a href="https://github.com/ShunyangLi/API-Template" target="_blank" rel="noopener">APIæ¨¡æ¿</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Flask-API&quot;&gt;&lt;a href=&quot;#Flask-API&quot; class=&quot;headerlink&quot; title=&quot;Flask API&quot;&gt;&lt;/a&gt;Flask API&lt;/h1&gt;&lt;p&gt;ç»™å¤§å®¶åˆ†äº«ä¸€ä¸‹&lt;code&gt;flask api&lt;/code&gt; å’Œ &lt;a href=&quot;h
      
    
    </summary>
    
    
      <category term="Backend" scheme="https://shunyangli.github.io/categories/Backend/"/>
    
      <category term="API" scheme="https://shunyangli.github.io/categories/Backend/API/"/>
    
    
      <category term="Flask" scheme="https://shunyangli.github.io/tags/Flask/"/>
    
      <category term="API" scheme="https://shunyangli.github.io/tags/API/"/>
    
  </entry>
  
  <entry>
    <title>Sliding Window</title>
    <link href="https://shunyangli.github.io/post/6284/"/>
    <id>https://shunyangli.github.io/post/6284/</id>
    <published>2022-07-07T10:35:03.000Z</published>
    <updated>2022-07-07T11:03:09.000Z</updated>
    
    <content type="html"><![CDATA[<p>æ»‘åŠ¨çª—å£çš„æ ¸å¿ƒåœ¨äºŽhuaï¼ˆ<del>åˆ’æ°´çš„hua</del>ï¼‰ã€‚æ»‘åŠ¨çª—å£æœ‰ç‚¹ç±»ä¼¼åŠ¨æ€è§„åˆ’ï¼Œåœ¨ä¸€äº›åŒºé—´å†…æ‰¾åˆ°æœ€ä¼˜è§£ï¼Œè€Œä¸”ä¹Ÿæœ‰ä¸€ç‚¹åŒæŒ‡é’ˆçš„æ€æƒ³ã€‚æ»‘åŠ¨çª—å£å¯ä»¥ç”¨ä»¥è§£å†³æ•°ç»„/å­—ç¬¦ä¸²çš„å­å…ƒç´ é—®é¢˜ï¼Œå®ƒå¯ä»¥å°†åµŒå¥—çš„å¾ªçŽ¯é—®é¢˜ï¼Œè½¬æ¢ä¸ºå•å¾ªçŽ¯é—®é¢˜ï¼Œé™ä½Žæ—¶é—´å¤æ‚åº¦ã€‚å¯ä»¥æŠŠæ¯”è¾ƒå¸¸è§çš„æš´åŠ›è§£æ³•$O(n^2)$é™åˆ°$O(n)$ã€‚å…¶å®žå¦‚æžœæå‡ç®—æ³•æ•ˆçŽ‡å°±å¤§æ¦‚çŽ‡ä¼šç‰ºç‰²ç©ºé—´ï¼Œæå‡ç©ºé—´å¤§æ¦‚çŽ‡ç‰ºç‰²æ—¶é—´ã€‚å¤§éƒ¨åˆ†æƒ…å†µä¸¤è€…ä¸èƒ½å…¼å¾—ã€‚leetcodeæœ‰å¾ˆå¤šå…³äºŽæ»‘åŠ¨çª—å£æ¯”è¾ƒæœ‰è¶£çš„é—®é¢˜ã€‚</p><h2 id="76-Minimum-Window-Substring"><a href="#76-Minimum-Window-Substring" class="headerlink" title="76. Minimum Window Substring"></a>76. Minimum Window Substring</h2><p>Given two strings s and t of lengths m and n respectively, return the minimum window substring of s such that every character in t (including duplicates) is included in the window. If there is no such substring, return the empty string â€œâ€.</p><p>The testcases will be generated such that the answer is unique.</p><p>A substring is a contiguous sequence of characters within the string.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: s = &quot;ADOBECODEBANC&quot;, t = &quot;ABC&quot;</span><br><span class="line">Output: &quot;BANC&quot;</span><br><span class="line">Explanation: The minimum window substring &quot;BANC&quot; includes &apos;A&apos;, &apos;B&apos;, and &apos;C&apos; from string t.</span><br></pre></td></tr></table></figure><p>å¤§è‡´æ„æ€å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªåŒ…å«<code>t</code>çš„æœ€å°çš„å­åºåˆ—ã€‚è¿™ä¸ªé—®é¢˜å¯ä»¥ä½¿ç”¨æœ€ç®€å•çš„æš´åŠ›è§£æ³•ï¼ŒåŒé‡å¾ªçŽ¯å°±èƒ½è§£å†³ï¼Œä½†æ˜¯æ—¶é—´å¤æ‚åº¦å¤ªé«˜ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ»‘åŠ¨çª—å£æ¥è§£å†³ã€‚æ»‘åŠ¨çª—å£ä¸€åŠæ˜¯æœ‰å·¦å³ä¸¤ä¸ªæŒ‡é’ˆæ¥è¿›è¡ŒæŽ§åˆ¶çª—å£çš„å¤§å°ã€‚å³ä¾§æŒ‡é’ˆè´Ÿè´£æ‰©å¤§çª—å£ï¼Œå·¦ä¾§æŒ‡é’ˆè´Ÿè´£ç¼©å°çª—å£ã€‚å³ä¾§æŒ‡é’ˆè´Ÿè´£å¯»æ‰¾åˆ°åŒ…å«<code>t</code>çš„å­åºåˆ—ï¼Œå·¦ä¾§æŒ‡é’ˆè´Ÿè´£å¯¹è¯¥å­åºåˆ—ä¸æ–­è¿›è¡Œç¼©å°ç›´åˆ°æ‰¾åˆ°æœ€å°åŒ…å«<code>t</code>çš„å­åºåˆ—ã€‚</p><p><img src="/post/6284/1.png" alt></p><p>æ ¸å¿ƒå¯ä»¥åˆ†æˆä¸‰éƒ¨ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚åœ¨ç¬¬ä¸€æ­¥ç«‹é©¬ï¼Œ<code>R</code>ï¼ˆå³ä¾§æŒ‡é’ˆï¼‰å…ˆæ‰¾åˆ°äº†æ»¡è¶³éœ€æ±‚çš„å­åºåˆ—ï¼Œè¿™æ—¶å€™<code>L</code>ï¼ˆå·¦ä¾§æŒ‡é’ˆï¼‰å¼€å§‹å‡å°çª—å£ä»¥ä¾¿æ‰¾åˆ°æœ€å°çš„å­åºåˆ—ï¼Œå½“<code>L</code>æŒ‡å‘<code>D</code>çš„æ—¶å€™è¯¥å­åºåˆ—ä¸æ»¡è¶³è¦æ±‚ï¼Œç„¶åŽ<code>R</code>å¼€å§‹ç»§ç»­å‘å³è¾¹ç§»åŠ¨æ¥æ‰¾åˆ°æ»¡è¶³æ¡ä»¶çš„å­åºåˆ—ã€‚å½“<code>R</code>æŒ‡å‘<code>A</code>çš„æ—¶å€™ï¼Œè¯¥å­åºåˆ—æ»¡è¶³è¦æ±‚ï¼Œç„¶åŽ<code>L</code>å‘å³ç§»åŠ¨æ¥ç¼©å°çª—å£å¤§å°ã€‚ç„¶åŽé‡å¤è¯¥æ­¥éª¤ï¼Œç›´åˆ°æ‰¾åˆ°æœ€å°çš„å­åºåˆ—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minWindow</span><span class="params">(self, s: str, t: str)</span> -&gt; str:</span></span><br><span class="line">        <span class="keyword">if</span> len(s) &lt; len(t):</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line"></span><br><span class="line">        target = &#123;&#125;</span><br><span class="line">        windows = &#123;&#125;</span><br><span class="line">        end = len(s)</span><br><span class="line">        start = <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">        left = <span class="number">0</span></span><br><span class="line">        right = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        tValid = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> val <span class="keyword">in</span> t:</span><br><span class="line">            target[val] = target.get(val, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> right &lt; len(s):</span><br><span class="line">            c = s[right]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> c <span class="keyword">not</span> <span class="keyword">in</span> target:</span><br><span class="line">                right += <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            windows[c] = windows.get(c, <span class="number">0</span>) + <span class="number">1</span></span><br><span class="line">            <span class="keyword">if</span> windows[c] == target[c]:</span><br><span class="line">                tValid += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            <span class="comment"># then left start to move</span></span><br><span class="line">            <span class="keyword">while</span> tValid == len(target):</span><br><span class="line">                lc = s[left]</span><br><span class="line">                <span class="keyword">if</span> lc <span class="keyword">not</span> <span class="keyword">in</span> target:</span><br><span class="line">                    left += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">                <span class="comment"># remove the element from the window</span></span><br><span class="line">                windows[lc] -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">if</span> windows[lc] &lt; target[lc]:</span><br><span class="line">                    tValid -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> right - left &lt; end:</span><br><span class="line">                        end = right - left + <span class="number">1</span></span><br><span class="line">                        start = left</span><br><span class="line">                left += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">            right += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> start == <span class="number">-1</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">""</span></span><br><span class="line">        <span class="keyword">return</span> s[start:start + end]</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æ»‘åŠ¨çª—å£çš„æ ¸å¿ƒåœ¨äºŽhuaï¼ˆ&lt;del&gt;åˆ’æ°´çš„hua&lt;/del&gt;ï¼‰ã€‚æ»‘åŠ¨çª—å£æœ‰ç‚¹ç±»ä¼¼åŠ¨æ€è§„åˆ’ï¼Œåœ¨ä¸€äº›åŒºé—´å†…æ‰¾åˆ°æœ€ä¼˜è§£ï¼Œè€Œä¸”ä¹Ÿæœ‰ä¸€ç‚¹åŒæŒ‡é’ˆçš„æ€æƒ³ã€‚æ»‘åŠ¨çª—å£å¯ä»¥ç”¨ä»¥è§£å†³æ•°ç»„/å­—ç¬¦ä¸²çš„å­å…ƒç´ é—®é¢˜ï¼Œå®ƒå¯ä»¥å°†åµŒå¥—çš„å¾ªçŽ¯é—®é¢˜ï¼Œè½¬æ¢ä¸ºå•å¾ªçŽ¯é—®é¢˜ï¼Œé™ä½Žæ—¶é—´å¤æ‚åº¦ã€‚å¯ä»¥æŠŠæ¯”è¾ƒå¸¸è§çš„æš´åŠ›è§£æ³•$O(
      
    
    </summary>
    
    
      <category term="leetcode" scheme="https://shunyangli.github.io/categories/leetcode/"/>
    
    
      <category term="leetcode" scheme="https://shunyangli.github.io/tags/leetcode/"/>
    
      <category term="algorithm" scheme="https://shunyangli.github.io/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>COMP9311 Extension</title>
    <link href="https://shunyangli.github.io/post/5fc4/"/>
    <id>https://shunyangli.github.io/post/5fc4/</id>
    <published>2022-06-17T23:52:21.000Z</published>
    <updated>2022-06-19T05:56:24.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="COMP9311-extension"><a href="#COMP9311-extension" class="headerlink" title="COMP9311 extension"></a>COMP9311 extension</h1><p>This is an extension knowledge about COMP9311</p><h2 id="Auto-deploy-PostgreSQL"><a href="#Auto-deploy-PostgreSQL" class="headerlink" title="Auto deploy PostgreSQL"></a>Auto deploy PostgreSQL</h2><p>You can find the shell script <a href="deploy.sh">here</a>. You can execute the following command in <code>grieg</code> server to deploy the SQL server.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod +x deploy.sh</span><br><span class="line"></span><br><span class="line">./deploy.sh</span><br></pre></td></tr></table></figure><p>The code in <code>deploy.sh</code> is:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">user=$(whoami)</span><br><span class="line"></span><br><span class="line">priv srvr</span><br><span class="line"></span><br><span class="line">~cs9311/bin/pginit</span><br><span class="line"></span><br><span class="line">echo "if [ \`hostname\` = \"grieg\" ]</span><br><span class="line">then</span><br><span class="line">    source /srvr/$user/env</span><br><span class="line">fi</span><br><span class="line">" &gt;&gt; ~/.bash_profile</span><br></pre></td></tr></table></figure><h2 id="Backgroud-information"><a href="#Backgroud-information" class="headerlink" title="Backgroud information"></a>Backgroud information</h2><ul><li><code>grieg</code> means a server named grieg</li></ul><h2 id="Login-CSE-GRIEG"><a href="#Login-CSE-GRIEG" class="headerlink" title="Login CSE/GRIEG"></a>Login CSE/GRIEG</h2><p>You can log in to <code>cse</code> server by using the following command:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh ZID@cse.unsw.edu.au</span><br></pre></td></tr></table></figure><p>PS: Please replace <code>ZID</code> with your zid, and the password is same as your zid passowrd (typing the password in terminal is <strong>unvisitable</strong>).</p><p>After log in to the <code>cse</code> server, then you can log in to <code>grieg</code> server by using the following command:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh grieg</span><br></pre></td></tr></table></figure><p>Also, you can log in to <code>grieg</code> directly by using the following command:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh ZID@grieg.cse.unsw.edu.au</span><br></pre></td></tr></table></figure><p>PS: Please replace <code>ZID</code> with your zid, and the password is same as your zid passowrd (typing the password in terminal is <strong>unvisitable</strong>).</p><h2 id="Log-in-to-cse-server-without-password"><a href="#Log-in-to-cse-server-without-password" class="headerlink" title="Log in to cse server without password"></a>Log in to <code>cse</code> server without password</h2><p>You can log in to <code>cse</code> server without password by uploading <code>ssh-key</code> into the server. If you did not have a <code>ssh-key</code>, you can generate a <code>ssh-key</code> by using the following command (please execute these commands in personal computer) :</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen</span><br></pre></td></tr></table></figure><p>Then you can use <code>ssh-copy-id</code> to copy your key to server:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-copy-id ZID@cse.unsw.edu.au</span><br></pre></td></tr></table></figure><p>PS: Please replace <code>ZID</code> with your zid.</p><p>You can find more details <a href="https://www.ssh.com/ssh/copy-id" target="_blank" rel="noopener">here</a></p><h2 id="bash-profile-settings"><a href="#bash-profile-settings" class="headerlink" title=".bash_profile settings"></a>.bash_profile settings</h2><p>When you logging in to <code>cse</code> server, you may can not find these files (.bash_profile, .bashrc or .profile). You can use <code>touch</code> command to create a empty file in home directory.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ~  // switch the directory into home directory</span><br><span class="line">touch .bash_profile</span><br></pre></td></tr></table></figure><p>Then you can find the <code>.bash_profile</code> file by using:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -al</span><br></pre></td></tr></table></figure><p>Then you can add the following config code into <code>.bash_profile</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if [ `hostname` = "grieg" ]</span><br><span class="line">then</span><br><span class="line">    source /srvr/ZID/env</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><p>PS: Please replace <code>ZID</code> with your zid.</p><h2 id="Terminal-display"><a href="#Terminal-display" class="headerlink" title="Terminal display"></a>Terminal display</h2><p>Several students asked how to modify the Linux terminal display. After logging in to <code>grieg</code> server, on the left hand side it looks like:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grieg %</span><br></pre></td></tr></table></figure><p>It only shows the hostname which is very inconvenient when we want to know which folder we are in. The following commands can help you to solve the issue:</p><ol><li>Log in to <code>grieg</code> server</li><li>Add this line <code>export PS1=&quot;\u@\h \w $ &quot;</code> into the <code>.bash_profile</code> file</li><li>Execute <code>source ~/.bash_profile</code></li></ol><p>Then the terminal display should like:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ZID@grieg ~ $</span><br></pre></td></tr></table></figure><p>Where <code>~</code> means home directory.</p><p>You can find more details <a href="https://www.thegeekstuff.com/2008/09/bash-shell-ps1-10-examples-to-make-your-linux-prompt-like-angelina-jolie/" target="_blank" rel="noopener">here</a></p><h2 id="Upload-files-to-cse-server"><a href="#Upload-files-to-cse-server" class="headerlink" title="Upload files to cse server"></a>Upload files to <code>cse</code> server</h2><p>Use <code>scp</code> (srcure copy) command can upload files/directory from local (Linux or Mac system) to remote <code>cse</code> server:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp [source file] [username]@[destination server]:/path/</span><br></pre></td></tr></table></figure><p>For example:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp schema.sql ZID@cse.unsw.edu.au:~</span><br></pre></td></tr></table></figure><p>Which means upload the <code>schema.sql</code> file into your <code>cse</code> server home directory.</p><p>If you want to upload a directory you can use:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp -r [source directory] [username]@[destination server]:/path/</span><br></pre></td></tr></table></figure><p>If you are using windows system, you can have a look <code>winscp</code>. And UNSW gives a <a href="https://taggi.cse.unsw.edu.au/FAQ/Accessing_Your_Files/" target="_blank" rel="noopener">guideline</a> about that</p><h2 id="SSH-config"><a href="#SSH-config" class="headerlink" title="SSH config"></a>SSH config</h2><p>After finished configuration of <em>log in without password. (section 1.3)</em>. You can config the ssh config file like:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host cse</span><br><span class="line">    HostName cse.unsw.edu.au</span><br><span class="line">    Port 22</span><br><span class="line">    User ZID</span><br></pre></td></tr></table></figure><p>Where <code>ZID</code> is your zid. Now, you can use <code>ssh cse</code> instead of <code>ssh zid@cse.unsw.edu.au</code>.</p><h1 id="Lab-02"><a href="#Lab-02" class="headerlink" title="Lab 02"></a>Lab 02</h1><p>The lab 02 slides is available <a href="https://docs.google.com/presentation/d/1nRCQGahTeVD0qvVuNeTMYEBgLvrqs-rvqKCjTJjMUOc/edit?usp=sharing" target="_blank" rel="noopener">here</a>, if you have any issues, please email me.</p><iframe src="lab02.pdf" style="width: 100%;height: 500px" title="COMP9311 Lab02"></iframe><h1 id="Lab03"><a href="#Lab03" class="headerlink" title="Lab03"></a>Lab03</h1><h2 id="Step-up"><a href="#Step-up" class="headerlink" title="Step up"></a>Step up</h2><ol><li><p>Download the <a href="https://www.cse.unsw.edu.au/~cs9311/21T1/lab/04/weblog.zip" target="_blank" rel="noopener">weblog.zip</a> by using <code>wget</code> command in the terminal: <code>wget https://www.cse.unsw.edu.au/~cs9311/21T1/lab/04/weblog.zip</code></p></li><li><p>Unzip the weblog.zip files: <code>unzip weblog.zip</code></p></li><li><p>Create a database for this lab: <code>createdb weblog</code></p></li><li><p>Load SQL file</p><ol><li><p>switch to the weblog directory: <code>cd weblog</code></p></li><li><p>load schema: <code>psql weblog -f schema.sql</code></p></li><li><p>load data sql file:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">psql weblog -f Hosts.sql</span><br><span class="line">psql weblog -f Sessions.sql</span><br><span class="line">psql weblog -f Accesses.sql</span><br></pre></td></tr></table></figure></li></ol></li></ol><p>Regex online test <a href="https://regexr.com" target="_blank" rel="noopener">regex</a></p><h1 id="K-Core-decomposition"><a href="#K-Core-decomposition" class="headerlink" title="K-Core decomposition"></a>K-Core decomposition</h1><p>Given a graph G, the k-core of G can be computed by recursively deleting every node and its adjacent edges if its degree is less than <code>k</code>.<br>The python code of k-core as shown in the following part.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">edges = &#123;</span><br><span class="line">    <span class="string">'a'</span>: [<span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>],</span><br><span class="line">    <span class="string">'b'</span>: [<span class="string">'a'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>],</span><br><span class="line">    <span class="string">'c'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'d'</span>],</span><br><span class="line">    <span class="string">'d'</span>: [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">compute_k_core</span><span class="params">(k, edges)</span>:</span></span><br><span class="line">    deleted_nodes = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">for</span> node <span class="keyword">in</span> edges:</span><br><span class="line">            <span class="keyword">if</span> len(edges[node]) &lt; k:</span><br><span class="line">                deleted_nodes.append(node)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> len(deleted_nodes) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> u <span class="keyword">in</span> deleted_nodes:</span><br><span class="line">            <span class="keyword">if</span> u <span class="keyword">not</span> <span class="keyword">in</span> edges:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> v <span class="keyword">in</span> edges[u]:</span><br><span class="line">                edges[v].remove(u)</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">del</span> edges[u]</span><br><span class="line">        deleted_nodes.clear()</span><br><span class="line">    </span><br><span class="line">    print(<span class="string">", "</span>.join(edges.keys()))</span><br><span class="line">    <span class="keyword">for</span> u <span class="keyword">in</span> edges:</span><br><span class="line">        <span class="keyword">for</span> v <span class="keyword">in</span> edges[u]:</span><br><span class="line">            print(<span class="string">"&#123;&#125;, &#123;&#125;"</span>.format(u,v))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    compute_k_core(<span class="number">2</span>, edges=copy.deepcopy(edges))</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;COMP9311-extension&quot;&gt;&lt;a href=&quot;#COMP9311-extension&quot; class=&quot;headerlink&quot; title=&quot;COMP9311 extension&quot;&gt;&lt;/a&gt;COMP9311 extension&lt;/h1&gt;&lt;p&gt;This i
      
    
    </summary>
    
    
      <category term="COMP" scheme="https://shunyangli.github.io/categories/COMP/"/>
    
    
      <category term="COMP" scheme="https://shunyangli.github.io/tags/COMP/"/>
    
  </entry>
  
  <entry>
    <title>Entropy</title>
    <link href="https://shunyangli.github.io/post/663/"/>
    <id>https://shunyangli.github.io/post/663/</id>
    <published>2022-06-14T06:15:20.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Entropy"><a href="#Entropy" class="headerlink" title="Entropy"></a>Entropy</h1><p>Entropy can be used as a measure of uncertainty in information theory.</p><p>Entropy <code>H(Y)</code> of a random <code>Y</code> with <code>n</code> different possible values:<br>$$<br>H(Y) =-\sum^{n}_{i=1}P(y_i)log_2P(y_i)<br>$$</p><p>Where $P(y_i)$ is the probaility that random variable <code>Y</code> equals $y_i$ (One of <code>n</code> different possible values of <code>Y</code>).</p><p><code>n</code> represents the number of types of outcomes, for example, if the outcome is 1, 2, 3 then n is 3. $P(y_i)$represents the probability of different outcomes, for example, if 1, 2, 3 then the probability of 1 is $1/3$.</p><h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><table><thead><tr><th align="center">$X_1$</th><th align="center">$X_2$</th><th align="center">Y</th></tr></thead><tbody><tr><td align="center">T</td><td align="center">F</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">F</td><td align="center">F</td><td align="center">F</td></tr><tr><td align="center">F</td><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">F</td><td align="center">F</td></tr></tbody></table><p>Y has two values: T and F. In the equation <code>n</code> = 2. Therefore, we can get:</p><p>$$<br>H(Y) =-\sum^{n}_{i=1}P(y_i)log_2P(y_i)<br>$$</p><p>$$<br>H(Y) =-\frac{3}{5}log_2\frac{3}{5}-\frac{2}{5}log_2\frac{2}{5} \approx0.292<br>$$</p><h2 id="Conditional-entropy"><a href="#Conditional-entropy" class="headerlink" title="Conditional entropy"></a>Conditional entropy</h2><p>Conditional entropy $H(Y|X=x_j)$ of <code>Y</code> given $X=x_i$.</p><p>$$<br>H(Y|X=x_j)=-\sum^{n}_{i=1}P(y_i|X=x_j)log_2P(y_i|X=x_j)<br>$$</p><p>After split we can get:</p><p>$$<br>H(Y|X)=\sum^{k}_{j=1}P(x_j)H(Y|X=x_j)<br>$$</p><h3 id="Example-1"><a href="#Example-1" class="headerlink" title="Example"></a>Example</h3><table><thead><tr><th align="center">$X_1$</th><th align="center">$X_2$</th><th align="center">Y</th></tr></thead><tbody><tr><td align="center">T</td><td align="center">F</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">F</td><td align="center">F</td><td align="center">F</td></tr><tr><td align="center">F</td><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">F</td><td align="center">F</td></tr></tbody></table><p>Suppose we split the data based on the value of $X_1$. $X_1$ has two possible values: T and F. We can compute the conditional entropy for $X_1=T$ and $X_1=F$.</p><blockquote><p>Compute $X_1=T$</p></blockquote><table><thead><tr><th align="center">$X_1$</th><th align="center">Y</th></tr></thead><tbody><tr><td align="center"><em>T</em></td><td align="center"><em>T</em></td></tr><tr><td align="center"><em>T</em></td><td align="center"><em>T</em></td></tr><tr><td align="center"><em>T</em></td><td align="center"><em>F</em></td></tr><tr><td align="center">F</td><td align="center">T</td></tr><tr><td align="center">F</td><td align="center">F</td></tr></tbody></table><p>After splitting, when $X_1=T$, Y has two values. Therefore, $P(Y=T|X_1=T) = 2/3$ and $P(Y=F|X_1=T) = 2/3$.</p><p>We can jave the following entropy when $X_1=T$:</p><p>$$<br>H(Y|X_1=T)=-\sum^{n}_{i=1}P(y_i|X_1=T)log_2P(y_i|X_1=T)<br>$$</p><p>$$<br>H(Y|X_1=T)= -\frac{2}{3}log_2(\frac{2}{3})-\frac{1}{3}log_2(\frac{1}{3}) \approx 0.28<br>$$</p><blockquote><p>Compute $X_1=F$</p></blockquote><table><thead><tr><th align="center">$X_1$</th><th align="center">Y</th></tr></thead><tbody><tr><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">F</td></tr><tr><td align="center"><em>F</em></td><td align="center"><em>T</em></td></tr><tr><td align="center"><em>F</em></td><td align="center"><em>F</em></td></tr></tbody></table><p>After splitting, when $X_1=F$, Y has two values. Therefore, $P(Y=T|X_1=F) = 1/2$ and $P(Y=F|X_1=T) = 1/2$.</p><p>We can jave the following entropy when $X_1=F$:</p><p>$$<br>H(Y|X_1=T)=-\sum^{n}_{i=1}P(y_i|X_1=F)log_2P(y_i|X_1=F)<br>$$</p><p>$$<br>H(Y|X_1=T)=-\frac{1}{2}log_2(\frac{1}{2})-\frac{1}{2}log_2(\frac{1}{2}) \approx 0.3<br>$$</p><h3 id="Entropy-after-split"><a href="#Entropy-after-split" class="headerlink" title="Entropy after split"></a>Entropy after split</h3><table><thead><tr><th align="center">$X_1$</th><th align="center">Y</th></tr></thead><tbody><tr><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">T</td></tr><tr><td align="center">T</td><td align="center">F</td></tr><tr><td align="center">F</td><td align="center">T</td></tr><tr><td align="center">F</td><td align="center">F</td></tr></tbody></table><p>We get $P(X_1=T)=3/5$ and $P(X_1=F)=2/5$. We have the following overall conditional entropy:</p><p>$$<br>H(Y|X_1)=\frac{3}{5}<em>0.28+\frac{2}{5}</em>0.3=0.288<br>$$</p><h2 id="Information-Gain"><a href="#Information-Gain" class="headerlink" title="Information Gain"></a>Information Gain</h2><p>Information Gain $I(X,Y)$ is defined as the expected reduction in entropy of target varible Y after split over variable X.</p><p>$$<br>I(X,Y)=H(Y)-H(Y|X)<br>$$</p><p>In the previous example, we can get the infromation gain is:</p><p>$$<br>I(X_1,Y)=H(Y)-H(Y|X_1)=0.292-0.288\approx0.004<br>$$</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Entropy&quot;&gt;&lt;a href=&quot;#Entropy&quot; class=&quot;headerlink&quot; title=&quot;Entropy&quot;&gt;&lt;/a&gt;Entropy&lt;/h1&gt;&lt;p&gt;Entropy can be used as a measure of uncertainty in
      
    
    </summary>
    
    
      <category term="COMP" scheme="https://shunyangli.github.io/categories/COMP/"/>
    
    
      <category term="COMP" scheme="https://shunyangli.github.io/tags/COMP/"/>
    
  </entry>
  
  <entry>
    <title>Upload Large File</title>
    <link href="https://shunyangli.github.io/post/4707/"/>
    <id>https://shunyangli.github.io/post/4707/</id>
    <published>2022-04-30T14:30:48.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>pythonå®žçŽ°å¤§æ–‡ä»¶åˆ‡ç‰‡ä¸Šä¼ ã€‚æœ‰æ®µæ—¶é—´æ²¡å­¦ä¹ ä¸€ä¸‹æ–°ä¸œè¥¿äº†ï¼Œæœ€è¿‘å¶å°”åœ¨å­¦ä¹ ä¸€ä¸‹å¹¶è¡Œå’Œåˆ†å¸ƒå¼çš„ä¸œè¥¿ã€‚å¤§æ–‡ä»¶ä¸Šä¼ çš„æ–¹å¼æœ‰ç‚¹å¹¶è¡Œå¤„ç†çš„é‚£å‘³é“ã€‚æ‰€ä»¥å°±æŠ½æ—¶é—´å†™äº†ä¸€ç‚¹pythonå®žçŽ°å¤§æ–‡ä»¶ä¸Šä¼ ï¼Œä»£ç å†™çš„æ¯”è¾ƒç®€é™‹ï¼Œå¤§å®¶æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±å®žçŽ°ä¸€ä¸ªã€‚å¤§éƒ¨åˆ†ä¸Šä¼ æ–‡ä»¶å…¶å®žæ˜¯åœ¨å‰ç«¯å®žçŽ°çš„ï¼Œä½†æ˜¯åŽŸç†éƒ½å·®ä¸å¤šï¼ŒçŸ¥é“æ‡‚åŽŸç†å®žçŽ°å°±å¾ˆç®€å•ã€‚</p><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>æ–‡ä»¶ä¸Šä¼ è¿™ä¸ªéœ€æ±‚åœ¨å“ªéƒ½æœ‰ï¼Œç½‘ç›˜ï¼Œä¸Šä¼ å„ç§æ–‡ä»¶ç­‰ç­‰ã€‚åœ¨æ–‡ä»¶æ¯”è¾ƒå¤§çš„æ—¶å€™æœ‰ä¸€äº›æ¯”è¾ƒå®¹æ˜“é‡åˆ°çš„é—®é¢˜ï¼š</p><ol><li>è¶…æ—¶ã€‚å› ä¸ºå‰ç«¯æˆ–è€…åŽç«¯ä»£ç†éƒ½æœ‰é™åˆ¶æœ€é•¿è¯·æ±‚æ—¶é—´ï¼Œä¸€æ—¦è¶…æ—¶æ–‡ä»¶å°±æ²¡åŠžæ³•é•¿ä¸Šä¼ æˆåŠŸã€‚</li><li>å¤§å°é™åˆ¶ã€‚ä¸€èˆ¬åŽç«¯å¯¹ä¸Šä¼ æ–‡ä»¶å¤§å°ä¼šæœ‰ä¸€å®šé™åˆ¶ã€‚</li></ol><p>å½“ç„¶æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒæ•´æœ€å¤§è¯·æ±‚æ—¶é—´å’Œå¤§å°é™åˆ¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯ä¼šå¯¹æœåŠ¡å™¨é€ æˆè´Ÿè½½ã€‚ä¸Šä¼ å¤±è´¥é‡æ¥è¿™çŽ©æ„æœ‰ç‚¹å¤´å¤§ã€‚</p><h2 id="æ–‡ä»¶åˆ‡ç‰‡"><a href="#æ–‡ä»¶åˆ‡ç‰‡" class="headerlink" title="æ–‡ä»¶åˆ‡ç‰‡"></a>æ–‡ä»¶åˆ‡ç‰‡</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æŠŠæ–‡ä»¶åˆ‡åˆ†æˆè‹¥å¹²ä¸ªå°æ–‡ä»¶ï¼Œå¹¶ä¸”æŠŠè¿™äº›å°æ–‡ä»¶å¹¶è¡Œçš„ä¸Šä¼ åˆ°åŽå°ï¼Œè¿™æ ·çš„è¯ä¼šèŠ‚çœå¤§é‡çš„æ—¶é—´ã€‚å½“ä¸Šä¼ å®Œæˆä¹‹åŽï¼ŒåŽå°ä¼šå¯¹è¿™äº›è‹¥å¹²ä¸ªå°æ–‡ä»¶è¿›è¡Œåˆå¹¶ã€‚è¿™ä¸ªæœ‰ç‚¹ç±»ä¼¼åˆ†å¸ƒå¼ï¼ˆHDFSï¼‰çš„å‚¨å­˜æ–¹æ³•ã€‚</p><p>æˆ‘ä»¬å¯ä»¥æŠŠæ–‡ä»¶è¯»å–æˆbytesæ ¼å¼ï¼Œç„¶åŽå¯¹è¿™äº›bytesè¿›è¡Œåˆ‡ç‰‡ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">split</span><span class="params">(filename)</span>:</span></span><br><span class="line">    CHUNSIZE = <span class="number">1024</span> * <span class="number">1024</span></span><br><span class="line">    file_size = os.stat(filename).st_size</span><br><span class="line">    f = open(filename, <span class="string">'rb'</span>)</span><br><span class="line">    data = f.read()</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"file size: "</span>, file_size)</span><br><span class="line"></span><br><span class="line">    cursor = <span class="number">0</span></span><br><span class="line">    chunk_list = []</span><br><span class="line">    <span class="keyword">while</span> cursor &lt;= file_size:</span><br><span class="line">        chunk_list.append(data[cursor:cursor + CHUNSIZE]) </span><br><span class="line">        cursor = cursor + CHUNSIZE</span><br><span class="line"></span><br><span class="line">    print(<span class="string">"chunk number: "</span>, len(chunk_list))</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥æ ¹æ®ç½‘ç»œçŠ¶æ€ï¼Œæ–‡ä»¶å¤§å°ç­‰å› ç´ æ¥å†³å®š<code>CHUNSIZE</code>çš„å¤§å°ã€‚ä¸ºäº†æ–¹ä¾¿å®žçŽ°ï¼Œæˆ‘è¿™é‡Œç›´æŽ¥å›ºå®šäº†åˆ‡ç‰‡çš„å¤§å°ã€‚åœ¨ä¸Šä¼ åˆ°åŽå°çš„æ—¶å€™æˆ‘ä»¬éœ€è¦è€ƒè™‘åˆ‡ç‰‡æ–‡ä»¶çš„é¡ºåºï¼Œä¸ç„¶å¯èƒ½ä¼šå¯¼è‡´æ–‡ä»¶å‘ç”Ÿé”™è¯¯ï¼Œå½“ç„¶è¿™ä¸ªæ˜¯åŽå°éœ€è¦å®žçŽ°çš„åŠŸèƒ½ï¼Œå¯ä»¥ç¨åŽè®¨è®ºã€‚ä¸ºäº†è®©èµ„æºå¾—åˆ°å……åˆ†åˆ©ç”¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œä¸Šä¼ ï¼Œå¦‚æžœæ˜¯å‰ç«¯å¯ä»¥é‡‡ç”¨å¼‚æ­¥çš„æ–¹å¼ã€‚åœ¨è¿™é‡Œæˆ‘ç”¨çš„æ˜¯<code>Thread</code>çš„æ–¹å¼å®žçŽ°å¤šçº¿ç¨‹ä¸Šä¼ ã€‚</p><h2 id="æ–‡ä»¶åˆå¹¶"><a href="#æ–‡ä»¶åˆå¹¶" class="headerlink" title="æ–‡ä»¶åˆå¹¶"></a>æ–‡ä»¶åˆå¹¶</h2><p>æ–‡ä»¶åˆå¹¶å¸¸è§çš„æ–¹å¼æœ‰ï¼š</p><ol><li>ä¸Šä¼ å®Œæ‰€æœ‰çš„å°æ–‡ä»¶ä¹‹åŽå‘é€ä¸€ä¸ªè¯·æ±‚æ¥åˆå¹¶æ–‡ä»¶ï¼Œè¯·æ±‚çš„æ—¶å€™å¯ä»¥ä¼ é€’åˆå¹¶ä¹‹åŽæ–‡ä»¶çš„åå­—ã€‚</li><li>åŽå°è®°å½•åˆ‡ç‰‡çš„<code>index</code>ï¼Œå½“è¾¾åˆ°æœ«å°¾çš„æ—¶å€™è‡ªåŠ¨åˆå¹¶ã€‚</li></ol><p>åœ¨è¿™é‡Œæˆ‘å®žçŽ°çš„æ˜¯ç¬¬ä¸€ç§æ–¹æ³•ï¼ˆå› ä¸ºæ‡’/(ã„’oã„’)/~~ï¼‰ã€‚</p><p>å…ˆç®€å•ä»‹ç»ä¸€ä¸ªæ–‡ä»¶åˆå¹¶çš„åŽŸç†ï¼Œå…ˆæŠŠæ‰€æœ‰åˆ‡åˆ†çš„æ–‡ä»¶æ ¹æ®bytesçš„æ ¼å¼è¯»å–ï¼Œç„¶åŽæŠŠè¿™äº›è¯»å–çš„bytesæŒ‰ç…§é¡ºåºå†™å…¥åˆ°æ–°çš„æ–‡ä»¶ä¸­ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f = open(<span class="string">'./xx.tar.bz2'</span>, <span class="string">'ab'</span>)</span><br><span class="line"><span class="keyword">for</span> chunk <span class="keyword">in</span> chunk_list:</span><br><span class="line">    f.write(chunk)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure><p>å½“æŠŠæ‰€æœ‰çš„æ–‡ä»¶éƒ½å†™å…¥åˆ°æ–‡ä»¶ä¹‹åŽå°±æˆåŠŸæŠŠè¿™ä¸ªæ–‡ä»¶åˆå¹¶äº†ã€‚æ³¨æ„ï¼š<code>ab</code>è¡¨ç¤ºappending bytesã€‚</p><h2 id="æ–‡ä»¶ç§’ä¼ "><a href="#æ–‡ä»¶ç§’ä¼ " class="headerlink" title="æ–‡ä»¶ç§’ä¼ "></a>æ–‡ä»¶ç§’ä¼ </h2><p>æ–‡ä»¶ç§’ä¼ æ˜¯æŒ‡å¦‚æžœåŽå°å·²ç»æœ‰ä¸€ä¸ªä¸€æ ·çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå°±æ²¡å¿…è¦å†æ¬¡ä¸Šä¼ ï¼Œç›´æŽ¥è¿”å›žä¸Šä¼ æˆåŠŸå³å¯ã€‚è¿™ä¸ªåŠŸèƒ½è¿˜æ˜¯æ¯”è¾ƒä½¿ç”¨çš„ï¼Œæ¯”å¦‚æŸç›˜çš„èµ„æºå…±äº«ç­‰ç­‰ã€‚</p><p>å¦™ä¼ çš„å…³é”®åœ¨äºŽæ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®æ–‡ä»¶çš„äºŒè¿›åˆ¶ç¼–ç è¿›è¡Œè®¡ç®—hashå€¼ï¼Œç”¨æ¥å½“ä½œæ–‡ä»¶çš„å”¯ä¸€æ ‡è¯†ã€‚é€šå¸¸ä½¿ç”¨çš„ç®—æ³•æ˜¯<code>md5</code>ã€‚å¯¹äºŽ<code>md5</code>ç®—æ³•ï¼Œæˆ‘ä»¬ä¹Ÿæœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼åŽ»è®¡ç®—æ–‡ä»¶çš„hahså€¼ã€‚ç¬¬ä¸€ç§æ˜¯ç›´æŽ¥è®¡ç®—ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">f = open(filename, <span class="string">'rb'</span>).read()</span><br><span class="line">md5 = hashlib.md5(f)</span><br><span class="line">hash = md5.hexdigest()</span><br><span class="line">print(hash)</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ ¹æ®æ¯è¡Œæ•°æ®è¿›è¡Œupdate hashå€¼ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">md5 = hashlib.md5()</span><br><span class="line"><span class="keyword">with</span> open(filename, <span class="string">'rb'</span>) <span class="keyword">as</span> lines:</span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">        md5.update(line)</span><br><span class="line">hash = md5.hexdigest()</span><br><span class="line">print(hash)</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ€»ä½“ä»£ç å®žçŽ°å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Upload</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, filename, url, CHUNSIZE=<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">30</span>)</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">        self.filename = filename</span><br><span class="line">        self.url = url</span><br><span class="line">        self.md5 = <span class="string">""</span></span><br><span class="line">        self.chunk_list = []</span><br><span class="line">        self.CHUNSIZE = CHUNSIZE</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">md5_small</span><span class="params">(self)</span>:</span></span><br><span class="line">        f = open(self.filename, <span class="string">'rb'</span>).read()</span><br><span class="line">        md5 = hashlib.md5(f)</span><br><span class="line">        self.md5 = md5.hexdigest()</span><br><span class="line">        print(md5.hexdigest())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">md5_large</span><span class="params">(self)</span>:</span></span><br><span class="line">        md5 = hashlib.md5()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">with</span> open(self.filename, <span class="string">'rb'</span>) <span class="keyword">as</span> lines:</span><br><span class="line">            <span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">                md5.update(line)</span><br><span class="line">        </span><br><span class="line">        self.md5 = md5.hexdigest()</span><br><span class="line">        print(md5.hexdigest())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">split</span><span class="params">(self)</span>:</span></span><br><span class="line">        file_size = os.stat(self.filename).st_size</span><br><span class="line">        f = open(self.filename, <span class="string">'rb'</span>)</span><br><span class="line">        data = f.read()</span><br><span class="line">        f.close()</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"file size: "</span>, file_size)</span><br><span class="line"></span><br><span class="line">        cursor = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> cursor &lt;= file_size:</span><br><span class="line">            self.chunk_list.append(data[cursor:cursor + self.CHUNSIZE]) </span><br><span class="line">            cursor = cursor + self.CHUNSIZE</span><br><span class="line"></span><br><span class="line">        print(<span class="string">"chunk number: "</span>, len(self.chunk_list))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">async_upload</span><span class="params">(self, chunks, offset, filename=<span class="string">"upt"</span>)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> index, chunk <span class="keyword">in</span> enumerate(chunks):</span><br><span class="line">            data = &#123;</span><br><span class="line">                <span class="string">'index'</span>: index + offset,</span><br><span class="line">                <span class="string">'chunk'</span>: chunk.decode(<span class="string">'latin-1'</span>),</span><br><span class="line">                <span class="string">'filename'</span>: filename</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            response = requests.get(</span><br><span class="line">                url=<span class="string">'&#123;&#125;/upload'</span>.format(self.url),</span><br><span class="line">                data=json.dumps(data),</span><br><span class="line">                headers = &#123;</span><br><span class="line">                    <span class="string">'Accept'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">                    <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></span><br><span class="line">                &#125;</span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            print(response)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">merge</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        merge is not belong to this part</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"path"</span>: <span class="string">"upt"</span>,</span><br><span class="line">            <span class="string">"filename"</span>: <span class="string">"xx.tar.bz2"</span></span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.get(</span><br><span class="line">            url=<span class="string">'&#123;&#125;/merge'</span>.format(self.url),</span><br><span class="line">            data=json.dumps(data),</span><br><span class="line">            headers = &#123;</span><br><span class="line">                <span class="string">'Accept'</span>: <span class="string">'application/json'</span>,</span><br><span class="line">                <span class="string">'Content-Type'</span>: <span class="string">'application/json'</span></span><br><span class="line">            &#125;</span><br><span class="line">        )</span><br><span class="line"></span><br><span class="line">        print(response)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">(self)</span>:</span></span><br><span class="line">        TREADNUM = <span class="number">3</span></span><br><span class="line">        CHUNKSIZE = len(self.chunk_list)</span><br><span class="line">        PERSIZE = int(CHUNKSIZE / TREADNUM)</span><br><span class="line">        threads = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, CHUNKSIZE, PERSIZE):</span><br><span class="line">            t = Thread(target=self.async_upload, args=[self.chunk_list[i : i + PERSIZE], i])</span><br><span class="line">            t.start()</span><br><span class="line">            threads.append(t)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">for</span> t <span class="keyword">in</span> threads:</span><br><span class="line">                <span class="keyword">if</span> t.is_alive():</span><br><span class="line">                    <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        print(<span class="string">"Finish"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    upload = Upload(<span class="string">'comp-books-master.zip'</span>, <span class="string">'http://127.0.0.1:5000'</span>)</span><br><span class="line">    upload.split()</span><br><span class="line">    upload.upload()</span><br><span class="line">    <span class="comment"># upload.merge()</span></span><br></pre></td></tr></table></figure><p>åŽå°æ¨¡æ‹Ÿä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> glob</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">CURR = os.getcwd()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/upload', methods=["POST","GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">upload</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    data = request.get_json()</span><br><span class="line">    index = data[<span class="string">'index'</span>]</span><br><span class="line">    chunk = data[<span class="string">'chunk'</span>]</span><br><span class="line">    filename = data[<span class="string">'filename'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(os.path.join(CURR, filename)):</span><br><span class="line">        os.mkdir(os.path.join(CURR, filename))</span><br><span class="line">    </span><br><span class="line">    f = open(os.path.join(CURR, filename, str(index)), <span class="string">'ab'</span>)</span><br><span class="line">    f.write(chunk.encode(<span class="string">'latin-1'</span>))</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"SUCCESS"</span>, <span class="number">200</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/merge', methods=["POST","GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">meger</span><span class="params">()</span>:</span></span><br><span class="line">    data = request.get_json()</span><br><span class="line">    mp = data[<span class="string">'path'</span>]</span><br><span class="line">    filename = data[<span class="string">'filename'</span>]</span><br><span class="line"></span><br><span class="line">    f = open(filename, <span class="string">'ab'</span>)</span><br><span class="line">    <span class="keyword">for</span> file <span class="keyword">in</span> os.listdir(os.path.join(CURR, mp)):</span><br><span class="line">        tf = open(os.path.join(CURR, mp, file), <span class="string">'rb'</span>)</span><br><span class="line">        f.write(tf.read())</span><br><span class="line">        tf.close()</span><br><span class="line">    </span><br><span class="line">    f.close()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">"SUCCESS"</span>, <span class="number">200</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;pythonå®žçŽ°å¤§æ–‡ä»¶åˆ‡ç‰‡ä¸Šä¼ ã€‚æœ‰æ®µæ—¶é—´æ²¡å­¦ä¹ ä¸€ä¸‹æ–°ä¸œè¥¿äº†ï¼Œæœ€è¿‘å¶å°”åœ¨å­¦ä¹ ä¸€ä¸‹å¹¶è¡Œå’Œåˆ†å¸ƒå¼çš„ä¸œè¥¿ã€‚å¤§æ–‡ä»¶ä¸Šä¼ çš„æ–¹å¼æœ‰ç‚¹å¹¶è¡Œå¤„ç†çš„é‚£å‘³é“ã€‚æ‰€ä»¥å°±æŠ½æ—¶é—´å†™äº†ä¸€ç‚¹pythonå®žçŽ°å¤§æ–‡ä»¶ä¸Šä¼ ï¼Œä»£ç å†™çš„æ¯”è¾ƒç®€é™‹ï¼Œå¤§å®¶æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªå·±å®žçŽ°ä¸€ä¸ªã€‚å¤§éƒ¨åˆ†ä¸Šä¼ æ–‡ä»¶å…¶å®žæ˜¯åœ¨å‰ç«¯å®žçŽ°çš„ï¼Œä½†æ˜¯åŽŸç†
      
    
    </summary>
    
    
    
      <category term="backend" scheme="https://shunyangli.github.io/tags/backend/"/>
    
  </entry>
  
  <entry>
    <title>LeetCode Part 2</title>
    <link href="https://shunyangli.github.io/post/b672/"/>
    <id>https://shunyangli.github.io/post/b672/</id>
    <published>2022-02-26T03:30:31.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>An extension of <a href="https://shunyangli.github.io/2020/05/26/leetcode/#more">leetcode</a>. Keep working on leetcode.</p><h1 id="Daily-Temperatures"><a href="#Daily-Temperatures" class="headerlink" title="Daily Temperatures"></a>Daily Temperatures</h1><p><a href="https://leetcode.com/problems/daily-temperatures/" target="_blank" rel="noopener">Daily Temperatures</a>: Given a list of daily temperatures T, return a list such that, for each day in the input, tells you how many days you would have to wait until a warmer temperature. If there is no future day for which this is possible, put 0 instead.</p><p>For example, given the list of temperatures T = [73, 74, 75, 71, 69, 72, 76, 73], your output should be [1, 1, 4, 2, 1, 1, 0, 0].</p><h2 id="Brute-Force"><a href="#Brute-Force" class="headerlink" title="Brute Force"></a>Brute Force</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dailyTemperatures</span><span class="params">(self, T: List[int])</span> -&gt; List[int]:</span></span><br><span class="line">        num = len(T) - <span class="number">1</span></span><br><span class="line">        data = [<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(len(T) - <span class="number">2</span>, <span class="number">-1</span>, <span class="number">-1</span>):</span><br><span class="line">            <span class="keyword">if</span> T[i] &gt;= T[num]:</span><br><span class="line">                data.insert(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">                num = i</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                count = <span class="number">1</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> range(i + <span class="number">1</span>, num + <span class="number">1</span>):</span><br><span class="line">                    <span class="keyword">if</span> T[j] &lt;= T[i]:</span><br><span class="line">                        count += <span class="number">1</span></span><br><span class="line">                    <span class="keyword">else</span>:</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                data.insert(<span class="number">0</span>, count)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure><p>However, the worst time complexity is $O(N^2)$. The code can not pass one of the complex test case which is (Time Limit Exceeded).</p><h2 id="Advance-Approach"><a href="#Advance-Approach" class="headerlink" title="Advance Approach"></a>Advance Approach</h2><p>Stack can be used to improve the efficiency of this issue. We use stack to store a key-value temperature with decreasing order where key is the index of temperature, and value is the temperature. The time complexity of this approache is $O(N)$. For example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">Temperature: [73, 74, 75, 71, 69, 72, 76, 73]</span><br><span class="line">stack = []</span><br><span class="line">res = [0, 0, 0, 0, 0, 0, 0, 0]</span><br><span class="line"></span><br><span class="line">1. index = 0</span><br><span class="line">stack = [(0, 73)]</span><br><span class="line"></span><br><span class="line">2. index = 1</span><br><span class="line">74 &gt; 73, pop (0, 73) and set res[0] = index - 0</span><br><span class="line">stack = [(1, 74)]</span><br><span class="line">res = [1, 0, 0, 0, 0, 0, 0, 0]</span><br><span class="line"></span><br><span class="line">3. index = 2</span><br><span class="line">75 &gt; 74, pop (1, 74) and set res[1] = index - 1</span><br><span class="line">stack = [(2, 75)]</span><br><span class="line">res = [1, 1, 0, 0, 0, 0, 0, 0]</span><br><span class="line"></span><br><span class="line">4. index = 3</span><br><span class="line">71 &lt; 75, add (3, 71) into stack</span><br><span class="line">stack = [(2, 75), (3, 71)]</span><br><span class="line"></span><br><span class="line">5. index = 4</span><br><span class="line">69 &lt; 71, add (3, 69) into stack</span><br><span class="line">stack = [(2, 75), (3, 71), (4, 69)]</span><br><span class="line"></span><br><span class="line">6. index = 5</span><br><span class="line">72 &lt; 69, pop (4, 69) and (3, 71), set res[4] = index - 4, and res[3] = index - 3</span><br><span class="line">stack = [(2, 75), (5, 72)]</span><br><span class="line">res = [1, 1, 0, 2, 1, 0, 0, 0]</span><br><span class="line"></span><br><span class="line">7. index = 6</span><br><span class="line">76 &gt; 72 pop (5, 72) and (2, 75), set res[5] = index - 5, and res[2] = index -2</span><br><span class="line">stack = []</span><br><span class="line">res = [1, 1, 4, 2, 1, 1, 0, 0]</span><br></pre></td></tr></table></figure><p>And implementation is:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">dailyTemperatures</span><span class="params">(self, T: List[int])</span> -&gt; List[int]:</span></span><br><span class="line">        stack = []</span><br><span class="line">        res = [<span class="number">0</span>] * len(T)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(T)):</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> stack <span class="keyword">and</span> stack[<span class="number">-1</span>][<span class="number">1</span>] &lt; T[i]:</span><br><span class="line">                index, val = stack.pop()</span><br><span class="line">                res[index] = i - index</span><br><span class="line"></span><br><span class="line">            stack.append((i, T[i]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> res</span><br></pre></td></tr></table></figure><h1 id="Minimum-Size-Subarray-Sum"><a href="#Minimum-Size-Subarray-Sum" class="headerlink" title="Minimum Size Subarray Sum"></a>Minimum Size Subarray Sum</h1><p><a href="https://leetcode.com/problems/minimum-size-subarray-sum/submissions/" target="_blank" rel="noopener">Minimum Size Subarray Sum</a>: Given an array of positive integers nums and a positive integer target, return the minimal length of a contiguous subarray [numsl, numsl+1, â€¦, numsr-1, numsr] of which the sum is greater than or equal to target. If there is no such subarray, return 0 instead.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: target = 7, nums = [2,3,1,2,4,3]</span><br><span class="line">Output: 2</span><br><span class="line">Explanation: The subarray [4,3] has the minimal length under the problem constraint.</span><br></pre></td></tr></table></figure><h2 id="Brute-Force-1"><a href="#Brute-Force-1" class="headerlink" title="Brute Force"></a>Brute Force</h2><p>The basic approach is to use two loops to solve that. The time complexity of this approach is $O(N^2)$. It will cause time limit exceeded.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minSubArrayLen</span><span class="params">(self, target: int, nums: List[int])</span> -&gt; int:</span></span><br><span class="line">        length = <span class="number">9999</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(nums)):</span><br><span class="line">            res = nums[i]</span><br><span class="line">            <span class="keyword">if</span> res &gt;= target:</span><br><span class="line">                length = <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i + <span class="number">1</span>, len(nums)):</span><br><span class="line">                res += nums[j]</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> res &gt;= target:</span><br><span class="line">                    length = min(length, j - i + <span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> length <span class="keyword">if</span> length != <span class="number">9999</span> <span class="keyword">else</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h2 id="Advance-Approach-1"><a href="#Advance-Approach-1" class="headerlink" title="Advance Approach"></a>Advance Approach</h2><p><img src="/post/b672/1.png" alt><br>To solve this issue, we can use <strong>Sliding Window</strong> to solve this issue. This method is similar to the double pointer. The <code>index</code> the left index of this array. When the sum between <code>i</code> and <code>index</code> is greater or equal to the target, then advance <code>i</code> and <code>index</code> to find other positions that sum is greater or equal to the target. The basic idea of sliding windows is shown in the Figure.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">minSubArrayLen</span><span class="params">(self, target: int, nums: List[int])</span> -&gt; int:</span></span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        res = <span class="number">0</span></span><br><span class="line">        min_len = <span class="number">99999999</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(nums)):</span><br><span class="line">            res += nums[i]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> res &gt;= target:</span><br><span class="line">                length = i - index + <span class="number">1</span></span><br><span class="line">                min_len = min(length, min_len)</span><br><span class="line">                res -= nums[index]</span><br><span class="line">                index += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> min_len <span class="keyword">if</span> min_len != <span class="number">99999999</span> <span class="keyword">else</span> <span class="number">0</span></span><br></pre></td></tr></table></figure><h1 id="Valid-Anagram"><a href="#Valid-Anagram" class="headerlink" title="Valid Anagram"></a>Valid Anagram</h1><p>Given two strings <code>s</code> and <code>t</code>, return true if <code>t</code> is an anagram of <code>s</code>, and false otherwise.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Input: s = &quot;anagram&quot;, t = &quot;nagaram&quot;</span><br><span class="line">Output: true</span><br><span class="line">Input: s = &quot;rat&quot;, t = &quot;car&quot;</span><br><span class="line">Output: false</span><br></pre></td></tr></table></figure><h2 id="Brute-Force-2"><a href="#Brute-Force-2" class="headerlink" title="Brute Force"></a>Brute Force</h2><p>This issue can be solved by using two loop. But the time complexity is $O(N)$. In addition, it also can be done through sort algorithm, to check whether same. But it is too complex. Here we did not code for this approache.</p><h2 id="Advance-Approach-2"><a href="#Advance-Approach-2" class="headerlink" title="Advance Approach"></a>Advance Approach</h2><p>We can use <code>hashmap</code> to record that how many times they appeared in the string. Therefore, the time complexity is $O(N)$.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isAnagram</span><span class="params">(self, s: str, t: str)</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> len(s) != len(t):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        </span><br><span class="line">        data = &#123;&#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                data[i] = <span class="number">1</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                data[i] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> t:</span><br><span class="line">            <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">if</span> data[i] == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    data[i] -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> key, val <span class="keyword">in</span> data.items():</span><br><span class="line">            <span class="keyword">if</span> data[key] != <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><h1 id="Combinations"><a href="#Combinations" class="headerlink" title="Combinations"></a>Combinations</h1><p>Given two integers <code>n</code> and <code>k</code>, return all possible combinations of <code>k</code> numbers out of the range <code>[1, n]</code>. You may return the answer in any order. For example</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Input: n = 4, k = 2</span><br><span class="line">Output:</span><br><span class="line">[</span><br><span class="line">  [2,4],</span><br><span class="line">  [3,4],</span><br><span class="line">  [2,3],</span><br><span class="line">  [1,2],</span><br><span class="line">  [1,3],</span><br><span class="line">  [1,4],</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>It is pretty hard to use loop to solve this issue. Beacause the <code>k</code> determine the number of nested loop, when <code>k=2</code> then it should have three nested loop. However, when k in not a const number, then we can not determine how many loops we need.</p><p>Therefore, we can use recursion to do this kind of issues. We can seen it as a tree as shown in the Figure. The root node is <code>1-n</code> and the deep is <code>k</code>. Pick up the number from left to right without repeating. We can set up a <code>path</code> to record the visited path, and when the length of <code>path</code> is equal to <code>k</code> then add the <code>path</code> to result.</p><p><img src="/post/b672/1.png" alt></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">combine</span><span class="params">(self, n: int, k: int)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">back_tracking</span><span class="params">(n, k, index, path, result)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> len(path) == k:</span><br><span class="line">                result.append([i <span class="keyword">for</span> i <span class="keyword">in</span> path])</span><br><span class="line">                <span class="keyword">return</span> path</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(index + <span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">                path.append(i)</span><br><span class="line">                back_tracking(n, k, i, path, result)</span><br><span class="line">                path.pop()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> back_tracking(n, k, <span class="number">0</span>, [], [])</span><br></pre></td></tr></table></figure><h1 id="Combination-Sum-III"><a href="#Combination-Sum-III" class="headerlink" title="Combination Sum III"></a>Combination Sum III</h1><p><a href="https://leetcode.com/problems/combination-sum-iii/" target="_blank" rel="noopener">Combination Sum III</a>: Find all valid combinations of k numbers that sum up to n such that the following conditions are true:</p><ul><li>Only numbers 1 through 9 are used.</li><li>Each number is used at most once.</li></ul><p>Return a list of all possible valid combinations. The list must not contain the same combination twice, and the combinations may be returned in any order. For example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Input: k = 3, n = 7</span><br><span class="line">Output: [[1,2,4]]</span><br><span class="line">Explanation:</span><br><span class="line">1 + 2 + 4 = 7</span><br><span class="line">There are no other valid combinations.</span><br></pre></td></tr></table></figure><p>This question is pretty similar with the previous one, just add one more constrain (sum = n).</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">combinationSum3</span><span class="params">(self, k: int, n: int)</span> -&gt; List[List[int]]:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">combine</span><span class="params">(k, n, index, path, result)</span>:</span></span><br><span class="line">            <span class="keyword">if</span> len(path) == k:</span><br><span class="line">                <span class="keyword">if</span> sum(path) == n:</span><br><span class="line">                    result.append([i <span class="keyword">for</span> i <span class="keyword">in</span> path])</span><br><span class="line">                <span class="keyword">return</span> path</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> range(index, <span class="number">10</span>):</span><br><span class="line">                path.append(i)</span><br><span class="line">                combine(k, n, i + <span class="number">1</span>, path, result)</span><br><span class="line"></span><br><span class="line">                path.pop()</span><br><span class="line"></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">return</span> combine(k, n, <span class="number">1</span>, [], [])</span><br></pre></td></tr></table></figure><h1 id="Valid-Palindrome"><a href="#Valid-Palindrome" class="headerlink" title="Valid Palindrome"></a>Valid Palindrome</h1><p><a href="https://leetcode.com/problems/valid-palindrome/" target="_blank" rel="noopener">Valid Palindrome</a>: Given a string s, determine if it is a palindrome, considering only alphanumeric characters and ignoring cases.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Input: s = &quot;A man, a plan, a canal: Panama&quot;</span><br><span class="line">Output: true</span><br><span class="line">Explanation: &quot;amanaplanacanalpanama&quot; is a palindrome.</span><br></pre></td></tr></table></figure><p>This one is pretty easy, we just need to ignore the char which is not belong to <code>a-z, 0-9</code>. During the processing, we can use double pointer to do that. Set a index from the left and a index from the right.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isPalindrome</span><span class="params">(self, s: str)</span> -&gt; bool:</span></span><br><span class="line">        s = s.lower()</span><br><span class="line">        start = <span class="number">0</span></span><br><span class="line">        end = len(s) - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> start &lt;= end:</span><br><span class="line">            l = s[start]</span><br><span class="line">            r = s[end]</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> l.isalnum():</span><br><span class="line">                start += <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> r.isalnum():</span><br><span class="line">                end -= <span class="number">1</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> s[start] != s[end]:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">            start += <span class="number">1</span></span><br><span class="line">            end -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><h1 id="Next-Greater-Node-In-Linked-List"><a href="#Next-Greater-Node-In-Linked-List" class="headerlink" title="Next Greater Node In Linked List"></a>Next Greater Node In Linked List</h1><p><a href="https://leetcode.com/problems/next-greater-node-in-linked-list/" target="_blank" rel="noopener">Next Greater Node In Linked List</a> is a medium problem.<br>We are given a linked list with <code>head</code> as the first node.  Letâ€™s number the nodes in the list: <code>node_1, node_2, node_3, ... etc.</code></p><p>Each node may have a next larger value: for node_i, next_larger(node_i) is the node_j.val such that <code>j &gt; i</code>, <code>node_j.val &gt; node_i.val,</code> and <code>j</code> is the smallest possible choice.  If such a j does not exist, the next larger value is 0.</p><p>Return an array of integers answer, where <code>answer[i] = next_larger(node_{i+1})</code>.</p><p>Note that in the example inputs (not outputs) below, arrays such as <code>[2,1,5]</code> represent the serialization of a linked list with a head node value of 2, second node value of 1, and third node value of 5.</p><h2 id="Approach"><a href="#Approach" class="headerlink" title="Approach"></a>Approach</h2><p>This problem is pretty similar with <a href="https://leetcode.com/problems/daily-temperatures/" target="_blank" rel="noopener">Daily Temperatures</a> which can be solved by applying stack. For this issue, we can use <code>stack</code> + <code>hashmap</code> to solve it with $O(n)$ time complexity.</p><ol><li>Init stack and the final result.</li><li><code>result</code>(hashmap) will recored the index as key and greater or 0 value as the value</li><li>When the <code>temp</code> node value is greater then the top value of the stack, update the <code>result</code> value and pop the top value of stack.</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Definition for singly-linked list.</span></span><br><span class="line"><span class="comment"># class ListNode:</span></span><br><span class="line"><span class="comment">#     def __init__(self, val=0, next=None):</span></span><br><span class="line"><span class="comment">#         self.val = val</span></span><br><span class="line"><span class="comment">#         self.next = next</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">nextLargerNodes</span><span class="params">(self, head: ListNode)</span> -&gt; List[int]:</span></span><br><span class="line">        stack = []</span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        </span><br><span class="line">        temp = head</span><br><span class="line">        index = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment"># stack store like (val, pos)</span></span><br><span class="line">        <span class="keyword">while</span> (temp != <span class="literal">None</span>):</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">while</span> len(stack) != <span class="number">0</span> <span class="keyword">and</span> temp.val &gt; stack[len(stack) - <span class="number">1</span>][<span class="number">0</span>]:</span><br><span class="line">                result[stack[len(stack) - <span class="number">1</span>][<span class="number">1</span>]] = temp.val</span><br><span class="line">                stack.pop(len(stack) - <span class="number">1</span>)</span><br><span class="line">            </span><br><span class="line">            stack.append((temp.val, index))</span><br><span class="line">            result[index] = <span class="number">0</span></span><br><span class="line">            </span><br><span class="line">            index += <span class="number">1</span></span><br><span class="line">            temp = temp.next</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> result.values()</span><br></pre></td></tr></table></figure><p>We can use the following data to give an example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Input: [2,1,5]</span><br><span class="line">Output: [5,5,0]</span><br></pre></td></tr></table></figure><p>In the following part, we will display the <code>result</code> and <code>stack</code> storage.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">1. stack.push((2, 0)) stack = [(2, 0)], result = &#123;0: 0&#125;</span><br><span class="line"></span><br><span class="line">2. stack.push((1, 1)), stack = [(2, 0), (1, 1)], result = &#123;0: 0, 1: 0&#125;</span><br><span class="line"></span><br><span class="line">3. The node value is 5, greater than 1, then</span><br><span class="line">    1. top value of stack is (1, 1), then result[1] = node.val (5), stack pop (1, 1)</span><br><span class="line">    2. top value of stack is (2, 0), then result[0] = node.val (5), stack pop (2, 0)</span><br><span class="line">    3. End while loop, and insert the (5, 3) into stack and result.</span><br><span class="line"></span><br><span class="line">The final value in result is:</span><br><span class="line">result = &#123;</span><br><span class="line">    0: 5,</span><br><span class="line">    1: 5,</span><br><span class="line">    2: 0</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="How-Many-Numbers-Are-Smaller-Than-the-Current-Number"><a href="#How-Many-Numbers-Are-Smaller-Than-the-Current-Number" class="headerlink" title="How Many Numbers Are Smaller Than the Current Number"></a>How Many Numbers Are Smaller Than the Current Number</h1><p><a href="https://leetcode.com/problems/how-many-numbers-are-smaller-than-the-current-number/" target="_blank" rel="noopener">How Many Numbers Are Smaller Than the Current Number</a> is an easy problem. Howerver, it is more interesting than other questions.</p><p>Given the array nums, for each <code>nums[i]</code> find out how many numbers in the array are smaller than it. That is, for each <code>nums[i]</code> you have to count the number of valid jâ€™s such that <code>j != i</code> and <code>nums[j] &lt; nums[i]</code>.</p><p>Example 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Input: nums = [8,1,2,2,3]</span><br><span class="line">Output: [4,0,1,1,3]</span><br><span class="line">Explanation: </span><br><span class="line">For nums[0]=8 there exist four smaller numbers than it (1, 2, 2 and 3). </span><br><span class="line">For nums[1]=1 does not exist any smaller number than it.</span><br><span class="line">For nums[2]=2 there exist one smaller number than it (1). </span><br><span class="line">For nums[3]=2 there exist one smaller number than it (1). </span><br><span class="line">For nums[4]=3 there exist three smaller numbers than it (1, 2 and 2).</span><br></pre></td></tr></table></figure><h2 id="Approach-1"><a href="#Approach-1" class="headerlink" title="Approach"></a>Approach</h2><p>Naive approach is brute force. Just use two nest loop can get the result.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">result = []</span><br><span class="line">for i in range(0, len(nums)):</span><br><span class="line">    num = 0</span><br><span class="line">    for j in range(i, len(nums)):</span><br><span class="line">        if nums[i] &gt; nums[j]:</span><br><span class="line">            num += 1</span><br><span class="line">    result.append(num)</span><br></pre></td></tr></table></figure><p>The time complexity is <code>O(n^2)</code></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;An extension of &lt;a href=&quot;https://shunyangli.github.io/2020/05/26/leetcode/#more&quot;&gt;leetcode&lt;/a&gt;. Keep working on leetcode.&lt;/p&gt;
&lt;h1 id=&quot;Dail
      
    
    </summary>
    
    
      <category term="leetcode" scheme="https://shunyangli.github.io/categories/leetcode/"/>
    
    
      <category term="leetcode" scheme="https://shunyangli.github.io/tags/leetcode/"/>
    
      <category term="algorithm" scheme="https://shunyangli.github.io/tags/algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Nano Editor</title>
    <link href="https://shunyangli.github.io/post/943f/"/>
    <id>https://shunyangli.github.io/post/943f/</id>
    <published>2022-02-08T08:49:26.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p><a href="https://www.nano-editor.org/" target="_blank" rel="noopener">Nano</a> is a text editor for terminals.</p><h1 id="Open-and-create-files"><a href="#Open-and-create-files" class="headerlink" title="Open and create files"></a>Open and create files</h1><p>Open or create new files, you can type the following command:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nano filename</span><br></pre></td></tr></table></figure><p>This will open a new editor window and you can start editing the file. At the bottom of the window, the most basic command shortcuts that can be used with the nano editor are listed. <code>^</code> means <code>Ctrl</code> keys (e.g., <code>^X</code> = <code>Ctrl + X</code>).</p><h1 id="Search-and-replace"><a href="#Search-and-replace" class="headerlink" title="Search and replace"></a>Search and replace</h1><p>You can use <code>Ctrl + w</code> to search key words, it will match the first key word. Then you can use <code>Alt + w</code> to move to the next key word.</p><p>To search and replace, press <code>Ctrl + \</code>. Enter the search term and the text to be replaced. The editor will move to the first match and ask if you want to replace it. y or n will move to the next match. Pressing A will replace all matches.</p><h1 id="Save-and-exit"><a href="#Save-and-exit" class="headerlink" title="Save and exit"></a>Save and exit</h1><p>To save changes made to a file, press <code>Ctrl + o</code>. If the file does not yet exist, it will be created immediately after saving.</p><p>To exit nano, press <code>Ctrl + x</code>. If there are unsaved changes, you will be asked if you want to save the changes (<code>Y</code> means save, <code>N</code> means not save).</p><p>To save a file, you must have write access to the file. To create a new file, you need to have write access to the directory where the file will be createde</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Introduction&quot;&gt;&lt;a href=&quot;#Introduction&quot; class=&quot;headerlink&quot; title=&quot;Introduction&quot;&gt;&lt;/a&gt;Introduction&lt;/h1&gt;&lt;p&gt;&lt;a href=&quot;https://www.nano-edit
      
    
    </summary>
    
    
      <category term="tool" scheme="https://shunyangli.github.io/categories/tool/"/>
    
    
      <category term="tool" scheme="https://shunyangli.github.io/tags/tool/"/>
    
  </entry>
  
  <entry>
    <title>Hadoop Partition</title>
    <link href="https://shunyangli.github.io/post/8700/"/>
    <id>https://shunyangli.github.io/post/8700/</id>
    <published>2021-10-13T13:11:54.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Hadoop-Partition-And-Secondary-Sort"><a href="#Hadoop-Partition-And-Secondary-Sort" class="headerlink" title="Hadoop Partition And Secondary Sort"></a>Hadoop Partition And Secondary Sort</h1><p>This article will describe an implementation and process of Hadoop partitioning and secondary sorting. First we need to briefly understand the workflow of Hadoop map-reduce task. In the <a href="https://shunyangli.github.io/2021/09/08/Hadoop-Distributed-System/#more">previous article</a>, we briefly explained the operation mechanism of Hadoop. The mapper task will read the file and process the data, after processing the mapper task will pass the result to the shuffle. shuffle will sort and partition all the map task results, and then will pass the partitioned and sorted data to the reducer, the key-value pairs with the same key will be passed to the same reducer. </p><p><img src="/post/8700/1.png" alt></p><p> The default distribution method used by hadoop is based on the hash value, but in practice, this is not very efficient or performs the task as we require. For example, after partitioning, one nodeâ€™s reducer is assigned 20 records while the other is assigned 10 million records, so imagine how inefficient this is. Or, we want to process the output file according to a certain rule, assuming there are two reducers, we want the final result to store the results of records starting with â€œaâ€ in part-00000, and other results in part-00001, the default partitioner is unable to do. So we need to customize our own partition to choose the reducer of records according to our own requirements.</p><h1 id="Why-partition"><a href="#Why-partition" class="headerlink" title="Why partition"></a>Why partition</h1><p>We want to use Hadoop to get a ordered file by using a partition (because it will be sorted before partitioning).  However if the input is huge (e.g. 10 GB), the performance of reducer is pretty inefficient which completely losing the advantage of the parallel architecture provided by MapReduce. We can use a partitioner to sort the data, so that when the reducer processes the data, it can be guaranteed that the data is already sorted. One partition corresponds to one reducer, so all the output of the reducer is ordered, we just need to merge all the output files, then the total file must be ordered.</p><h1 id="Hadoop-Streaming-Partition"><a href="#Hadoop-Streaming-Partition" class="headerlink" title="Hadoop Streaming Partition"></a>Hadoop Streaming Partition</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">mapred streaming \</span><br><span class="line"> -D mapreduce.job.output.key.comparator.class=org.apache.hadoop.mapreduce.lib.partition.KeyFieldBasedComparator \</span><br><span class="line"> -D stream.map.output.field.separator=, \</span><br><span class="line"> -D stream.num.map.output.key.fields=2 \</span><br><span class="line"> -D mapreduce.map.output.key.field.separator=,\</span><br><span class="line"> -D mapreduce.partition.keycomparator.options=-k2,2nr \</span><br><span class="line"> -D mapreduce.job.reduces=2\</span><br><span class="line"> -input input</span><br><span class="line"> -output output \</span><br><span class="line"> -mapper /bin/cat \</span><br><span class="line"> -reducer /bin/cat \</span><br><span class="line"> -partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">-D map.output.key.field.separator=, means the separator for the key is â€œ,â€</span><br><span class="line">-D stream.num.map.output.key.fields=2 means the prefix up to the second â€œ,â€ in a line will be the key and the rest of the line (excluding the second â€œ,â€) will be the value.</span><br><span class="line"></span><br><span class="line">e.g.:</span><br><span class="line">1,2,3 then &apos;map.output.key.field.separator&apos; split the input by , and &apos;stream.num.map.output.key.fields=2&apos; will set (1,2) is the key and 3 is the value</span><br><span class="line"></span><br><span class="line">-D map.output.key.field.separator=, means the separator for the key is also â€œ,â€</span><br><span class="line"></span><br><span class="line">-D mapreduce.partition.keypartitioner.options=-k1,2â€ means</span><br><span class="line">MapReduce will partition the map outputs by the first two fields of the keys</span><br></pre></td></tr></table></figure><p>For example, the input files is like this, name (input.txt)</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">muse,curious,1</span><br><span class="line">muse,days,2</span><br><span class="line">muse,do,3</span><br><span class="line">muse,growing,4</span><br><span class="line">muse,grown,5</span><br><span class="line">muse,in,1</span><br><span class="line">cat,invent,2</span><br><span class="line">muse,more,3</span><br><span class="line">muse,please,4</span><br><span class="line">cat,subject,5</span><br><span class="line">cat,ten,2</span><br><span class="line">muse,these,3</span><br><span class="line">muse,this,2</span><br><span class="line">muse,times,5</span><br><span class="line">muse,to,6</span><br><span class="line">cat,want,8</span><br><span class="line">muse,with,9</span><br><span class="line">muse,worth,0</span><br><span class="line">muse,*,10</span><br><span class="line">muse,age,12</span><br></pre></td></tr></table></figure><p>Put this file into hdfs:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdfs dfs -put input.txt input</span><br></pre></td></tr></table></figure><p>We partition by two different ranges of keys (mapreduce.partition.keypartitioner.options) (e.g.: key is (muse, curious) value is 1), and we get two different results.</p><p>The first command is partition based the first filed in the key.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hadoop jar $HADOOP_HOME/share/hadoop/tools/lib/hadoop-streaming-*.jar \</span><br><span class="line">-D stream.map.output.field.separator=, \</span><br><span class="line">-D stream.num.map.output.key.fields=2 \</span><br><span class="line">-D map.output.key.field.separator=, \</span><br><span class="line">-D mapreduce.partition.keypartitioner.options=-k1,1 \</span><br><span class="line">-D mapreduce.job.reduces=3 \</span><br><span class="line">-input input/test.txt \</span><br><span class="line">-output ou2 \</span><br><span class="line">-mapper /bin/cat \</span><br><span class="line">-reducer /bin/cat \</span><br><span class="line">-partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner</span><br></pre></td></tr></table></figure><p>The first reducer gets:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat,invent2</span><br><span class="line">cat,subject5</span><br><span class="line">cat,ten2</span><br><span class="line">cat,want8</span><br></pre></td></tr></table></figure><p>The second reducer gets:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">muse,*10</span><br><span class="line">muse,age12</span><br><span class="line">muse,curious1</span><br><span class="line">muse,days2</span><br><span class="line">muse,do3</span><br><span class="line">muse,growing4</span><br><span class="line">muse,grown5</span><br><span class="line">muse,in1</span><br><span class="line">muse,more3</span><br><span class="line">muse,please4</span><br><span class="line">muse,these3</span><br><span class="line">muse,this2</span><br><span class="line">muse,times5</span><br><span class="line">muse,to6</span><br><span class="line">muse,with9</span><br><span class="line">muse,worth0</span><br></pre></td></tr></table></figure><p>The last reducer is empty. With the result of the reducer we get the desired partition.</p><p>The first command is partition based the second filed in the key.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hadoop jar $HADOOP_HOME/share/hadoop/tools/lib/hadoop-streaming-*.jar \</span><br><span class="line">-D stream.map.output.field.separator=, \</span><br><span class="line">-D stream.num.map.output.key.fields=2 \</span><br><span class="line">-D map.output.key.field.separator=, \</span><br><span class="line">-D mapreduce.partition.keypartitioner.options=-k2,2 \</span><br><span class="line">-D mapreduce.job.reduces=3 \</span><br><span class="line">-input input/test.txt \</span><br><span class="line">-output ou1 \</span><br><span class="line">-mapper /bin/cat \</span><br><span class="line">-reducer /bin/cat \</span><br><span class="line">-partitioner org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner</span><br></pre></td></tr></table></figure><p>Reducer 1:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat,subject5</span><br><span class="line">cat,ten2</span><br><span class="line">muse,*10</span><br><span class="line">muse,more3</span><br><span class="line">muse,these3</span><br><span class="line">muse,times5</span><br><span class="line">muse,with9</span><br><span class="line">muse,worth0</span><br></pre></td></tr></table></figure><p>Reducer 2:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat,invent2</span><br><span class="line">cat,want8</span><br><span class="line">muse,age12</span><br><span class="line">muse,curious1</span><br><span class="line">muse,days2</span><br><span class="line">muse,do3</span><br></pre></td></tr></table></figure><p>Reducer 3:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">muse,growing4</span><br><span class="line">muse,grown5</span><br><span class="line">muse,in1</span><br><span class="line">muse,please4</span><br><span class="line">muse,this2</span><br><span class="line">muse,to6</span><br></pre></td></tr></table></figure><p>Comparing the two output results we can see that different partition ranges lead to completely different partition results.</p><h1 id="MRJob-example"><a href="#MRJob-example" class="headerlink" title="MRJob example"></a>MRJob example</h1><p>By using the given text file, I did a example that in mrjob.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mrjob.job <span class="keyword">import</span> MRJob</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span><span class="params">(MRJob)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    the number of reducer is 1,</span></span><br><span class="line"><span class="string">    then we can use map separator</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapper</span><span class="params">(self, _, line)</span>:</span></span><br><span class="line">        words = line.split(<span class="string">','</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">yield</span> words[<span class="number">0</span>]   <span class="string">","</span>   words[<span class="number">1</span>], int(words[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reducer</span><span class="params">(self, key, values)</span>:</span></span><br><span class="line">        <span class="keyword">yield</span> key, sum(values)</span><br><span class="line">                </span><br><span class="line"></span><br><span class="line">    SORT_VALUES = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    JOBCONF = &#123;</span><br><span class="line">      <span class="string">'map.output.key.field.separator'</span>: <span class="string">','</span>,</span><br><span class="line">      <span class="string">'mapred.reduce.tasks'</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="string">'mapreduce.partition.keypartitioner.options'</span>:<span class="string">'-k1,1'</span>,</span><br><span class="line">      <span class="string">'partitioner'</span>:<span class="string">'org.apache.hadoop.mapred.lib.KeyFieldBasedPartitioner'</span>,</span><br><span class="line">      <span class="string">'mapreduce.partition.keycomparator.options'</span>:<span class="string">'-k1,1 -k2,2n'</span>,</span><br><span class="line">      <span class="string">'mapreduce.job.output.key.comparator.class'</span>:<span class="string">'org.apache.hadoop.mapreduce.lib.partition.KeyFieldBasedComparator'</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    Example.run()</span><br></pre></td></tr></table></figure><p>Run the code:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 example.py -r hadoop hdfs:///user/xx/example.txt -o hdfs:///user/xx/output</span><br></pre></td></tr></table></figure><p>The result of three reducers:</p><ol><li><p>None</p></li><li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">muse,*10</span><br><span class="line">muse,age12</span><br><span class="line">muse,curious1</span><br><span class="line">muse,days2</span><br><span class="line">muse,do3</span><br><span class="line">muse,growing4</span><br><span class="line">muse,grown5</span><br><span class="line">muse,in1</span><br><span class="line">muse,more3</span><br><span class="line">muse,please4</span><br><span class="line">muse,these3</span><br><span class="line">muse,this2</span><br><span class="line">muse,times5</span><br><span class="line">muse,to6</span><br><span class="line">muse,with9</span><br><span class="line">muse,worth0</span><br></pre></td></tr></table></figure></li><li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat,invent2</span><br><span class="line">cat,subject5</span><br><span class="line">cat,ten2</span><br><span class="line">cat,want8</span><br></pre></td></tr></table></figure></li></ol><h1 id="Partition-and-secondary-sort-video"><a href="#Partition-and-secondary-sort-video" class="headerlink" title="Partition and secondary sort video"></a>Partition and secondary sort video</h1><iframe width="950" height="525" src="https://www.youtube.com/embed/ljFjAeKjZm8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Hadoop-Partition-And-Secondary-Sort&quot;&gt;&lt;a href=&quot;#Hadoop-Partition-And-Secondary-Sort&quot; class=&quot;headerlink&quot; title=&quot;Hadoop Partition And S
      
    
    </summary>
    
    
    
      <category term="Distributed" scheme="https://shunyangli.github.io/tags/Distributed/"/>
    
  </entry>
  
  <entry>
    <title>mrjob for hadoop</title>
    <link href="https://shunyangli.github.io/post/af28/"/>
    <id>https://shunyangli.github.io/post/af28/</id>
    <published>2021-09-16T12:42:15.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/Yelp/mrjob" target="_blank" rel="noopener">mrjob</a> is the easiest way to write python programs that can run on hadoop. Its most prominent feature is that with the help of mrjob, there is no need to install hadoop or deploy any cluster, and we can run the code (for testing) on our local machine. Also, mrjob can easily run on Amazon Elastic MapReduce.</p><p>Since Hadoop does not currently support the python API, we can only use the stream processing method to complete the mapredduce ren using python. mrjob is a good choice.</p><h1 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h1><p>If you did not installed <a href="https://pip.pypa.io/en/stable/" target="_blank" rel="noopener">pip3</a> for Linux, then you can execute the following command:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update &amp;&amp; sudo apt install python3-pip</span><br></pre></td></tr></table></figure><p>After that, you can install mrjob by using <code>pip3</code>:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install mrjob</span><br></pre></td></tr></table></figure><p>To check if your installation is correct you can execute in the python3 terminal:</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">âžœ  ~ &gt; python3</span><br><span class="line">Python 3.8.10 (default, Jun  2 2021, 10:49:15) </span><br><span class="line">[GCC 9.4.0] on linux</span><br><span class="line">Type "help", "copyright", "credits" or "license" for more information.</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt; import mrjob</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash">&gt;&gt;</span></span><br></pre></td></tr></table></figure><p>If there is no output from import, the installation is successful.</p><h1 id="mrjob-example"><a href="#mrjob-example" class="headerlink" title="mrjob example"></a>mrjob example</h1><p>We use a generic word count example to demonstrate the use of mrjob.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> mrjob.job <span class="keyword">import</span> MRJob</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">WordCount</span><span class="params">(MRJob)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">mapper</span><span class="params">(self, _, line)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> line.split():</span><br><span class="line">            <span class="keyword">yield</span> (word, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">reducer</span><span class="params">(self, key, values)</span>:</span></span><br><span class="line">        <span class="keyword">yield</span> key, sum(values)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    WordCount.run()</span><br></pre></td></tr></table></figure><p>Using yield, you can let the function generate a sequence, the function returns an object of type â€œgeneratorâ€, through the object to call the next() method to return the sequence of values.</p><p>Briefly understand: yield is return returns a value, and remember this return position, the next iteration will start from this position after (the next line).</p><p>For example:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">âžœ  ~ &gt; python3                         </span><br><span class="line">Python <span class="number">3.8</span><span class="number">.10</span> (default, Jun  <span class="number">2</span> <span class="number">2021</span>, <span class="number">10</span>:<span class="number">49</span>:<span class="number">15</span>) </span><br><span class="line">[GCC <span class="number">9.4</span><span class="number">.0</span>] on linux</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> <span class="keyword">or</span> <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="function"><span class="keyword">def</span> <span class="title">count</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">... </span>    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">3</span>):</span><br><span class="line"><span class="meta">... </span>        <span class="keyword">yield</span> i</span><br><span class="line"><span class="meta">... </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num = count()</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num</span><br><span class="line">&lt;generator object count at <span class="number">0x7f5786f7d900</span>&gt;</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num.__next__()</span><br><span class="line"><span class="number">0</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num.__next__()</span><br><span class="line"><span class="number">1</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num.__next__()</span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>num.__next__()</span><br><span class="line">Traceback (most recent call last):</span><br><span class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">StopIteration</span><br></pre></td></tr></table></figure><p>By execute the <code>word_count.py</code> in local environment:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 word_count.py input.txt</span><br></pre></td></tr></table></figure><h1 id="MapReduce"><a href="#MapReduce" class="headerlink" title="MapReduce"></a>MapReduce</h1><p>mapreduce is a system for processing large amounts of data on distributed systems. It is based on the paper <a href="https://dl.acm.org/doi/pdf/10.1145/1327452.1327492" target="_blank" rel="noopener">MapReduce: Simplified Data Processing on Large Clusters</a>. mapreduce divides massive data into small data sets, performs the same task in parallel, and finally collates and merges all the sub-results into the final result. The step of splitting the data for the same is called mapper, and the step of merging and organizing later is called reducer. combiner can be seen as an optimizer, but it is not necessary.</p><p>When we are calling the Hadoop framework with mrjob, we first need to configure Hadoop. <strong>You must make sure that yarn is started at the time of mrjob.</strong> </p><p>Configuration of <code>mapred-site.xml</code> :</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.framework.name<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>yarn<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.app.mapreduce.am.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=$HADOOP_MAPRED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.map.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=$HADOOP_MAPRED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>mapreduce.reduce.env<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>HADOOP_MAPRED_HOME=$HADOOP_MAPRED_HOME<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Configuration of <code>yarn-site.xml</code>:</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>yarn.nodemanager.aux-services<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </span><br><span class="line">        <span class="tag">&lt;<span class="name">value</span>&gt;</span>mapreduce_shuffle<span class="tag">&lt;/<span class="name">value</span>&gt;</span> </span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure><h1 id="Execute-hadoop-on-mrjob"><a href="#Execute-hadoop-on-mrjob" class="headerlink" title="Execute hadoop on mrjob"></a>Execute hadoop on mrjob</h1><p>Use the same word count code, then we can execute the file by using:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 word_count.py -r hadoop input.txt</span><br></pre></td></tr></table></figure><p>mrjob can also call the file above the hdfs:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 word_count.py -r hadoop hdfs:///input/input.txt</span><br></pre></td></tr></table></figure><h1 id="Hadoop-JAVA-and-mrjob-installation"><a href="#Hadoop-JAVA-and-mrjob-installation" class="headerlink" title="Hadoop, JAVA and mrjob installation"></a>Hadoop, JAVA and mrjob installation</h1><iframe width="950" height="534" src="https://www.youtube.com/embed/lux2RA7ul4w" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;a href=&quot;https://github.com/Yelp/mrjob&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;mrjob&lt;/a&gt; is the easiest way to write python programs that can run
      
    
    </summary>
    
    
    
      <category term="Distributed" scheme="https://shunyangli.github.io/tags/Distributed/"/>
    
  </entry>
  
  <entry>
    <title>Hadoop Distributed System</title>
    <link href="https://shunyangli.github.io/post/515d/"/>
    <id>https://shunyangli.github.io/post/515d/</id>
    <published>2021-09-08T10:01:55.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>HDFSçš„åŽŸç†ä»¥åŠHadoopçš„å®‰è£…ï¼ŒMapReduceçš„è¿è¡Œæµç¨‹ï¼Œshuffleçš„è¿è¡Œæœºåˆ¶ã€‚</p><h1 id="hdfs-åŠŸèƒ½"><a href="#hdfs-åŠŸèƒ½" class="headerlink" title="hdfs åŠŸèƒ½"></a>hdfs åŠŸèƒ½</h1><p>HDFSï¼šåˆ†å¸ƒå¼æ–‡ä»¶ç®¡ç†ç³»ç»Ÿ </p><p>Hadoop fsï¼šä½¿ç”¨é¢æœ€å¹¿ï¼Œå¯ä»¥æ“ä½œä»»ä½•æ–‡ä»¶ç³»ç»Ÿã€‚ </p><p>hadoop dfsä¸Žhdfs dfsï¼šåªèƒ½æ“ä½œHDFSæ–‡ä»¶ç³»ç»Ÿç›¸å…³ï¼ˆåŒ…æ‹¬ä¸ŽLocal FSé—´çš„æ“ä½œï¼‰ï¼Œå‰è€…å·²ç»Deprecatedï¼Œä¸€èˆ¬ä½¿ç”¨åŽè€…ã€‚ </p><p>Hadoop/hdfs fs/dfs {args} {args} </p><h1 id="hdfs-å®žçŽ°åŽŸç†"><a href="#hdfs-å®žçŽ°åŽŸç†" class="headerlink" title="hdfs å®žçŽ°åŽŸç†"></a>hdfs å®žçŽ°åŽŸç†</h1><p>å½“åœ¨ä½¿ç”¨hdfs dfs -putå‘½ä»¤çš„æ—¶å€™ï¼Œæ–‡ä»¶ä¼šè¢«åˆ‡å—ï¼ˆæ–‡ä»¶å—çš„å¤§å°é€šè¿‡å‚æ•°æ¥å†³å®šï¼Œé»˜è®¤æ˜¯128Mï¼‰å­˜æ”¾åˆ°ä¸åŒçš„datanode serveré‡Œé¢ï¼Œå…·ä½“åˆ†å¸ƒåˆ°å“ªä¸ªdatanodeå–å†³äºŽnamenode serverã€‚<br>namenodeä¼šè®°å½•å¹¶ç»´æŠ¤ä¸åŒçš„æ–‡ä»¶å—æ‰€å­˜æ”¾çš„å…·ä½“ä½ç½®ï¼ˆå­˜æ”¾åœ¨å“ªä¸ªdatanodeé‡Œé¢ï¼‰ï¼Œè¿™äº›ä¿¡æ¯è¢«ç§°ä½œå…ƒæ•°æ®ã€‚ </p><pre><code class="shell">e.g.: fileè¢«åˆ†å‰²æˆ3å—ï¼Œåˆ†åˆ«å­˜æ”¾åœ¨datanode0, datanode1 and datanode 2ã€‚ é‚£ä¹ˆåœ¨namenodeä¼šè®°å½•: file: {block0: datanode0-server, block1: datanode1-server, block2: datanode2-serverã€‚ </code></pre><p>å½“åœ¨ä½¿ç”¨hdfs dfs -get çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šåœ¨namenodeèŽ·å–æºæ•°æ®ï¼Œç„¶åŽæ ¹æ®å…ƒæ•°æ®è®°å½•çš„æ–‡ä»¶å—å­˜æ”¾çš„ä½ç½®è¿›è¡ŒèŽ·å–æ–‡ä»¶å—ï¼Œç„¶åŽåˆå¹¶ã€‚<br><img src="/post/515d/1.png" alt></p><h2 id="hdfså‰¯æœ¬"><a href="#hdfså‰¯æœ¬" class="headerlink" title="hdfså‰¯æœ¬"></a>hdfså‰¯æœ¬</h2><p>ä¸ºäº†é˜²æ­¢datanodeå‡ºçŽ°å®•æœºæƒ…å†µï¼Œhdfsä¼šå¯¹æ–‡ä»¶è¿›è¡Œå‚¨å­˜å‰¯æœ¬ï¼Œå‰¯æœ¬çš„å…·ä½“æ•°é‡ç”±ç”¨æˆ·è®¾å®šã€‚å°±æ˜¯æŠŠåŒä¸€æ–‡ä»¶å—å‚¨å­˜åœ¨ä¸åŒçš„datanodeä¸Šé¢ã€‚ </p><h2 id="hdfsç‰¹ç‚¹"><a href="#hdfsç‰¹ç‚¹" class="headerlink" title="hdfsç‰¹ç‚¹"></a>hdfsç‰¹ç‚¹</h2><p>hdfsæ˜¯é€‚åº”ä¸€æ¬¡å†™å…¥ï¼Œå¤šæ¬¡è¯»çš„åœºæ™¯ï¼Œä¸æ”¯æŒæ–‡ä»¶çš„ä¿®æ”¹ã€‚æ‰€ä»¥hdfsä¸é€‚åˆåšç½‘ç›˜åº”ç”¨ï¼Œå› ä¸ºå»¶è¿Ÿé«˜ï¼Œå¼€é”€å¤§ã€‚<br>ä¼˜ç‚¹ï¼šå¯ä»¥çº¿æ€§æ‰©å±•ï¼ˆä¸å¤Ÿå­˜æˆ‘ç›´æŽ¥å†ç§Ÿå‡ ä¸ªæœåŠ¡å™¨å°±å¤Ÿäº†ï¼‰ï¼Œæ•°æ®å‚¨å­˜å¯é æ€§é«˜ï¼Œåˆ†å¸ƒå¼è¿ç®—å¤„ç†æ–¹ä¾¿ã€‚ </p><h1 id="hdfs-è¯»-å†™æ•°æ®æµç¨‹"><a href="#hdfs-è¯»-å†™æ•°æ®æµç¨‹" class="headerlink" title="hdfs è¯»/å†™æ•°æ®æµç¨‹"></a>hdfs è¯»/å†™æ•°æ®æµç¨‹</h1><h2 id="hdfsè¯»æ•°æ®æµç¨‹"><a href="#hdfsè¯»æ•°æ®æµç¨‹" class="headerlink" title="hdfsè¯»æ•°æ®æµç¨‹"></a>hdfsè¯»æ•°æ®æµç¨‹</h2><ul><li><p>å’Œnamenodeé€šä¿¡æŸ¥è¯¢å…ƒæ•°æ®ï¼Œæ ¹æ®å…ƒæ•°æ®æ‰¾åˆ°æ–‡ä»¶å¿«æ‰€åœ¨çš„datanode server </p></li><li><p>æŒ‘é€‰ä¸€ä¸ªdatanode serverï¼ˆå°±è¿‘åŽŸåˆ™ï¼Œç„¶åŽéšæœºï¼‰ï¼Œå»ºç«‹socket é€šä¿¡ </p></li><li><p>datanodeå¼€å§‹å‘é€æ•°æ®ï¼ˆé‡‡ç”¨streamingï¼‰ï¼Œä»¥packetä¸ºå•ä½åšæ ¡éªŒ </p></li><li><p>clientä»¥packetä¸ºå•ä½æŽ¥å—ï¼Œåœ¨æœ¬åœ°ç¼“å­˜ï¼Œç„¶åŽå†™å…¥ç›®æ ‡æ–‡ä»¶ï¼ˆèŽ·å–æ‰€æœ‰çš„æ–‡ä»¶å¿«åŽè¿›è¡Œåˆå¹¶ï¼‰ </p></li></ul><p><img src="/post/515d/2.png" alt></p><h2 id="hdfså†™æ•°æ®æµç¨‹"><a href="#hdfså†™æ•°æ®æµç¨‹" class="headerlink" title="hdfså†™æ•°æ®æµç¨‹"></a>hdfså†™æ•°æ®æµç¨‹</h2><ul><li><p>clientå’Œnamenodeé€šä¿¡å¹¶è¯·æ±‚ä¸Šä¼ æ–‡ä»¶ï¼Œnamenodeæ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨ </p></li><li><p>namenodeè¿”å›žç»™clientæ˜¯å¦å¯ä»¥ä¸Šä¼  </p></li><li><p>clientè¯·æ±‚ç¬¬ä¸€ä¸ªblockè¯¥ä¼ è¾“åˆ°å“ªäº›datanodeï¼ˆå› ä¸ºåŒ…å«å‰¯æœ¬ï¼‰ </p></li><li><p>namenodeè¿”å›žæ‰€éœ€è¦ä¸Šä¼ çš„datanode serverï¼ˆæ•°é‡å–å†³äºŽå‰¯æœ¬çš„æ•°é‡ï¼‰ï¼Œå‡è®¾è¿”å›žA B Cä¸‰å°server </p></li><li><p>clientå’Œdatanode Aå»ºç«‹pipelineï¼ˆæœ¬è´¨æ˜¯RPCè°ƒç”¨ï¼‰ï¼ŒAæ”¶åˆ°è¯·æ±‚åŽè°ƒç”¨Bå»ºç«‹pipelineï¼ŒBæ”¶åˆ°è¯·æ±‚åŽå’ŒCå»ºç«‹pipelineï¼Œç„¶åŽé€çº§è¿”å›žclient </p></li><li><p>clientå¼€å§‹ç»™Aä¸Šä¼ æ–‡ä»¶å—ï¼Œä»¥packetä¸ºå•ä½ï¼ŒAæ”¶åˆ°ä¹‹åŽä¼ ç»™Bï¼ŒBæ”¶åˆ°ä¹‹åŽä¼ ç»™C </p></li><li><p>å½“ä¸€ä¸ªæ–‡ä»¶å—ä¸Šä¼ å®Œæˆä¹‹åŽï¼Œclientå†æ¬¡è¯·æ±‚namenodeä¸Šä¼ ä¸‹ä¸€ä¸ªæ–‡ä»¶å— </p></li><li><p><img src="/post/515d/3.png" alt></p></li></ul><h1 id="hdfs-namenode-å·¥ä½œåŽŸç†"><a href="#hdfs-namenode-å·¥ä½œåŽŸç†" class="headerlink" title="hdfs namenode å·¥ä½œåŽŸç†"></a>hdfs namenode å·¥ä½œåŽŸç†</h1><p>namenodeè´Ÿè´£ï¼šå“åº”clientè¯·æ±‚ï¼Œç»´æŠ¤è·¯å¾„æ ‘ï¼Œç®¡ç†å…ƒæ•°æ®ï¼ˆæŸ¥è¯¢ï¼Œä¿®æ”¹ï¼‰ </p><h2 id="hdfså…ƒæ•°æ®ç®¡ç†æœºåˆ¶"><a href="#hdfså…ƒæ•°æ®ç®¡ç†æœºåˆ¶" class="headerlink" title="hdfså…ƒæ•°æ®ç®¡ç†æœºåˆ¶"></a>hdfså…ƒæ•°æ®ç®¡ç†æœºåˆ¶</h2><ul><li><p>å†…å­˜ä¸­æœ‰ä¸€ä»½å®Œæ•´çš„å…ƒæ•°æ®ï¼ˆç‰¹å®šçš„æ•°æ®ç»“æž„ï¼‰ </p></li><li><p>ç£ç›˜ä¸­æœ‰ä¸€ä¸ªå‡†å®Œæ•´çš„å…ƒæ•°æ®çš„é•œåƒæ–‡ä»¶ </p></li><li><p>å½“clientå¯¹hdfsä¸­çš„æ–‡ä»¶æ–°å¢žæˆ–è€…ä¿®æ”¹çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šåœ¨editsæ–‡ä»¶ä¸­è®°å½•æ“ä½œæ—¥å¿—ï¼Œå½“clientæ“ä½œæˆåŠŸä¹‹åŽï¼Œç›¸åº”çš„å…ƒæ•°æ®ä¼šæ›´æ–°åˆ°å†…å­˜ä¸­ã€‚æ¯éš”ä¸€æ®µæ—¶é—´ä¼šæœ‰secondary namenodeå°†namenodeä¸Šç§¯ç´¯çš„æ‰€æœ‰editså’Œä¸€ä¸ªæœ€æ–°çš„å…ƒæ•°æ®é•œåƒä¸‹è½½åˆ°æœ¬åœ°ï¼Œå¹¶åŠ è½½åˆ°å†…å­˜ä¸­è¿›è¡Œåˆå¹¶ï¼ˆè¿™ä¸ªè¿‡ç¨‹è¢«ç§°ä¸ºcheckpointï¼‰ </p></li></ul><p><img src="/post/515d/4.png" alt></p><h1 id="MapReduce-åŽŸç†"><a href="#MapReduce-åŽŸç†" class="headerlink" title="MapReduce åŽŸç†"></a>MapReduce åŽŸç†</h1><p><img src="/post/515d/5.png" alt></p><p>åœ¨mapçš„æ—¶å€™ä¼šå¯¹åŒä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå¤„ç†ï¼Œæ¯ä¸€ä¸ªmserveré‡Œé¢çš„mapä¼šè®¿é—®ä¸åŒçš„éƒ¨åˆ†ï¼Œç„¶åŽå¯¹æ–‡æœ¬æ•°æ®è¿›è¡Œå¤„ç†ï¼Œä¸”mapè¿‡ç¨‹è¾“å‡ºçš„æ ¼å¼æ˜¯key valueçš„å½¢å¼ã€‚<br>åœ¨map taskæ‰§è¡Œå®Œä¹‹åŽä¼šæŠŠæ•°æ®ä¼ åˆ°shuffleé‡Œé¢ï¼Œç„¶åŽshuffleä¼ é€’ç»™reduce taskã€‚reduceä¼šæ‹‰å–åœ¨mapé‡Œé¢å¤„ç†è¿‡çš„æ•°æ®ï¼Œå¯¹key valueè¿›è¡Œæ•´åˆï¼ˆç±»ä¼¼dbé‡Œé¢çš„group byæ“ä½œï¼‰ã€‚ </p><h1 id="shuffleåŽŸç†"><a href="#shuffleåŽŸç†" class="headerlink" title="shuffleåŽŸç†"></a>shuffleåŽŸç†</h1><p>shuffleæ˜¯mapå’Œreduceä¸­é—´çš„æ•°æ®è°ƒåº¦æœºåˆ¶ï¼Œä¸»è¦åŒ…å«ç¼“å­˜ï¼Œåˆ†åŒºï¼ŒæŽ’åº </p><p>åœ¨map taské‡Œé¢æœ‰ä¸€ä¸ªç¼“å†²åŒºï¼ŒæŠŠå¤„ç†è¿‡çš„key-valueæ•°æ®æ”¾åˆ°ç¼“å­˜é‡Œé¢ï¼Œä½†æ˜¯ç”±äºŽç¼“å­˜æœ‰é™ï¼Œæ‰€ä»¥å½“ç¼“å†²åŒºä½¿ç”¨è¾¾åˆ°ä¸€å®šé™åˆ¶åŽï¼ˆ80%ï¼‰ï¼Œsplit threadï¼ˆä¸€ä¸ªçº¿ç¨‹ï¼Œå½’map taskç®¡ï¼‰ä¼šæŠŠç¼“å†²åŒºçš„æ•°æ®å†™å…¥åˆ°ç£ç›˜ï¼Œsplitåœ¨å¤„ç†ç¼“å†²æ•°æ®çš„æ—¶å€™ä¼šå¯¹æ•°æ®è¿›è¡ŒæŽ’åºå’Œåˆ†åŒºï¼Œé»˜è®¤æ˜¯hash partitionè¿›è¡Œåˆ†åŒºï¼Œæ ¹æ®keyçš„å€¼hashåˆ†åŒºã€‚æ¯splitä¸€æ¬¡ä¼šå†™å…¥åˆ°ç£ç›˜çš„ä¸€ä¸ªæ–°çš„æ–‡ä»¶ï¼ˆsort and partitionï¼‰ã€‚åœ¨mapå®Œæ‰€æœ‰çš„æ•°æ®ä¹‹åŽï¼Œå¯¹æ‰€æœ‰æº¢å‡ºæ–‡ä»¶è¿›è¡Œåˆå¹¶å’ŒæŽ’åºï¼Œåœ¨åˆå¹¶çš„æ—¶å€™å¯¹æ¯ä¸ªåˆ†åŒºçš„æ•°æ®è¿›è¡Œåˆå¹¶ã€‚ </p><p><img src="/post/515d/6.png" alt></p><p>åœ¨reduceé˜¶æ®µï¼Œæ‹‰å–æ‰€æœ‰map tasksçš„æœ€ç»ˆç»“æžœï¼Œå¹¶å¯¹è¿™äº›æ•°æ®åšæŽ’åºã€‚</p><p><img src="/post/515d/7.png" alt></p><p>Reduce functionä¼šæ‹¿åˆ°æ ¹æ®keyèšåˆæ•°æ®ï¼Œæ¯ä¸ªèšåˆç»„è°ƒç”¨ä¸€æ¬¡reduceæ–¹æ³•ã€‚ä¼šæœ‰å¤šä¸ªreduce taskåŒæ—¶è¿è¡Œã€‚ </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;HDFSçš„åŽŸç†ä»¥åŠHadoopçš„å®‰è£…ï¼ŒMapReduceçš„è¿è¡Œæµç¨‹ï¼Œshuffleçš„è¿è¡Œæœºåˆ¶ã€‚&lt;/p&gt;
&lt;h1 id=&quot;hdfs-åŠŸèƒ½&quot;&gt;&lt;a href=&quot;#hdfs-åŠŸèƒ½&quot; class=&quot;headerlink&quot; title=&quot;hdfs åŠŸèƒ½&quot;&gt;&lt;/a&gt;hdfs åŠŸèƒ½&lt;/h
      
    
    </summary>
    
    
    
      <category term="Distributed" scheme="https://shunyangli.github.io/tags/Distributed/"/>
    
  </entry>
  
  <entry>
    <title>bipartite graph data pre-processing</title>
    <link href="https://shunyangli.github.io/post/3fe5/"/>
    <id>https://shunyangli.github.io/post/3fe5/</id>
    <published>2021-07-28T10:16:59.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>The initialized downloaded data is messy and the graph id is not continuous, so a data preprocessing method is written to allow the data to be loaded into memory faster. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line"></span><br><span class="line">filepath = os.getcwd() + <span class="string">"/"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_files</span><span class="params">(filename: str, sep: str, skip: int)</span>:</span></span><br><span class="line">    data = []</span><br><span class="line">    filename = filepath + filename[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">with</span> open(filename, <span class="string">'r'</span>) <span class="keyword">as</span> lines:</span><br><span class="line">        lines = list(lines)</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> lines[skip:]:</span><br><span class="line">            nodes = line.split(sep)</span><br><span class="line">            temp = [int(nodes[<span class="number">0</span>]), int(nodes[<span class="number">1</span>])]</span><br><span class="line">            <span class="keyword">for</span> val <span class="keyword">in</span> nodes[<span class="number">2</span>:]:</span><br><span class="line">                temp.append(val)</span><br><span class="line">            data.append(temp)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">return</span> data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse_data</span><span class="params">(data)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    encoding the data</span></span><br><span class="line"><span class="string">    :param data:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    u_node = &#123;&#125;</span><br><span class="line">    u_id = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    v_node = &#123;&#125;</span><br><span class="line">    v_id = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> data:</span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">0</span>] <span class="keyword">not</span> <span class="keyword">in</span> u_node:</span><br><span class="line">            u_node[line[<span class="number">0</span>]] = u_id</span><br><span class="line">            u_id += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> line[<span class="number">1</span>] <span class="keyword">not</span> <span class="keyword">in</span> v_node:</span><br><span class="line">            v_node[line[<span class="number">1</span>]] = v_id</span><br><span class="line">            v_id += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    nodes = <span class="string">""</span></span><br><span class="line">    edges = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> data:</span><br><span class="line">        nodes += <span class="string">"&#123;&#125; &#123;&#125;"</span>.format(u_node[line[<span class="number">0</span>]], v_node[line[<span class="number">1</span>]])</span><br><span class="line">        nodes += <span class="string">" "</span>.join(line[<span class="number">2</span>:])</span><br><span class="line">        nodes += <span class="string">"\n"</span></span><br><span class="line">        edges += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> u_id, v_id, edges, nodes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">store_file</span><span class="params">(filename, data)</span>:</span></span><br><span class="line">    meta = filepath + filename + <span class="string">'.meta'</span></span><br><span class="line">    edge = filepath + filename + <span class="string">'.e'</span></span><br><span class="line"></span><br><span class="line">    f = open(edge, <span class="string">'w'</span>)</span><br><span class="line">    f.write(data[<span class="number">3</span>])</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line">    lines = <span class="string">"&#123;&#125;\n&#123;&#125;\n&#123;&#125;\n"</span>.format(data[<span class="number">0</span>], data[<span class="number">1</span>], data[<span class="number">2</span>])</span><br><span class="line">    f = open(meta, <span class="string">'w'</span>)</span><br><span class="line">    f.write(lines)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">execute</span><span class="params">(args)</span>:</span></span><br><span class="line">    filename = args.filename</span><br><span class="line">    sep = args.sep</span><br><span class="line">    outfile = args.out</span><br><span class="line">    skip = args.skip</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> outfile <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        outfile = str(filename).split(<span class="string">'.'</span>)[<span class="number">1</span>][:<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    data = read_files(filename, sep, int(skip))</span><br><span class="line">    parsed_data = parse_data(data)</span><br><span class="line">    store_file(outfile, parsed_data)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    parser = argparse.ArgumentParser(description=<span class="string">'Processing csv data'</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--filename'</span>, help=<span class="string">'Please add file name'</span>, required=<span class="literal">True</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--sep'</span>, help=<span class="string">'Separator'</span>, default=<span class="string">' '</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--out'</span>, help=<span class="string">'output file name'</span>, default=<span class="literal">None</span>)</span><br><span class="line">    parser.add_argument(<span class="string">'--skip'</span>, help=<span class="string">'how many lines need to be skiped'</span>, default=<span class="number">1</span>)</span><br><span class="line">    args = parser.parse_args()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"Start processing: "</span>, args.filename)</span><br><span class="line">    execute(args)</span><br><span class="line">    print(<span class="string">"Finished"</span>)</span><br></pre></td></tr></table></figure><h1 id="How-to-use-it"><a href="#How-to-use-it" class="headerlink" title="How to use it"></a>How to use it</h1><p>You can get help information by using <code>--help</code>.</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">usage: data.py [-h] --filename FILENAME [--sep SEP] [--out OUT] [--skip SKIP]</span><br><span class="line"></span><br><span class="line">Processing csv data</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  -h, --help           show this help message and exit</span><br><span class="line">  --filename FILENAME  Please add file name</span><br><span class="line">  --sep SEP            Separator</span><br><span class="line">  --out OUT            output file name</span><br><span class="line">  --skip SKIP          how many lines need to be skipedã€</span><br></pre></td></tr></table></figure><p><code>--sep</code> default value is a space, <code>--skip</code> default value is 1.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;The initialized downloaded data is messy and the graph id is not continuous, so a data preprocessing method is written to allow the data 
      
    
    </summary>
    
    
      <category term="Data processing" scheme="https://shunyangli.github.io/categories/Data-processing/"/>
    
    
      <category term="Data processing" scheme="https://shunyangli.github.io/tags/Data-processing/"/>
    
  </entry>
  
  <entry>
    <title>Union-Find Set</title>
    <link href="https://shunyangli.github.io/post/14e7/"/>
    <id>https://shunyangli.github.io/post/14e7/</id>
    <published>2021-05-25T03:45:50.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>In computer science, a disjoint-set data structure is a data structure used to handle the merging and querying of disjoint sets (a series of sets with no duplicate elements).</p><h1 id="Structure"><a href="#Structure" class="headerlink" title="Structure"></a>Structure</h1><p>A non-intersecting forest represents each set as a tree (deepth with 1), where each node is an element. A node holds a reference to its parent node, and the root node of the tree holds an empty reference or a reference to itself or some other invalid value to indicate itself as the root node. This data structure was first proposed by Bernard A. Galler and Michael J. Fischer in 1964,but it took several years before a precise analysis was completed. As shown:<br><img src="/post/14e7/1.png" alt></p><h1 id="New-Approach"><a href="#New-Approach" class="headerlink" title="New Approach"></a>New Approach</h1><p>There are many different types of variations of this data structure that we can change to suit different needs. I used two HashMap to store the roots and parent (<code>parent</code> and <code>roots</code>). For <code>parent</code>, it stores the roots of every element, for <code>roots</code>, it stores the root of all the elements.<br><code>parent</code> can be seen as <code>{node: root}</code>, <code>roots</code> can be seen as <code>{root: [node1, node2, ...]}</code>.</p><h2 id="Search"><a href="#Search" class="headerlink" title="Search"></a>Search</h2><p>In my method, I use Hashmap to store the tree. So, the search complexity is $O(n)$.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> parent[x]</span><br></pre></td></tr></table></figure><h2 id="Union"><a href="#Union" class="headerlink" title="Union"></a>Union</h2><p>For union, we need to set the root of such element to be a new root. And merge the childs of such root.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">union</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    rootX = parent[x]</span><br><span class="line">    rootY = parent[y]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> rootX == rootY:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    parent[y] = rootX</span><br><span class="line">    roots[rootX] += roots[y]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> n <span class="keyword">in</span> roots[y]:</span><br><span class="line">        parent[n] = rootX</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">del</span> roots[y]</span><br></pre></td></tr></table></figure><h1 id="Application"><a href="#Application" class="headerlink" title="Application"></a>Application</h1><p>It can be used for subgraph pattern matching decompistion, bipartite graph and commuity.</p><h1 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UF</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :param parent &#123;node: root&#125;</span></span><br><span class="line"><span class="string">        :param roots: &#123;root: [n1,n2..]&#125;</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.parent = &#123;&#125;</span><br><span class="line">        self.roots = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init</span><span class="params">(self, n)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, n):</span><br><span class="line">            self.parent[i] = i</span><br><span class="line">            self.roots[i] = [i]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">union</span><span class="params">(self, p, q)</span>:</span></span><br><span class="line">        rootP = self.parent[p]</span><br><span class="line">        rootQ = self.parent[q]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> rootP == rootQ:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        self.parent[q] = rootP</span><br><span class="line">        self.roots[rootP] += self.roots[q]</span><br><span class="line">        <span class="keyword">del</span> self.roots[q]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">find</span><span class="params">(self, x)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        to find x parent</span></span><br><span class="line"><span class="string">        :param x:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">if</span> x <span class="keyword">in</span> self.parent:</span><br><span class="line">            <span class="keyword">return</span> self.parent[x]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">isConnect</span><span class="params">(self, p, q)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        check whether two val has same root</span></span><br><span class="line"><span class="string">        :param p:</span></span><br><span class="line"><span class="string">        :param q:</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        rootP = self.find(p)</span><br><span class="line">        rootQ = self.find(q)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> rootP == rootQ</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getRoots</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.roots.keys()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getRecords</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.roots</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    uf = UF()</span><br><span class="line">    uf.init(<span class="number">10</span>)</span><br><span class="line">    uf.union(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">    uf.union(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">    uf.union(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    uf.union(<span class="number">5</span>, <span class="number">6</span>)</span><br><span class="line">    uf.union(<span class="number">4</span>, <span class="number">5</span>)</span><br><span class="line">    x = uf.find(<span class="number">3</span>)</span><br><span class="line"></span><br><span class="line">    print(x)</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;In computer science, a disjoint-set data structure is a data structure used to handle the merging and querying of disjoint sets (a series
      
    
    </summary>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/categories/Algorithm/"/>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Prime Number</title>
    <link href="https://shunyangli.github.io/post/4d31/"/>
    <id>https://shunyangli.github.io/post/4d31/</id>
    <published>2021-04-25T05:18:45.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>In math, prime numbers are whole numbers greater than 1, that have only two factors â€“ 1 and the number itself. Prime numbers are divisible only by the number 1 or itself. For example, 2, 3, 5, 7 and 11 are the first few prime numbers.</p><h1 id="Brute-Force"><a href="#Brute-Force" class="headerlink" title="Brute Force"></a>Brute Force</h1><p>For this solution we can use two loops to handle. For example, we want to find all the prime number between 2 and 100, then we can write code like this:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">num = <span class="number">100</span></span><br><span class="line">primes = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, num):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>, i):</span><br><span class="line">        <span class="keyword">if</span> i % j == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        primes.append(i)</span><br></pre></td></tr></table></figure><p>The time complexity is $O(n\sqrt{n})$. But when the number is huge, then it is very slow. There is a small optimization in the method. </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">num = <span class="number">100</span></span><br><span class="line">primes = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, num):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">2</span>, i // <span class="number">2</span> + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> i % j == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        primes.append(i)</span><br></pre></td></tr></table></figure><h1 id="Ehrlich-Sieve-Algorithm"><a href="#Ehrlich-Sieve-Algorithm" class="headerlink" title="Ehrlich Sieve Algorithm"></a>Ehrlich Sieve Algorithm</h1><p>The algorithm enumerates all the numbers from small to large, and for each prime number, it sifts all its multiples, and the rest is the prime number. The time complexity is $O(loglog(n))$.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">primes = []</span><br><span class="line">is_prime = [<span class="literal">True</span>] * (num + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>, num):</span><br><span class="line">    <span class="keyword">if</span> is_prime[i]:</span><br><span class="line">        primes.append(i)</span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> range(<span class="number">1</span>, num // i + <span class="number">1</span>):</span><br><span class="line">            is_prime[i * m] = <span class="literal">False</span></span><br></pre></td></tr></table></figure><h1 id="Performance-Evaluation"><a href="#Performance-Evaluation" class="headerlink" title="Performance Evaluation"></a>Performance Evaluation</h1><p>We set the value of <code>num</code> to <code>[10000, 50000, 100000, 200000]</code>. For Brute Force (BF) we used its optimization algorithm. For Ehrlich Sieve (ES) we do not change anything.</p><p><img src="/post/4d31/1.png" alt></p><p>We can see that as the number increases the time consumed by BF is higher. For all the test, the time cost of ES algorithm no more than one seconds.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;In math, prime numbers are whole numbers greater than 1, that have only two factors â€“ 1 and the number itself. Prime numbers are divisibl
      
    
    </summary>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/categories/Algorithm/"/>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>A* Search Algorithm</title>
    <link href="https://shunyangli.github.io/post/44e7/"/>
    <id>https://shunyangli.github.io/post/44e7/</id>
    <published>2021-04-21T04:06:33.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>A* search algorithm is a heuristic search which works on path planning and graph traversal (weighted).<br>It is an extension of <a href="https://shunyangli.github.io/2020/05/03/Algorithm/">Dijkstra</a> algorithm. The formula of Dijkstra is $f(n)=g(n)$, and the formula of A* is $f(n)=g(n) + h(n)$, where $g(n)$ is the cost from start to current node and $h(n)$ is the estimated cost from source node to target node. Manhattan distance or Euclidean distance is usually used to estimate. A* algorithm is better than Dijkstra when $h(n)$ is admissible (never overstimates). The time complexity is $O(|E|log|V|)$ and space complexity is $O(|v|)$. The worst case is same with Dijkstra. </p><h1 id="Pseudocode"><a href="#Pseudocode" class="headerlink" title="Pseudocode"></a>Pseudocode</h1>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;A* search algorithm is a heuristic search which works on path planning and graph traversal (weighted).&lt;br&gt;It is an extension of &lt;a href=&quot;
      
    
    </summary>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/categories/Algorithm/"/>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Bidirectional BFS</title>
    <link href="https://shunyangli.github.io/post/c0bf/"/>
    <id>https://shunyangli.github.io/post/c0bf/</id>
    <published>2021-04-15T13:25:01.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>Bidirectional BFS is applicable to the case where the target node is known; the initial node expands toward the target node and the target node expands toward the initial node at the same time, until the same node appears in both expansion directions, and the search ends. For example, in a maze, when we need to know the number of steps to reach each location, a normal BFS is sufficient, but if we only need to know the number of steps to reach a specific location, we should use a two-way BFS. Start BFS from two target points at the same time, so we will have two different queues. Update the smaller one each time until there are elements in the two queues that overlap, indicating that the path is found. For example in the following graph, it will stop at node 9.</p><p><img src="/post/c0bf/1.png" alt></p><h1 id="Time-Complexity"><a href="#Time-Complexity" class="headerlink" title="Time Complexity"></a>Time Complexity</h1><p>Suppose if the branching factor of the tree is b and the distance between the target vertex and the source is d, then the normal BFS search complexity will be $O(b^d)$. On the other hand, if we perform two search operations, the complexity of each search will be $O(b^{d/2})$ and the total complexity will be $O(b^{d/2} + b^{d/2})$, which is much less than $O(b^d)$.</p><p>The branch factor refers to the number of children of each node in the expanded tree, i.e., the number of new elements that can be reached by each element. For example, in a maze where you can only move up and down, the branch factor is 4.</p><h1 id="Word-Ladder"><a href="#Word-Ladder" class="headerlink" title="Word Ladder"></a>Word Ladder</h1><p><a href="https://leetcode.com/problems/word-ladder" target="_blank" rel="noopener">Word Ladder</a> is a hard level question. It can be solved by using BFS. However BFS will time out. We can use Bidirectional to solve this issue.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span> &#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&gt; findLadders(<span class="built_in">string</span> from, <span class="built_in">string</span> to, <span class="built_in">vector</span>&lt;<span class="built_in">string</span>&gt;&amp; wordList) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">unordered_set</span>&lt;<span class="built_in">string</span>&gt; lexicon(wordList.begin(), wordList.end());</span><br><span class="line">        <span class="keyword">auto</span> result = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&gt;&#123;&#125;;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// check whether exist to, if not just return a empty</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">not</span> lexicon.count(to)) &#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// init a word maps for double bfs</span></span><br><span class="line">        <span class="keyword">auto</span> word_maps = <span class="built_in">unordered_map</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&gt;&#123;&#125;;</span><br><span class="line">        <span class="comment">// the left vector</span></span><br><span class="line">        <span class="keyword">auto</span> left = <span class="built_in">unordered_set</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;from&#125;;</span><br><span class="line">        <span class="comment">// the right vector</span></span><br><span class="line">        <span class="keyword">auto</span> right = <span class="built_in">unordered_set</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;to&#125;;</span><br><span class="line">        <span class="comment">// contain all the visited elements</span></span><br><span class="line">        <span class="keyword">auto</span> visited = <span class="built_in">unordered_set</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// the bfs direction, could start at from and start at end</span></span><br><span class="line">        <span class="comment">// true means start at from</span></span><br><span class="line">        <span class="comment">// false means start at end</span></span><br><span class="line">        <span class="comment">// this is helpful for store the word into hashmap</span></span><br><span class="line">        <span class="keyword">auto</span> ahead = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">auto</span> found = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// which contain all the words</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">not</span> left.empty() <span class="keyword">and</span> <span class="keyword">not</span> right.empty()) &#123;</span><br><span class="line">            <span class="comment">// change the position when left &gt; right</span></span><br><span class="line">            <span class="comment">// part of two end bfs algorithm</span></span><br><span class="line">            <span class="keyword">if</span> (left.size() &gt; right.size()) &#123;</span><br><span class="line">                <span class="built_in">std</span>::swap(left, right);</span><br><span class="line">                ahead = <span class="keyword">not</span> ahead;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// contain all the words which generate according to left set words</span></span><br><span class="line">            <span class="comment">// which like insert to queue in bfs</span></span><br><span class="line">            <span class="keyword">auto</span> <span class="built_in">queue</span> = <span class="built_in">unordered_set</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// insert all the left set into visited</span></span><br><span class="line">            visited.insert(left.begin(), left.end());</span><br><span class="line"></span><br><span class="line">            <span class="comment">// loop all the element in the left</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> origin_word : left) &#123;</span><br><span class="line">                <span class="keyword">auto</span> neighbors = neighbor(origin_word, visited, lexicon);</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; word : neighbors) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (<span class="built_in">std</span>::find(right.begin(), right.end(), word) != right.end()) &#123;</span><br><span class="line">                        found = <span class="literal">true</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (ahead) &#123;</span><br><span class="line">                        word_maps[word].push_back(origin_word);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> &#123;</span><br><span class="line">                        word_maps[origin_word].push_back(word);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="built_in">queue</span>.insert(word);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// put the new path to left then do new iterator</span></span><br><span class="line">            left = <span class="built_in">queue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// if found the to word, then generate the word ladders</span></span><br><span class="line">            <span class="keyword">if</span> (found) &#123;</span><br><span class="line">                result.push_back(<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;to&#125;);</span><br><span class="line">                <span class="comment">// the first one should be from</span></span><br><span class="line">                <span class="keyword">while</span> (result[<span class="number">0</span>][<span class="number">0</span>] != from) &#123;</span><br><span class="line">                    result = generate_result(result, word_maps);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// std::sort(result.begin(), result.end());</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * generate the neighbor words according to the word</span></span><br><span class="line"><span class="comment">     * to change the char from a-z</span></span><br><span class="line"><span class="comment">     * @param word the currecnt word to generate neighor words</span></span><br><span class="line"><span class="comment">     * @param visited the visited word</span></span><br><span class="line"><span class="comment">     * @param lexicon all the words</span></span><br><span class="line"><span class="comment">     * @return the neighors of the word</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">auto</span> <span class="title">neighbor</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">string</span>&amp; word,</span></span></span><br><span class="line"><span class="function"><span class="params">                  <span class="keyword">const</span> <span class="built_in">unordered_set</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&amp; visited,</span></span></span><br><span class="line">                  const unordered_set&lt;std::string&gt;&amp; lexicon) -&gt; unordered_set&lt;std::string&gt; &#123;</span><br><span class="line">        <span class="comment">// contains all the neighbor words</span></span><br><span class="line">        <span class="keyword">auto</span> words = <span class="built_in">unordered_set</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;::size_type&#123;<span class="number">0</span>&#125;; i &lt; word.size(); i++) &#123;</span><br><span class="line">            <span class="comment">// because we does n</span></span><br><span class="line">            <span class="comment">// ot want to change the current word</span></span><br><span class="line">            <span class="comment">// so we use curr_char to store the char which will be replaced</span></span><br><span class="line">            <span class="keyword">char</span> curr_char = word[i];</span><br><span class="line">            <span class="comment">// change the curr with a-z and check whether visited and whether in lexicon</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> c = <span class="string">'a'</span>; c &lt;= <span class="string">'z'</span>; ++c) &#123;</span><br><span class="line">                word[i] = c;</span><br><span class="line">                <span class="comment">// to avoid same word</span></span><br><span class="line">                <span class="keyword">if</span> (curr_char == c) &#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// the word should not visited and should in lexicon</span></span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">not</span> visited.count(word) </span><br><span class="line">                   <span class="keyword">and</span> lexicon.count(word)) &#123;</span><br><span class="line">                    words.insert(word);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            word[i] = curr_char;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> words;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * iterate the result according to the end word</span></span><br><span class="line"><span class="comment">     * it can be a recurrsion, but I do not want to do that</span></span><br><span class="line"><span class="comment">     * recurrsion not stable.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * In the hashmap the word stored as: end-&gt;&#123;w1, w2, w2&#125;</span></span><br><span class="line"><span class="comment">     * this means w1, w2, w3 can convert to end, similar idea for start</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * @param words is the result which contain as list</span></span><br><span class="line"><span class="comment">     * @param word_maps hashmap, key is word, values is word ladders</span></span><br><span class="line"><span class="comment">     * @return a new list of result and then loop again</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">auto</span> <span class="title">generate_result</span><span class="params">(<span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&gt;&amp; words,</span></span></span><br><span class="line"><span class="function"><span class="params">                         <span class="keyword">const</span> <span class="built_in">std</span>::<span class="built_in">unordered_map</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>, <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&gt;&amp; word_maps)</span></span></span><br><span class="line">       -&gt; std::vector&lt;std::vector&lt;std::string&gt;&gt; &#123;</span><br><span class="line">        <span class="keyword">auto</span> temp = <span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">vector</span>&lt;<span class="built_in">std</span>::<span class="built_in">string</span>&gt;&gt;&#123;&#125;;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// the word_maps were stored as a hashmap</span></span><br><span class="line">        <span class="comment">// key is the word, value is the word ladders</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; word_list : words) &#123;</span><br><span class="line">            <span class="keyword">auto</span> t = word_list[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// get the related word from hashmap</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; word : word_maps[t]) &#123;</span><br><span class="line">                <span class="comment">// insert the value in the front of list</span></span><br><span class="line">                <span class="keyword">auto</span> w = word_list;</span><br><span class="line">                w.insert(w.begin(), word);</span><br><span class="line">                temp.push_back(w);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> temp;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>This problem is also the first assignment of <a href="https://webcms3.cse.unsw.edu.au/COMP6771/20T2/" target="_blank" rel="noopener">COMP6771</a> in 20T2.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Bidirectional BFS is applicable to the case where the target node is known; the initial node expands toward the target node and the targe
      
    
    </summary>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/categories/Algorithm/"/>
    
    
      <category term="Algorithm" scheme="https://shunyangli.github.io/tags/Algorithm/"/>
    
  </entry>
  
  <entry>
    <title>Automatically generate gitignore</title>
    <link href="https://shunyangli.github.io/post/c26f/"/>
    <id>https://shunyangli.github.io/post/c26f/</id>
    <published>2021-04-15T11:25:59.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>We use <a href="https://github.com/" target="_blank" rel="noopener">Git</a> a lot when working on projects, but not all of the files we need to put into github, such as datasets, virtual environments, and configuration files. So we need to configure .gitignore to automatically ignore these files that donâ€™t need to be added to the Git admin. Configuring .gitignore is usually tedious because you need to add all the uncessary files.</p><p><a href="https://github.com/Antrikshy/ignr.py" target="_blank" rel="noopener">ignr</a> is a tool which can generate .gitignore files automatically. It is implmeneted by Python.</p><h1 id="Install"><a href="#Install" class="headerlink" title="Install"></a>Install</h1><p>If you already installed python and pip, then you can execute the following command:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install ignr</span><br></pre></td></tr></table></figure><h1 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h1><p>The <a href="https://github.com/Antrikshy/ignr.py" target="_blank" rel="noopener">ignr</a> supports over four hundred different .gitignore templates, which we can view with the<code>ignr -l</code>command or search for with the <code>ignr -s</code>  command. For example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ignr -s python</span><br></pre></td></tr></table></figure><p>Searches for supplied query in list of available templates from gitignore.io.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ignr -n python</span><br></pre></td></tr></table></figure><p>It will generate pythonâ€™s project gitignore file in the currect directory.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;We use &lt;a href=&quot;https://github.com/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Git&lt;/a&gt; a lot when working on projects, but not all of the files we n
      
    
    </summary>
    
    
      <category term="git" scheme="https://shunyangli.github.io/categories/git/"/>
    
    
      <category term="git" scheme="https://shunyangli.github.io/tags/git/"/>
    
  </entry>
  
  <entry>
    <title>Mail activation</title>
    <link href="https://shunyangli.github.io/post/9b8a/"/>
    <id>https://shunyangli.github.io/post/9b8a/</id>
    <published>2020-07-04T05:36:33.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<p>æœ¬æ–‡ä¼šæ•™å¤§å®¶æ€Žä¹ˆåšé‚®ç®±éªŒè¯ï¼Œä»¥åŠæ€Žä¹ˆå‘é€å¥½çœ‹ä¸€ç‚¹çš„é‚®ç®±çš„HTMLæ¨¡æ¿ã€‚å¾ˆä¹…æ²¡å†™è¿‡æœ‰ç”¨çš„æ•™ç¨‹ï¼Œæœ¬æ¥ä»Šå¤©æˆ‘åº”è¯¥åœ¨å¹²ç»æµŽï¼Œå®žåœ¨å†™ä¸ä¸‹åŽ»äº†ï¼Œæˆ‘è·‘æ¥å†™è¿™äº›äº†ã€‚(âŠ™ï¸¿âŠ™)å…³äºŽæ€Žä¹ˆä½¿ç”¨flaskå‘é€é‚®ä»¶ï¼Œæˆ‘åœ¨ä¹‹å‰çš„æ•™ç¨‹æœ‰è¯´çš„ã€‚<a href="https://shunyangli.github.io/2019/10/08/Flask-Mail/#more">ä¼ é€é—¨</a></p><p>æŠ€æœ¯ï¼š</p><ul><li>flask</li><li>html</li><li>css</li></ul><h1 id="HTML-Template"><a href="#HTML-Template" class="headerlink" title="HTML Template"></a>HTML Template</h1><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦çŸ¥é“flaskä½¿ç”¨çš„æ˜¯Jinja2çš„æ¨¡æ¿ã€‚</p><ol><li>éœ€è¦é¦–å…ˆè®¾è®¡ä¸€ä¸ªHTMLæ¥å±•ç¤ºä½ ç›¸å¯¹åº”çš„é‚®ç®±éªŒè¯çš„ç•Œé¢ã€‚æˆ‘å·²ç»æå‰åšå¥½äº†ä¸€ä¸ªï¼Œæ‰€æœ‰çš„æºä»£ç æˆ‘éƒ½æ”¾åˆ°æœ€åŽé¢äº†ï¼Œåˆ°æ—¶å€™å¤§å®¶å¯ä»¥ä¸‹è½½è·‘ä¸€ä¸‹çœ‹çœ‹ã€‚</li></ol><p><img src="/post/9b8a/1.png" alt></p><ol start="2"><li>è®¾ç½®ä¸€ä¸‹HTMLæ‰€éœ€è¦çš„å‚æ•°ï¼Œæ¿€æ´»æ‰€éœ€è¦çš„URLï¼Œç”¨æˆ·åç­‰ã€‚</li><li>å†™flaskéƒ¨åˆ†çš„ä»£ç </li></ol><p><strong>é¦–å…ˆåˆå§‹åŒ–flaskï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itsdangerous <span class="keyword">import</span> TimedJSONWebSignatureSerializer <span class="keyword">as</span> Serializer</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request, session</span><br><span class="line"><span class="keyword">from</span> flask_mail <span class="keyword">import</span> Mail, Message</span><br><span class="line"><span class="keyword">from</span> threading <span class="keyword">import</span> Thread</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line">app.config[<span class="string">'MAIL_SERVER'</span>] = <span class="string">'smtp.qq.com'</span></span><br><span class="line">app.config[<span class="string">'MAIL_PORT'</span>] = <span class="number">465</span></span><br><span class="line">app.config[<span class="string">'MAIL_USE_SSL'</span>] = <span class="literal">True</span></span><br><span class="line">app.config[<span class="string">'MAIL_USERNAME'</span>] = <span class="string">'xxxx'</span></span><br><span class="line">app.config[<span class="string">'MAIL_PASSWORD'</span>] = <span class="string">'xxxx'</span></span><br><span class="line">app.config[<span class="string">'MAIL_DEFAULT_SENDER'</span>] = <span class="string">'xxxx@qq.com'</span></span><br><span class="line"></span><br><span class="line">mail = Mail(app)</span><br></pre></td></tr></table></figure><p><strong>åˆå§‹åŒ–å‘é€é‚®ä»¶çš„function:</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># å¼‚æ­¥å‘é€function</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">async_send_mail</span><span class="params">(app, msg)</span>:</span></span><br><span class="line">    <span class="comment"># èŽ·å–å½“å‰ç¨‹åºçš„ä¸Šä¸‹æ–‡</span></span><br><span class="line">    <span class="keyword">with</span> app.app_context():</span><br><span class="line">        <span class="comment"># å‘é€é‚®ä»¶</span></span><br><span class="line">        mail.send(msg)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å‘é€å‡½æ•°, messageçš„é…ç½®å’Œä¸Šé¢è®²çš„ä¸€æ ·</span></span><br><span class="line"><span class="comment"># **kwargs æŒ‡ä¼ è¿›æ¥çš„å‚æ•°, å¯ä»¥ä¼ å¤šä¸ªå‚æ•°è¿›æ¥ã€‚eg: username = 'xxx', link = 'xxx.com'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">send_mail</span><span class="params">(to, subject, template, **kwargs)</span>:</span></span><br><span class="line">    msg = Message(subject, sender = <span class="string">'1479201404@qq.com'</span>, recipients=[to])</span><br><span class="line">    msg.html = render_template(template + <span class="string">'.html'</span>, **kwargs)</span><br><span class="line">    thr = Thread(target=async_send_mail, args=[app, msg])</span><br><span class="line">    thr.start()</span><br><span class="line">    <span class="comment"># è¿”å›žè°ƒç”¨çš„ç»“æžœ</span></span><br><span class="line">    <span class="keyword">return</span> thr</span><br></pre></td></tr></table></figure><p><strong>åˆå§‹åŒ–åŠ å¯†fucntionï¼š</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encryption</span><span class="params">(data, expires_in=<span class="number">3600</span>)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    åŠ å¯†json</span></span><br><span class="line"><span class="string">    :param data: éœ€è¦åŠ å¯†çš„æ•°æ®</span></span><br><span class="line"><span class="string">    :param expires_in: è¿‡æœŸæ—¶é—´</span></span><br><span class="line"><span class="string">    :return: è¿”å›žåŠ å¯†çš„str</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    s = Serializer(app.config[<span class="string">'SECRET_KEY'</span>], expires_in=expires_in)</span><br><span class="line">    <span class="keyword">return</span> s.dumps(data).decode(<span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryption</span><span class="params">(token)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    è§£å¯†tokenåˆ°jsonæ•°æ®</span></span><br><span class="line"><span class="string">    :param token: å¯†æ–‡</span></span><br><span class="line"><span class="string">    :return: è§£å¯†çš„æ•°æ®</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    s = Serializer(app.config[<span class="string">'SECRET_KEY'</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        data = s.loads(token)</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    <span class="keyword">except</span> SignatureExpired:</span><br><span class="line">        print(<span class="string">'Token expired'</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        print(<span class="string">'Unknown error'</span>)</span><br></pre></td></tr></table></figure><p><strong>æœ€åŽå¼€å§‹å†™flaskè·¯ç”±éƒ¨åˆ†çš„ä»£ç :</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route('/', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">"POST"</span>:</span><br><span class="line">        email = request.form.get(<span class="string">'email'</span>)</span><br><span class="line">        <span class="keyword">if</span> email <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            session[email] = email</span><br><span class="line">            token = encryption(email)</span><br><span class="line">            send_mail(email, <span class="string">'Activate you account'</span>, <span class="string">'activate'</span>, action_url=<span class="string">'127.0.0.1:5000/activate/&#123;&#125;'</span>.format(token))</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'&lt;h1&gt;success&lt;/h1&gt;'</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/activate/&lt;token&gt;', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span><span class="params">(token)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> token <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"False"</span></span><br><span class="line">    </span><br><span class="line">    email = decryption(token)</span><br><span class="line">    <span class="keyword">if</span> session.get(email) <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"False"</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="string">"True"</span></span><br></pre></td></tr></table></figure><p>ç»“æžœå¦‚ä¸‹:</p><p><img src="/post/9b8a/2.png" alt></p><p><img src="/post/9b8a/3.png" alt></p><p><img src="/post/9b8a/4.png" alt></p><p>å…·ä½“ä»£ç å¯ä»¥ä¸‹è½½æŸ¥çœ‹ï¼š<a href="./mail-activation.zip">ä¸‹è½½</a></p><p><strong>psï¼šéœ€è¦ä¿®æ”¹ç›¸å¯¹åº”çš„é‚®ç®±å’Œé‚®ç®±çš„é…ç½®</strong></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æœ¬æ–‡ä¼šæ•™å¤§å®¶æ€Žä¹ˆåšé‚®ç®±éªŒè¯ï¼Œä»¥åŠæ€Žä¹ˆå‘é€å¥½çœ‹ä¸€ç‚¹çš„é‚®ç®±çš„HTMLæ¨¡æ¿ã€‚å¾ˆä¹…æ²¡å†™è¿‡æœ‰ç”¨çš„æ•™ç¨‹ï¼Œæœ¬æ¥ä»Šå¤©æˆ‘åº”è¯¥åœ¨å¹²ç»æµŽï¼Œå®žåœ¨å†™ä¸ä¸‹åŽ»äº†ï¼Œæˆ‘è·‘æ¥å†™è¿™äº›äº†ã€‚(âŠ™ï¸¿âŠ™)å…³äºŽæ€Žä¹ˆä½¿ç”¨flaskå‘é€é‚®ä»¶ï¼Œæˆ‘åœ¨ä¹‹å‰çš„æ•™ç¨‹æœ‰è¯´çš„ã€‚&lt;a href=&quot;https://shunyangli.git
      
    
    </summary>
    
    
    
      <category term="api" scheme="https://shunyangli.github.io/tags/api/"/>
    
  </entry>
  
  <entry>
    <title>database</title>
    <link href="https://shunyangli.github.io/post/1c6b/"/>
    <id>https://shunyangli.github.io/post/1c6b/</id>
    <published>2020-07-03T03:47:42.000Z</published>
    <updated>2022-07-06T11:18:52.000Z</updated>
    
    <content type="html"><![CDATA[<p>åŒ…å«ä¸€äº›databaseå¸¸è§çš„é—®é¢˜ï¼ŒMySQLçš„ç´¢å¼•ï¼Œæ€Žä¹ˆä½¿ç”¨ç´¢å¼•ç­‰ç­‰ã€‚</p><h1 id="æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼"><a href="#æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼" class="headerlink" title="æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼"></a>æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼</h1><p>ç¬¬ä¸€èŒƒå¼ï¼šæ¯ä¸ªåˆ—éƒ½ä¸èƒ½å†æ‹†åˆ†</p><p>ç¬¬äºŒèŒƒå¼ï¼šåœ¨ç¬¬ä¸€èŒƒå¼çš„åŸºç¡€ä¸Šï¼Œéžä¸»é”®åˆ—å®Œå…¨ä¾èµ–äºŽä¸»é”®ï¼Œè€Œä¸èƒ½æ˜¯ä¾èµ–äºŽä¸»é”®çš„ä¸€éƒ¨åˆ†</p><p>ç¬¬ä¸‰èŒƒå¼ï¼šåœ¨ç¬¬äºŒèŒƒå¼çš„åŸºç¡€ä¸Šï¼Œéžä¸»é”®åˆ—åªä¾èµ–äºŽä¸»é”®ï¼Œä¸ä¾èµ–äºŽå…¶ä»–éžä¸»é”®ã€‚</p><h1 id="å¼•æ“Ž"><a href="#å¼•æ“Ž" class="headerlink" title="å¼•æ“Ž"></a>å¼•æ“Ž</h1><p>MySQLé‡Œé¢å‚¨å­˜å¼•æ“ŽMyISAMä¸ŽInnoDBçš„åŒºåˆ«ï¼š</p><p><strong>InnoDBå¼•æ“Žï¼š</strong>æä¾›äº†å¯¹æ•°æ®åº“ACIDçš„æ”¯æŒï¼Œå¹¶ä¸”æä¾›äº†è¡Œçº§é”å’Œå¤–é”®çš„çº¦æŸã€‚å®ƒçš„è®¾è®¡ç›®çš„å°±æ˜¯å¤„ç†å¤§æ•°æ®å®¹é‡çš„æ•°æ®åº“ç³»ç»Ÿã€‚<strong>å¯ä»¥è‡ªé€‚åº”å“ˆå¸Œç´¢å¼•</strong>ï¼ˆèšç°‡ç´¢å¼•ï¼šåœ¨ç´¢å¼•ä¸­ä¿å­˜äº†æ•°æ®ï¼Œä»Žè€Œé¿å…ç›´æŽ¥è¯»å–ç£ç›˜ï¼Œå› æ­¤å¯¹æŸ¥è¯¢æ€§èƒ½æœ‰å¾ˆå¤§çš„æå‡ï¼‰</p><p><strong>MyISAMå¼•æ“Žï¼š</strong>ä¸æä¾›äº‹åŠ¡æ”¯æŒï¼Œä¹Ÿä¸æ”¯æŒè¡Œçº§é”å’Œå¤–é”®ã€‚<strong>åªæ”¯æŒè¡¨çº§é”ã€‚æ”¯æŒåŽ‹ç¼©è¡¨å’Œç©ºé—´æ•°æ®ç´¢å¼•ã€‚</strong>ï¼ˆéžèšç°‡ç´¢å¼•ï¼šç´¢å¼•å’Œæ•°æ®åˆ†å¼€å­˜ï¼Œåœ¨ç´¢å¼•é‡Œé¢æ‰¾åˆ°éœ€è¦çš„å†…å­˜åœ°å€ï¼Œç„¶åŽåŽ»è¯»å–ï¼‰</p><p>MyISAM å´©æºƒåŽå‘ç”ŸæŸåçš„æ¦‚çŽ‡æ¯” InnoDB é«˜å¾ˆå¤šï¼Œè€Œä¸”æ¢å¤çš„é€Ÿåº¦ä¹Ÿæ›´æ…¢ã€‚InnoDBçŽ°åœ¨æ˜¯MySQLçš„é»˜è®¤å¼•æ“Žã€‚</p><h1 id="MySQLçš„ACIDåŽŸç†"><a href="#MySQLçš„ACIDåŽŸç†" class="headerlink" title="MySQLçš„ACIDåŽŸç†"></a>MySQLçš„ACIDåŽŸç†</h1><p><strong>åŽŸå­æ€§(Atomicity)ã€ä¸€è‡´æ€§(Consistency)ã€éš”ç¦»æ€§(Isolation)ã€æŒä¹…æ€§(Durability)</strong></p><p>æˆ‘ä»¬ä»¥ä»ŽAè´¦æˆ·è½¬è´¦50å…ƒåˆ°Bè´¦æˆ·ä¸ºä¾‹è¿›è¡Œè¯´æ˜Žä¸€ä¸‹ACIDï¼Œå››å¤§ç‰¹æ€§ã€‚</p><p><strong>åŽŸå­æ€§ï¼š</strong></p><p>ä¸€ä¸ªäº‹ç‰©æ˜¯ä¸€ä¸ªä¸å¯åˆ†å‰²çš„å•ä½ï¼Œå…¶ä¸­çš„æ“ä½œ<strong>è¦ä¹ˆå…¨åšï¼Œè¦ä¹ˆä¸åšï¼Œä¸å­˜åœ¨ä¸­é—´çŠ¶æ€ã€‚</strong>è¦ä¹ˆè½¬è´¦æˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ï¼Œä¸å­˜åœ¨ä¸­é—´çŠ¶æ€ã€‚</p><blockquote><p>å¦‚æžœæ²¡åŠžæ³•ä¿è¯åŽŸå­æ€§ä¼šæ€Žä¹ˆæ ·ï¼Ÿ</p></blockquote><p>å¯èƒ½ä¼šå¯¼è‡´Açš„è´¦æˆ·å°‘äº†50å…ƒï¼Œä½†æ˜¯Bçš„è´¦æˆ·ä¹Ÿæ²¡å¤š50ã€‚ç³»ç»Ÿæ€»é‡‘é¢ä¼šå°‘50.ã€‚ã€‚ã€‚</p><p><strong>éš”ç¦»æ€§ï¼š</strong></p><p>æ˜¯æŒ‡åœ¨å¹¶å‘æ‰§è¡Œçš„æ—¶å€™ï¼Œ<em>äº‹åŠ¡å†…éƒ¨çš„æ“ä½œä¸Žå…¶ä»–çš„äº‹åŠ¡æ˜¯éš”ç¦»çš„</em>ï¼Œå¹¶å‘æ“ä½œçš„æ—¶å€™å„ä¸ªäº‹åŠ¡ä¹‹é—´ä¸èƒ½ç›¸äº’å¹²æ‰°ã€‚</p><blockquote><p>å¦‚æžœæ²¡åŠžæ³•ä¿è¯éš”ç¦»æ€§ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p></blockquote><p>æ¯”å¦‚è¯´Aæœ‰200ï¼ŒBæœ‰0ï¼ŒAå‘Bè½¬è´¦ä¸¤æ¬¡ï¼Œæ¯æ¬¡50å…ƒã€‚å¦‚æžœæ²¡å‘ä¿è¯éš”ç¦»æ€§ï¼Œå°±ä¼šå¯¼è‡´Aæ‰£æ¬¾äº†ä¸¤æ¬¡ï¼Œä½†æ˜¯Båªå¢žåŠ äº†ä¸€æ¬¡ï¼ŒAå°±å˜æˆäº†100ï¼ŒBåªæœ‰50ã€‚åˆå‡­ç©ºè’¸å‘äº†ã€‚</p><p><strong>æŒä¹…æ€§ï¼š</strong></p><p>æŒ‡çš„æ˜¯å½“äº‹åŠ¡æäº¤ä¹‹åŽï¼Œå®ƒå¯¹æ•°æ®åº“çš„æ”¹å˜å°±åº”è¯¥æ˜¯æ°¸ä¹…æ€§çš„ã€‚å¦‚æžœæŽ¥ä¸‹æ¥æœ‰ä»€ä¹ˆé”™è¯¯å‘ç”Ÿä¹Ÿä¸ä¼šè¢«å½±å“åˆ°ã€‚</p><blockquote><p>å¦‚æžœæ²¡åŠžæ³•ä¿è¯æŒä¹…æ€§ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p></blockquote><p>å¦‚æžœä½ æ­£åœ¨å†™å…¥ç£ç›˜çš„æ—¶å€™ï¼Œçªç„¶æœåŠ¡å™¨å®•æœºäº†ï¼Œåœ¨å†…å­˜ä¸­ä¿®æ”¹çš„æ•°æ®å…¨éƒ¨ä¸¢å¤±äº†ï¼ŒæŒä¹…æ€§å°±æ— æ³•ä¿è¯ã€‚</p><p><strong>ä¸€è‡´æ€§ï¼š</strong></p><p>æ˜¯æŒ‡äº‹åŠ¡æ‰§è¡Œå‰åŽï¼Œæ•°æ®å¤„äºŽä¸€ç§åˆæ³•çš„çŠ¶æ€ã€‚ã€‚é‚£ä»€ä¹ˆæ˜¯åˆæ³•çš„æ•°æ®çŠ¶æ€å‘¢ï¼Ÿ oKï¼Œè¿™ä¸ªçŠ¶æ€æ˜¯æ»¡è¶³é¢„å®šçš„çº¦æŸå°±å«åšåˆæ³•çš„çŠ¶æ€ï¼Œå†é€šä¿—ä¸€ç‚¹ï¼Œè¿™çŠ¶æ€æ˜¯ç”±ä½ è‡ªå·±æ¥å®šä¹‰çš„ã€‚<strong>ã€Œæ»¡è¶³è¿™ä¸ªçŠ¶æ€ï¼Œæ•°æ®å°±æ˜¯ä¸€è‡´çš„ï¼Œä¸æ»¡è¶³è¿™ä¸ªçŠ¶æ€ï¼Œæ•°æ®å°±æ˜¯ä¸ä¸€è‡´çš„ã€</strong>ï¼ï¼ˆå°±æ˜¯è‡ªå·±åŽ»è§„å®šçš„ä¸€ä¸ªçŠ¶æ€ï¼Œæ¯”å¦‚è´¦æˆ·ä½™é¢å¿…é¡»å¤§äºŽ100ï¼‰</p><blockquote><p>å¦‚æžœæ²¡åŠžæ³•ä¿è¯ä¸€è‡´æ€§ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p></blockquote><p>ä¾‹ä¸€ï¼šAè´¦æˆ·æœ‰200å…ƒï¼Œè½¬è´¦300å…ƒå‡ºåŽ»ï¼Œæ­¤æ—¶Aè´¦æˆ·ä½™é¢ä¸º-100å…ƒã€‚ä½ è‡ªç„¶å°±å‘çŽ°äº†æ­¤æ—¶æ•°æ®æ˜¯ä¸ä¸€è‡´çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºä½ å®šä¹‰äº†ä¸€ä¸ªçŠ¶æ€ï¼Œä½™é¢è¿™åˆ—å¿…é¡»å¤§äºŽ0ã€‚</p><p><strong>æ•°æ®åº“å¿…é¡»è¦å®žçŽ°AIDä¸‰å¤§ç‰¹æ€§ï¼Œæ‰æœ‰å¯èƒ½å®žçŽ°ä¸€è‡´æ€§ã€‚</strong>ä¾‹å¦‚ï¼ŒåŽŸå­æ€§æ— æ³•ä¿è¯ï¼Œæ˜¾ç„¶ä¸€è‡´æ€§ä¹Ÿæ— æ³•ä¿è¯ã€‚</p><h2 id="MySQLæ€Žä¹ˆå®žçŽ°ACIDçš„"><a href="#MySQLæ€Žä¹ˆå®žçŽ°ACIDçš„" class="headerlink" title="MySQLæ€Žä¹ˆå®žçŽ°ACIDçš„"></a>MySQLæ€Žä¹ˆå®žçŽ°ACIDçš„</h2><p>MySQLé‡Œé¢InnoDBæ˜¯ä½¿ç”¨<strong><code>undo log</code> æ˜¯å®žçŽ°åŽŸå­æ€§</strong>çš„å…³é”®ï¼Œ<strong>å½“äº‹ç‰©å›žæ»šçš„æ—¶å€™èƒ½å¤Ÿæ’¤é”€æ‰€æœ‰å·²ç»æˆåŠŸæ‰§è¡Œçš„SQLè¯­å¥ã€‚</strong>ä»–éœ€è¦è®°å½•ä½ è¦å›žæ»šçš„ç›¸åº”æ—¥å¿—ä¿¡æ¯ï¼š</p><ol><li>å½“ä½ deleteä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œå°±éœ€è¦è®°å½•è¿™æ¡æ•°æ®çš„ä¿¡æ¯ï¼Œå›žæ»šçš„æ—¶å€™ï¼Œinsertè¿™æ¡æ—§æ•°æ®</li><li>å½“ä½ updateä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œå°±éœ€è¦è®°å½•ä¹‹å‰çš„æ—§å€¼ï¼Œå›žæ»šçš„æ—¶å€™ï¼Œæ ¹æ®æ—§å€¼æ‰§è¡Œupdateæ“ä½œ</li><li>å½“å¹´insertä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œå°±éœ€è¦è¿™æ¡è®°å½•çš„ä¸»é”®ï¼Œå›žæ»šçš„æ—¶å€™ï¼Œæ ¹æ®ä¸»é”®æ‰§è¡Œdeleteæ“ä½œ</li></ol><p>InnoDBä½¿ç”¨<strong><code>redo log</code>æ˜¯å®žçŽ°æŒä¹…æ€§</strong>çš„å…³é”®ï¼ŒMysqlæ˜¯å…ˆæŠŠç£ç›˜ä¸Šçš„æ•°æ®åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œåœ¨å†…å­˜ä¸­å¯¹æ•°æ®è¿›è¡Œä¿®æ”¹ï¼ŒåŒæ—¶ä¼šåœ¨<code>redo log</code>é‡Œé¢è®°å½•è¯¥æ“ä½œï¼Œå½“å®•æœºé‡å¯ä¹‹åŽï¼Œä¼šå°†<code>redo log</code>ä¸­çš„å†…å®¹å›žå¤åˆ°æ•°æ®åº“é‡Œé¢ã€‚</p><p><strong>MySQLä½¿ç”¨çš„æ˜¯é”å’ŒMVCCæœºåˆ¶ä¿è¯éš”ç¦»æ€§ã€‚</strong></p><h1 id="ACID"><a href="#ACID" class="headerlink" title="ACID"></a>ACID</h1><p>æ•°æ®åº“äº‹åŠ¡ä¸­çš„å››å¤§ç‰¹æ€§ï¼šACID</p><h2 id="Atomicity"><a href="#Atomicity" class="headerlink" title="Atomicity"></a>Atomicity</h2><p>Aï¼šåŽŸå­æ€§ï¼ˆAtomicityï¼‰ï¼Œä¸€ä¸ªäº‹åŠ¡ï¼ˆtranscationï¼‰ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šå‡ºçŽ°å®Œæˆä¸€åŠçš„æƒ…å†µã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ä¼šè¢«å›žæ»šï¼ˆrollbacï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ã€‚</p><p>åŽŸå­æ€§å’Œä¸€è‡´æ€§é€šè¿‡Undo logæ¥å®žçŽ°ã€‚Undo logçš„åŽŸç†å¾ˆç®€å•ï¼Œä¸ºäº†æ»¡è¶³äº‹åŠ¡çš„åŽŸå­æ€§ï¼Œåœ¨æ“ä½œä»»ä½•æ•°æ®ä¹‹å‰ï¼Œé¦–å…ˆå°†æ•°æ®å¤‡ä»½åˆ°ä¸€ä¸ªåœ°æ–¹ï¼ˆè¿™ä¸ªå­˜å‚¨æ•°æ®å¤‡ä»½çš„åœ°æ–¹ç§°ä¸ºUndo logï¼‰ã€‚ç„¶åŽè¿›è¡Œæ•°æ®çš„ä¿®æ”¹ã€‚å¦‚æžœå‡ºçŽ°äº†é”™è¯¯æˆ–è€…ç”¨æˆ·æ‰§è¡Œäº†ROLLBACKè¯­å¥ï¼Œç³»ç»Ÿå¯ä»¥åˆ©ç”¨Undo logä¸­çš„å¤‡ä»½å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚</p><h2 id="Consistency"><a href="#Consistency" class="headerlink" title="Consistency"></a>Consistency</h2><p>Cï¼šä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼Œäº‹åŠ¡çš„ä¸€è‡´æ€§æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä¹‹å‰å’Œæ‰§è¡Œä¹‹åŽæ•°æ®åº“éƒ½å¿…é¡»å¤„äºŽä¸€è‡´æ€§çŠ¶æ€ã€‚å¦‚æžœäº‹åŠ¡æˆåŠŸåœ°å®Œæˆï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­æ‰€æœ‰å˜åŒ–å°†æ­£ç¡®åœ°åº”ç”¨ï¼Œç³»ç»Ÿå¤„äºŽæœ‰æ•ˆçŠ¶æ€ã€‚å¦‚æžœåœ¨äº‹åŠ¡ä¸­å‡ºçŽ°é”™è¯¯ï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­çš„æ‰€æœ‰å˜åŒ–å°†è‡ªåŠ¨åœ°å›žæ»šï¼Œç³»ç»Ÿè¿”å›žåˆ°åŽŸå§‹çŠ¶æ€ã€‚(å‚è€ƒåˆ†å¸ƒå¼æ•°æ®åº“çš„ä¸€è‡´æ€§)ã€‚</p><p>æ•°æ®ä¸€è‡´æ€§å¯ä»¥å‚è€ƒRaftç®—æ³•å’ŒPaxosç®—æ³•ã€‚</p><h2 id="Isolation"><a href="#Isolation" class="headerlink" title="Isolation"></a>Isolation</h2><p>Iï¼šéš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼ŒæŒ‡çš„æ˜¯åœ¨å¹¶å‘çŽ¯å¢ƒä¸­ï¼Œå½“ä¸åŒçš„äº‹åŠ¡åŒæ—¶æ“çºµç›¸åŒçš„æ•°æ®æ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªçš„å®Œæ•´æ•°æ®ç©ºé—´ã€‚ç”±å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å¿…é¡»ä¸Žä»»ä½•å…¶ä»–å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹éš”ç¦»ã€‚äº‹åŠ¡æŸ¥çœ‹æ•°æ®æ›´æ–°æ—¶ï¼Œæ•°æ®æ‰€å¤„çš„çŠ¶æ€è¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹å‰çš„çŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹åŽçš„çŠ¶æ€ï¼Œäº‹åŠ¡ä¸ä¼šæŸ¥çœ‹åˆ°ä¸­é—´çŠ¶æ€çš„æ•°æ®ã€‚ æ‰“ä¸ªæ¯”æ–¹ï¼Œä½ ä¹°ä¸œè¥¿è¿™ä¸ªäº‹æƒ…ï¼Œæ˜¯ä¸å½±å“å…¶ä»–äººçš„ã€‚</p><p>å¦‚æžœè¦å®žçŽ°æ•°æ®åº“äº‹åŠ¡æœ€é«˜éš”ç¦»æ€§ï¼Œä¹Ÿå°±æ˜¯æœ€å®‰å…¨çš„éš”ç¦»ã€‚æœ€ç®€å•çš„è§£å†³æ–¹æ³•å°±æ˜¯å½“ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œçš„æ—¶å€™ï¼Œå…¶ä»–äº‹åŠ¡éƒ½é˜»å¡žï¼Œç­‰å½“å‰äº‹åŠ¡æ‰§è¡Œå®Œä¹‹åŽå†æ‰§è¡Œã€‚ä½†æ˜¯å¯¹äºŽçŽ°åœ¨çš„å¤šæ ¸CPUæ˜¯éžå¸¸æµªè´¹èµ„æºçš„ã€‚æ‰€ä»¥ä¸ºäº†å……åˆ†åˆ©ç”¨è®¡ç®—èµ„æºï¼Œå¯ä»¥ä½¿ç”¨å¤šç‰ˆæœ¬å¹¶å‘æŽ§åˆ¶ï¼ˆMVCCï¼‰æ¥è§£å†³è¯¥é—®é¢˜ã€‚</p><h3 id="Read-amp-Write-Lock"><a href="#Read-amp-Write-Lock" class="headerlink" title="Read &amp; Write Lock"></a>Read &amp; Write Lock</h3><p>è¯»å†™é”è¿˜æ˜¯æ¯”è¾ƒå®¹æ˜“ç†è§£çš„ã€‚å½“åœ¨è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œåº”è¯¥å¯¹è¯»å–çš„æ•°æ®å…ˆåŠ é”åŽè¯»å–ï¼Œè¯»å–å®Œä¹‹åŽçš„æŸä¸ªæ—¶é—´å†è¿›è¡Œè§£å¼€è¯»é”ã€‚è¯»é”åªèƒ½è¯»å–æ•°æ®ä¸èƒ½å†™å…¥ã€‚å› ä¸ºå¦‚æžœåŠ äº†è¯»é”ï¼Œè¯´æ˜ŽæŸä¸ªäº‹åŠ¡å‡†å¤‡è¯»å–æ•°æ®ï¼Œå¦‚æžœè¢«åˆ«çš„äº‹åŠ¡ä¿®æ”¹äº†æ•°æ®ï¼Œé‚£ä¹ˆæ•°æ®å°±ä¸å‡†ç¡®äº†ã€‚<strong>ä½†æ˜¯å¤šä¸ªäº‹åŠ¡å¯ä»¥åŒæ—¶å¯¹åŒä¸€ä¸ªæ•°æ®è¿›è¡Œè¯»é”ï¼Œå› ä¸ºæ‰€æœ‰äº‹åŠ¡éƒ½æ˜¯åªè¯»ä¸å†™ã€‚</strong></p><p>å†™é”å…·æœ‰æŽ’ä»–æ€§ï¼ˆexclusive lockï¼‰ã€‚å½“ä¸€ä¸ªäº‹åŠ¡å‡†å¤‡å¯¹ä¸€ä¸ªæ•°æ®è¿›è¡Œå†™æ“ä½œçš„æ—¶å€™ï¼Œå…ˆè¦å¯¹æ•°æ®åŠ å†™é”ï¼Œç„¶åŽæ‰å¯ä»¥ä¿®æ”¹æ•°æ®ã€‚è¿™ä¸ªæ—¶å€™å…¶ä»–äº‹åŠ¡å°±æ— æ³•å¯¹è¿™ä¸ªæ•°æ®è¿›è¡Œè§£é”ï¼Œé™¤éžè¿™ä¸ªå†™é”é‡Šæ”¾ã€‚å†™é”æ˜¯ä¸ºäº†å¿…ç„¶å¤šä¸ªäº‹åŠ¡åŒæ—¶ä¿®æ”¹åŒä¸€ä¸ªæ•°æ®ã€‚</p><h3 id="One-Phase-Lock"><a href="#One-Phase-Lock" class="headerlink" title="One Phase Lock"></a>One Phase Lock</h3><p>ä¸€æ®µé”å³äº‹åŠ¡å¼€å§‹çš„æ—¶å€™ï¼Œä¸€æ¬¡æ€§ç”³è¯·å…¨éƒ¨çš„é”ï¼Œä»¥åŽä¸ä¼šç”³è¯·ä»»ä½•é”ã€‚å¦‚æžœæœŸä¸­æŸä¸ªé”ä¸å¯ç”¨ï¼Œåˆ™æ•´ä¸ªç”³è¯·å°±ä¸æˆåŠŸï¼Œäº‹åŠ¡å°±ä¸ä¼šæ‰§è¡Œï¼Œåœ¨äº‹åŠ¡å°¾ç«¯åˆ™ä¸€æ¬¡æ€§é‡Šæ”¾æ‰€æœ‰é”ã€‚ä¸€æ®µé”ä¸ä¼šé€ æˆæ­»é”ï¼Œä½†æ˜¯äº‹åŠ¡çš„å¹¶å‘åº¦ä¸é«˜ã€‚</p><h3 id="Two-Phase-Lock"><a href="#Two-Phase-Lock" class="headerlink" title="Two Phase Lock"></a>Two Phase Lock</h3><p>ä¸¤æ®µé”ï¼Œæ•´ä¸ªäº‹åŠ¡åˆ†æˆä¸¤ä¸ªé˜¶æ®µï¼Œå‰ä¸€ä¸ªé˜¶æ®µä¸ºåŠ é”ï¼ŒåŽä¸€ä¸ªé˜¶æ®µä¸ºè§£é”ã€‚åœ¨åŠ é”é˜¶æ®µï¼Œäº‹åŠ¡åªèƒ½åŠ é”ï¼Œä¹Ÿèƒ½æ“ä½œæ•°æ®ï¼Œä½†ä¸èƒ½è§£é”ã€‚ç›´åˆ°äº‹åŠ¡é‡Šæ”¾ç¬¬ä¸€ä¸ªé”ï¼Œå°±è¿›å…¥è§£é”é˜¶æ®µï¼Œæ­¤è¿‡ç¨‹å½“ä¸­äº‹åŠ¡åªèƒ½è§£é”ï¼Œä¹Ÿèƒ½æ“ä½œæ•°æ®ï¼Œä¸èƒ½å†åŠ é”ã€‚ä¸¤æ®µé”åè®®ä½¿å¾—äº‹åŠ¡å…·å¤‡è¾ƒé«˜çš„å¹¶å‘ã€‚ç”±äºŽåœ¨åŠ é”é˜¶æ®µæ²¡æœ‰é¡ºåºè¦æ±‚ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨æ­»é”çš„æƒ…å†µã€‚å¦‚æžœä¸¤ä¸ªäº‹åŠ¡åˆ†åˆ«ç”³è¯·äº†Aï¼ŒBé”ï¼ŒæŽ¥ç€åˆç”³è¯·å¯¹æ–¹çš„é”ï¼Œæ­¤æ—¶è¿›å…¥åˆ°æ­»é”çŠ¶æ€ã€‚</p><h3 id="Multiversion-Concurrency-Control"><a href="#Multiversion-Concurrency-Control" class="headerlink" title="Multiversion Concurrency Control"></a>Multiversion Concurrency Control</h3><p>åŠ é”çš„æ–¹å¼å¤„ç†äº‹åŠ¡ä¸€ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜å°±æ˜¯ä¼šé€ æˆæ­»é”ï¼ˆdead lockï¼‰,åŽŸå› å°±æ˜¯ä¸€ä¸ªäº‹åŠ¡åŠ é”çš„æ•°æ®å¹¶ä¸æ­¢åªæœ‰ä¸€è¡Œã€‚äº‹åŠ¡Aå¯¹è¡ŒCåŠ å†™é”ï¼Œäº‹åŠ¡Bå¯¹è¡ŒDåŠ å†™é”ï¼ŒæŽ¥ç€äº‹åŠ¡å¸Œæœ›èŽ·å–è¡ŒDçš„é”ï¼Œäº‹åŠ¡Bå¸Œæœ›èŽ·å–è¡ŒCçš„é”ï¼Œè¿™æ ·å¾ˆå®¹å°±æ­»é”äº†ã€‚</p><p>MVCCæä¾›çš„åªæ˜¯ä¸€ç§æ€è·¯ï¼Œå…·ä½“çš„å®žçŽ°æ¯”è¾ƒå¤šæ ·åŒ–ã€‚å¤§ä½“çš„æ€è·¯æ˜¯æ¯ä¸€è¡Œä¿å­˜å†—ä½™æ•°æ®ï¼Œè¯»å†™çš„æ—¶é—´æˆ³ï¼Œä¹Ÿå¯ä»¥ç§°ä¸ºç‰ˆæœ¬å·ï¼Œ<strong>åœ¨å¯¹æŸä¸€è¡Œæ•°æ®ç»§ç»­updateæˆ–è€…deleteçš„æ—¶å€™ï¼Œå¹¶ä¸ç›´æŽ¥æ“ä½œï¼Œè€Œæ˜¯å¤åˆ¶å¤šä¸€ä»½å‰¯æœ¬è¿›è¡Œæ“ä½œï¼Œè¿™ä¸ªå°±æ˜¯æ‰€è°“å¤šç‰ˆæœ¬ï¼ˆmultiversionï¼‰</strong></p><p>ç›¸å½“äºŽåˆ©ç”¨æ—¶é—´æˆ³å¯¹æ•°æ®è¿›è¡Œç»´æŠ¤ä¿æŒæ•°æ®çš„éš”ç¦»æ€§ã€‚</p><h2 id="Durability"><a href="#Durability" class="headerlink" title="Durability"></a>Durability</h2><p>Dï¼šæŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼ŒæŒ‡çš„æ˜¯åªè¦äº‹åŠ¡æˆåŠŸç»“æŸï¼Œå®ƒå¯¹æ•°æ®åº“æ‰€åšçš„æ›´æ–°å°±å¿…é¡»æ°¸ä¹…ä¿å­˜ä¸‹æ¥ã€‚å³ä½¿å‘ç”Ÿç³»ç»Ÿå´©æºƒï¼Œé‡æ–°å¯åŠ¨æ•°æ®åº“ç³»ç»ŸåŽï¼Œæ•°æ®åº“è¿˜èƒ½æ¢å¤åˆ°äº‹åŠ¡æˆåŠŸç»“æŸæ—¶çš„çŠ¶æ€ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œä½ ä¹°ä¸œè¥¿çš„æ—¶å€™éœ€è¦æ‹¿æ”¶æ®ï¼Œå³ä½¿è€æ¿å¿˜è®°äº†é‚£ä¹Ÿæœ‰æ®å¯æŸ¥ã€‚</p><p>é‡åšæ—¥å¿—ï¼ˆRedo Logï¼‰ç”¨æ¥å®žçŽ°äº‹åŠ¡çš„æŒä¹…æ€§ã€‚Redo logè®°å½•çš„æ˜¯æ–°æ•°æ®çš„å¤‡ä»½ã€‚åœ¨äº‹åŠ¡æäº¤å‰ï¼Œåªè¦å°†Redo logæŒä¹…åŒ–å³å¯ï¼Œä¸éœ€è¦å°†æ•°æ®æŒä¹…åŒ–ã€‚å½“ç³»ç»Ÿå´©æºƒæ—¶ï¼Œè™½ç„¶æ•°æ®æ²¡æœ‰æŒä¹…åŒ–ï¼Œä½†æ˜¯Redo logå·²ç»æŒä¹…åŒ–ã€‚ç³»ç»Ÿå¯ä»¥æ ¹æ®Redo logçš„å†…å®¹ï¼Œå°†æ‰€æœ‰æ•°æ®æ¢å¤åˆ°æœ€æ–°çš„çŠ¶æ€ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åŒ…å«ä¸€äº›databaseå¸¸è§çš„é—®é¢˜ï¼ŒMySQLçš„ç´¢å¼•ï¼Œæ€Žä¹ˆä½¿ç”¨ç´¢å¼•ç­‰ç­‰ã€‚&lt;/p&gt;
&lt;h1 id=&quot;æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼&quot;&gt;&lt;a href=&quot;#æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼&quot; class=&quot;headerlink&quot; title=&quot;æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼&quot;&gt;&lt;/a&gt;æ•°æ®åº“çš„ä¸‰å¤§èŒƒå¼&lt;/h1&gt;&lt;p&gt;ç¬¬ä¸€
      
    
    </summary>
    
    
    
      <category term="db" scheme="https://shunyangli.github.io/tags/db/"/>
    
  </entry>
  
  <entry>
    <title>Distributed Things</title>
    <link href="https://shunyangli.github.io/post/f61e/"/>
    <id>https://shunyangli.github.io/post/f61e/</id>
    <published>2020-06-26T05:05:27.000Z</published>
    <updated>2022-06-14T06:41:24.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Distributed-session"><a href="#Distributed-session" class="headerlink" title="Distributed session"></a>Distributed session</h1><p>æ€Žä¹ˆä½¿ç”¨flaskæ¥åšåˆ†å¸ƒå¼sessionï¼Œä»¥åŠä¸ºä»€ä¹ˆè¦ä½¿ç”¨åˆ†å¸ƒå¼çš„sessionã€‚</p><p>å› ä¸ºcookieä¸å¤ªé€‚åˆå­˜ä¸€äº›æ•æ„Ÿä¿¡æ¯ï¼Œæ‰€ä»¥ä¸€èˆ¬æ•æ„Ÿçš„ä¿¡æ¯ä¼šå­˜åˆ°sessioné‡Œã€‚ä½†æ˜¯å¤§éƒ¨åˆ†æ—¶å€™éƒ½æ˜¯cookieå’Œsessionç»“åˆä½¿ç”¨ã€‚sessionæ˜¯å­˜åœ¨æœåŠ¡å™¨é‡Œé¢çš„ç›¸å¯¹å®‰å…¨ä¸€ç‚¹ã€‚</p><p><strong>å‚¨å­˜åŽŸç†ï¼š</strong></p><p>é€šè¿‡cookieå­˜ä¸€ä¸ªsession_idï¼Œç„¶åŽå…·ä½“çš„æ•°æ®æ˜¯ä¿å­˜åˆ°sessioné‡Œé¢ï¼Œè€Œsessionä¼šå­˜åˆ°serveré‡Œé¢ã€‚æ¯”å¦‚åœ¨ç”¨æˆ·ç™»å½•ä¹‹åŽæœåŠ¡å™¨ä¼šåœ¨cookieé‡Œé¢ä¿å­˜ä¸€ä¸ªsession_idï¼Œä¸‹æ¬¡å†å‘èµ·è¯·æ±‚çš„æ—¶å€™ä¼šæŠŠè¯¥session_idæºå¸¦ä¸Šæ¥ï¼ŒæœåŠ¡å™¨æ ¹æ®session_idåœ¨sessionçš„åº“ä¸­èŽ·å–ç”¨æˆ·çš„sessionæ•°æ®ã€‚</p><p><strong>flaské»˜è®¤é‡‡ç”¨çš„æ–¹å¼æ˜¯å°†sessionæ•°æ®åŠ å¯†ï¼Œç„¶åŽå­˜åˆ°cookieé‡Œé¢ã€‚ä½†æ˜¯ä¹Ÿå¯ä»¥æ¢æˆåˆ«çš„æ–¹å¼ã€‚</strong></p><h2 id="session"><a href="#session" class="headerlink" title="session"></a>session</h2><p>å…ˆæ¥äº†è§£ä¸€ä¸‹flaské»˜è®¤çš„sessionçš„ä½¿ç”¨æ–¹æ³•ã€‚å› ä¸ºè¦ä½¿ç”¨sessionæ‰€ä»¥å¿…é¡»è¦è®¾ç½®<code>SECRET_KEY</code>æ‰èƒ½æ­£å¸¸å¯åŠ¨ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">by using flask session to learn distribute system</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line">app.config[<span class="string">'SESSION_PERMANENT'</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># èŽ·å–sessioné‡Œé¢çš„keyï¼Œå¦‚æžœä¸å­˜åœ¨å°±è¿”å›žnothing</span></span><br><span class="line">    <span class="keyword">return</span> session.get(<span class="string">'key'</span>, <span class="string">'nothing'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/test', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">session_test</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># è®¾ç½®sessioné‡Œé¢keyçš„å€¼</span></span><br><span class="line">    session[<span class="string">'key'</span>] = <span class="string">'TEST'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'ok'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/set', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_key</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># æ ¹æ®å‚æ•°æ¥è®¾ç½®sessioné‡Œé¢çš„key</span></span><br><span class="line">    key = request.args.get(<span class="string">'key'</span>)</span><br><span class="line">    session[<span class="string">'key'</span>] = key</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'ok'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/get', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_key</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> session.get(<span class="string">'key'</span>, <span class="string">'nothing'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/delete', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_key</span><span class="params">()</span>:</span></span><br><span class="line">    session.pop(<span class="string">'key'</span>)</span><br><span class="line">    <span class="comment"># del session['key']</span></span><br><span class="line">    <span class="comment"># session.clear()</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'ok'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå°±ä¸ç»™å¤§å®¶æˆªå›¾äº†ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±è¾“å…¥è¿™äº›ä»£ç å°è¯•ä¸€ä¸‹ã€‚</p><h2 id="sessionçš„è¿‡æœŸæ—¶é—´"><a href="#sessionçš„è¿‡æœŸæ—¶é—´" class="headerlink" title="sessionçš„è¿‡æœŸæ—¶é—´"></a>sessionçš„è¿‡æœŸæ—¶é—´</h2><p>å¦‚æžœæ²¡æœ‰è®¾ç½®sessionçš„æœ‰æ•ˆæ—¶é—´ï¼Œé»˜è®¤çš„å°±æ˜¯å…³é—­æµè§ˆå™¨ä¹‹åŽè¿‡æœŸã€‚å¦‚æžœè®¾ç½®<code>session.permanent=True</code>ï¼Œé‚£sessioné»˜è®¤31å¤©ä¹‹åŽè¿‡æœŸã€‚å¦‚æžœä¸æƒ³31å¤©åŽè¿‡æœŸå¯ä»¥è®¾ç½®<code>app.config[&#39;PERMANENT_SESSION_LIFETIME&#39;] = 3600</code>æ¥ä¿®æ”¹è¿‡æœŸæ—¶é—´ã€‚</p><h2 id="sessionçš„åˆ é™¤"><a href="#sessionçš„åˆ é™¤" class="headerlink" title="sessionçš„åˆ é™¤"></a>sessionçš„åˆ é™¤</h2><p>sessionçš„å‚¨å­˜æ–¹æ³•ç±»ä¼¼å­—å…¸ã€‚æœ‰ä¸‰ç§åˆ é™¤çš„æ–¹æ³•<code>session.pop(&#39;key&#39;)</code>, <code>del session[&#39;key&#39;]</code>, <code>session.clear()</code>æœ€åŽä¸€ä¸ªè¡¨ç¤ºæ¸…é™¤æ•´ä¸ªsessionçš„æ•°æ®ã€‚</p><h2 id="åˆ†å¸ƒå¼çš„session"><a href="#åˆ†å¸ƒå¼çš„session" class="headerlink" title="åˆ†å¸ƒå¼çš„session"></a>åˆ†å¸ƒå¼çš„session</h2><p><img src="/post/f61e/1.png" alt></p><p>åˆ©ç”¨flask-sessionæŠŠsessionå­˜åˆ°æœåŠ¡å™¨é‡Œé¢ã€‚flask-sessionæ”¯æŒå¤šç§æ•°æ®åº“ï¼š</p><ul><li>redis</li><li>memcached</li><li>filesystem</li><li>MongoDB</li><li>sqlalchmey</li></ul><p>å› ä¸ºredisæ˜¯æŠŠæ•°æ®å‚¨å­˜åˆ°å†…å­˜ä¸Šé¢çš„ï¼Œé€Ÿåº¦ç›¸å½“å¿«ï¼Œæ‰€ä»¥ä¸€èˆ¬ç”¨redisæ¥å‚¨å­˜sessionçš„ã€‚</p><p>é¦–å…ˆæŠŠ<code>flask-seesion</code>ï¼Œ<code>redis</code>å®‰è£…ä¸€ä¸‹:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">pip3 install flask-session</span><br><span class="line">pip3 install redis</span><br></pre></td></tr></table></figure><p>ç„¶åŽåœ¨ä»£ç é‡Œé¢é…ç½®redisçš„ä¿¡æ¯å°±å¥½ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">ä½¿ç”¨redisæ¥é…ç½®session</span></span><br><span class="line"><span class="string">ç±»ä¼¼åˆ†å¸ƒå¼çš„sessionçš„æ•°æ®</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, session, request</span><br><span class="line"><span class="keyword">from</span> flask_session <span class="keyword">import</span> Session</span><br><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> Redis</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># é…ç½®ä½¿ç”¨sessionçš„å‚¨å­˜æ–¹å¼</span></span><br><span class="line">app.config[<span class="string">'SESSION_TYPE'</span>] = <span class="string">'redis'</span></span><br><span class="line">app.config[<span class="string">'SESSION_REDIS'</span>] = Redis(</span><br><span class="line">    host=<span class="string">'127.0.0.1'</span>,</span><br><span class="line">    port=<span class="number">6379</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç±»ä¼¼æ˜¯å¦å¯¹sessionåŠ å¯†</span></span><br><span class="line">app.config[<span class="string">'SESSION_USE_SIGNER'</span>] = <span class="literal">True</span></span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æ˜¯å¦é•¿æœŸä½¿ç”¨session, ä¸€èˆ¬æ˜¯å…³é—­çš„, æµè§ˆå™¨å…³é—­åˆ™sessionå¤±æ•ˆ</span></span><br><span class="line">app.config[<span class="string">'SESSION_PERMANENT'</span>] = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># sessionæœ‰æ•ˆæ—¶é•¿</span></span><br><span class="line">app.config[<span class="string">'PERMANENT_SESSION_LIFETIME'</span>] = <span class="number">3600</span></span><br><span class="line">Session(app)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> session.get(<span class="string">'key'</span>, <span class="string">'nothing'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/test', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">session_test</span><span class="params">()</span>:</span></span><br><span class="line">    session[<span class="string">'key'</span>] = <span class="string">'TEST'</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'ok'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/set', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">set_key</span><span class="params">()</span>:</span></span><br><span class="line">    key = request.args.get(<span class="string">'key'</span>)</span><br><span class="line">    print(key)</span><br><span class="line">    session[<span class="string">'key'</span>] = key</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'ok'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/get', methods=["POST", "GET"])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_key</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> session.get(<span class="string">'key'</span>, <span class="string">'nothing'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡<code>redis-cli</code>æ¥æŸ¥çœ‹ç›¸å¯¹åº”çš„sessionä¿¡æ¯ï¼š</p><p><img src="/post/f61e/2.png" alt></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Distributed-session&quot;&gt;&lt;a href=&quot;#Distributed-session&quot; class=&quot;headerlink&quot; title=&quot;Distributed session&quot;&gt;&lt;/a&gt;Distributed session&lt;/h1&gt;&lt;p&gt;æ€Žä¹ˆ
      
    
    </summary>
    
    
    
      <category term="Distributed" scheme="https://shunyangli.github.io/tags/Distributed/"/>
    
  </entry>
  
</feed>
